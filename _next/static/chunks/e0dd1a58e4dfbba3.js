(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,69398,t=>{"use strict";var e,i,o,s,n,r,a,m,h,c,l,_,u,p,y,d,f,v,x,A,g,b=t.i(43476),B=t.i(71645),w=t.i(18566),V=t.i(99264),C=t.i(91673);let M={strokeColor:"#00e6e6",strokeWeight:3,multiVector:2,operation:"+",visualizeMode:"triangle",physicsEnabled:!1,massKg:5,pxPerNewton:100},I=[{type:"number",name:"strokeWeight",label:"Vectors lines weight:",min:1,step:1},{type:"select",name:"physicsEnabled",label:"Physics (Planck):",options:[{value:"false",label:"Off"},{value:"true",label:"On"}]},{type:"select",name:"operation",label:"Vectors Operation:",options:[{value:"+",label:"Addition (+)"},{value:"-",label:"Subtraction (-)"},{value:"x",label:"Scalar Multiplication (x)"},{value:"normalize",label:"Normalize (v̂)"},{value:"dot",label:"Dot Product (A·B)"},{value:"cross",label:"Cross Product 2D (A×B z)"}]},{type:"select",name:"visualizeMode",label:"Visualization:",options:[{value:"triangle",label:"Triangle"},{value:"parallelogram",label:"Parallelogram"}],showCondition:t=>"+"===t.operation||"-"===t.operation},{type:"number",name:"massKg",label:"m - Mass (kg)",min:.1,step:.1,disabledCondition:t=>!t.physicsEnabled},{type:"number",name:"pxPerNewton",label:"Pixels per Newton",min:1,step:1,disabledCondition:t=>!t.physicsEnabled},{type:"number",name:"multiVector",label:"Multiplicate vector (multiplication only):",min:-10,max:10,step:.1,disabledCondition:t=>"x"!==t.operation},{type:"color",name:"strokeColor",label:"Vectors color:"}];var P=t.i(84111),z=t.i(99072),S=t.i(71616),F=t.i(46400),L=t.i(77776),T=t.i(13997),q=t.i(63228),k=t.i(70323),N=t.i(10697),j=function(t,e){return(j=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)};function D(t,e){if("function"!=typeof e&&null!==e)throw TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}j(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var R=function(){return(R=Object.assign||function(t){for(var e,i=1,o=arguments.length;i<o;i++)for(var s in e=arguments[i])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t}).apply(this,arguments)},O=function(t,e){null==t&&(t={});var i=R({},t);for(var o in e)e.hasOwnProperty(o)&&void 0===t[o]&&(i[o]=e[o]);if("function"==typeof Object.getOwnPropertySymbols)for(var s=Object.getOwnPropertySymbols(e),n=0;n<s.length;n++){var r=s[n];e.propertyIsEnumerable(r)&&void 0===t[r]&&(i[r]=e[r])}return i},E=Math.random,Y=Number.isFinite;function W(t,e,i){return(void 0===e?(i=1,e=0):void 0===i&&(i=e,e=0),i>e)?(t=(t-e)%(i-e))+(t<0?i:e):(t=(t-i)%(e-i))+(t<=0?e:i)}function J(t,e,i){return t<e?e:t>i?i:t}var H=Object.create(Math);H.EPSILON=1e-9,H.isFinite=Y,H.nextPowerOfTwo=function(t){return t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,(t|=t>>16)+1},H.isPowerOfTwo=function(t){return t>0&&(t&t-1)==0},H.mod=W,H.clamp=J,H.random=function(t,e){return void 0===t?(e=1,t=0):void 0===e&&(e=t,t=0),t===e?t:E()*(e-t)+t};var U=Math.abs,K=Math.sqrt,Z=Math.max,X=Math.min,G=function(){function t(e,i){if(!(this instanceof t))return new t(e,i);void 0===e?(this.x=0,this.y=0):"object"==typeof e?(this.x=e.x,this.y=e.y):(this.x=e,this.y=i)}return t.prototype._serialize=function(){return{x:this.x,y:this.y}},t._deserialize=function(e){var i=Object.create(t.prototype);return i.x=e.x,i.y=e.y,i},t.zero=function(){var e=Object.create(t.prototype);return e.x=0,e.y=0,e},t.neo=function(e,i){var o=Object.create(t.prototype);return o.x=e,o.y=i,o},t.clone=function(e){return t.neo(e.x,e.y)},t.prototype.toString=function(){return JSON.stringify(this)},t.isValid=function(t){return null!=t&&Number.isFinite(t.x)&&Number.isFinite(t.y)},t.assert=function(t){},t.prototype.clone=function(){return t.clone(this)},t.prototype.setZero=function(){return this.x=0,this.y=0,this},t.prototype.set=function(t,e){return"object"==typeof t?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),this},t.prototype.setNum=function(t,e){return this.x=t,this.y=e,this},t.prototype.setVec2=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.wSet=function(t,e,i,o){return void 0!==i||void 0!==o?this.setCombine(t,e,i,o):this.setMul(t,e)},t.prototype.setCombine=function(t,e,i,o){var s=t*e.x+i*o.x,n=t*e.y+i*o.y;return this.x=s,this.y=n,this},t.prototype.setMul=function(t,e){var i=t*e.x,o=t*e.y;return this.x=i,this.y=o,this},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.wAdd=function(t,e,i,o){return void 0!==i||void 0!==o?this.addCombine(t,e,i,o):this.addMul(t,e)},t.prototype.addCombine=function(t,e,i,o){var s=t*e.x+i*o.x,n=t*e.y+i*o.y;return this.x+=s,this.y+=n,this},t.prototype.addMul=function(t,e){var i=t*e.x,o=t*e.y;return this.x+=i,this.y+=o,this},t.prototype.wSub=function(t,e,i,o){return void 0!==i||void 0!==o?this.subCombine(t,e,i,o):this.subMul(t,e)},t.prototype.subCombine=function(t,e,i,o){var s=t*e.x+i*o.x,n=t*e.y+i*o.y;return this.x-=s,this.y-=n,this},t.prototype.subMul=function(t,e){var i=t*e.x,o=t*e.y;return this.x-=i,this.y-=o,this},t.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.mul=function(t){return this.x*=t,this.y*=t,this},t.prototype.length=function(){return t.lengthOf(this)},t.prototype.lengthSquared=function(){return t.lengthSquared(this)},t.prototype.normalize=function(){var t=this.length();if(t<1e-9)return 0;var e=1/t;return this.x*=e,this.y*=e,t},t.normalize=function(e){var i=t.lengthOf(e);if(i<1e-9)return t.zero();var o=1/i;return t.neo(e.x*o,e.y*o)},t.lengthOf=function(t){return K(t.x*t.x+t.y*t.y)},t.lengthSquared=function(t){return t.x*t.x+t.y*t.y},t.distance=function(t,e){var i=t.x-e.x,o=t.y-e.y;return K(i*i+o*o)},t.distanceSquared=function(t,e){var i=t.x-e.x,o=t.y-e.y;return i*i+o*o},t.areEqual=function(t,e){return t===e||"object"==typeof e&&null!==e&&t.x===e.x&&t.y===e.y},t.skew=function(e){return t.neo(-e.y,e.x)},t.dot=function(t,e){return t.x*e.x+t.y*e.y},t.cross=function(e,i){return"number"==typeof i?t.neo(i*e.y,-i*e.x):"number"==typeof e?t.neo(-e*i.y,e*i.x):e.x*i.y-e.y*i.x},t.crossVec2Vec2=function(t,e){return t.x*e.y-t.y*e.x},t.crossVec2Num=function(e,i){return t.neo(i*e.y,-i*e.x)},t.crossNumVec2=function(e,i){return t.neo(-e*i.y,e*i.x)},t.addCross=function(e,i,o){return"number"==typeof o?t.neo(o*i.y+e.x,-o*i.x+e.y):"number"==typeof i?t.neo(-i*o.y+e.x,i*o.x+e.y):void 0},t.addCrossVec2Num=function(e,i,o){return t.neo(o*i.y+e.x,-o*i.x+e.y)},t.addCrossNumVec2=function(e,i,o){return t.neo(-i*o.y+e.x,i*o.x+e.y)},t.add=function(e,i){return t.neo(e.x+i.x,e.y+i.y)},t.wAdd=function(e,i,o,s){return void 0!==o||void 0!==s?t.combine(e,i,o,s):t.mulNumVec2(e,i)},t.combine=function(e,i,o,s){return t.zero().setCombine(e,i,o,s)},t.sub=function(e,i){return t.neo(e.x-i.x,e.y-i.y)},t.mul=function(e,i){return"object"==typeof e?t.neo(e.x*i,e.y*i):"object"==typeof i?t.neo(e*i.x,e*i.y):void 0},t.mulVec2Num=function(e,i){return t.neo(e.x*i,e.y*i)},t.mulNumVec2=function(e,i){return t.neo(e*i.x,e*i.y)},t.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this},t.neg=function(e){return t.neo(-e.x,-e.y)},t.abs=function(e){return t.neo(U(e.x),U(e.y))},t.mid=function(e,i){return t.neo((e.x+i.x)*.5,(e.y+i.y)*.5)},t.upper=function(e,i){return t.neo(Z(e.x,i.x),Z(e.y,i.y))},t.lower=function(e,i){return t.neo(X(e.x,i.x),X(e.y,i.y))},t.prototype.clamp=function(t){var e=this.x*this.x+this.y*this.y;if(e>t*t){var i=t/K(e);this.x*=i,this.y*=i}return this},t.clamp=function(e,i){var o=t.neo(e.x,e.y);return o.clamp(i),o},t.clampVec2=function(t,e,i){return{x:J(t.x,null==e?void 0:e.x,null==i?void 0:i.x),y:J(t.y,null==e?void 0:e.y,null==i?void 0:i.y)}},t.scaleFn=function(e,i){return function(o){return t.neo(o.x*e,o.y*i)}},t.translateFn=function(e,i){return function(o){return t.neo(o.x+e,o.y+i)}},t}(),$=Math.max,Q=Math.min,tt=function(){function t(e,i){if(!(this instanceof t))return new t(e,i);this.lowerBound=G.zero(),this.upperBound=G.zero(),"object"==typeof e&&this.lowerBound.setVec2(e),"object"==typeof i?this.upperBound.setVec2(i):"object"==typeof e&&this.upperBound.setVec2(e)}return t.prototype.isValid=function(){return t.isValid(this)},t.isValid=function(t){return null!=t&&G.isValid(t.lowerBound)&&G.isValid(t.upperBound)&&G.sub(t.upperBound,t.lowerBound).lengthSquared()>=0},t.assert=function(t){},t.prototype.getCenter=function(){return G.neo((this.lowerBound.x+this.upperBound.x)*.5,(this.lowerBound.y+this.upperBound.y)*.5)},t.prototype.getExtents=function(){return G.neo((this.upperBound.x-this.lowerBound.x)*.5,(this.upperBound.y-this.lowerBound.y)*.5)},t.prototype.getPerimeter=function(){return 2*(this.upperBound.x-this.lowerBound.x+this.upperBound.y-this.lowerBound.y)},t.prototype.combine=function(t,e){e=e||this;var i=t.lowerBound,o=t.upperBound,s=e.lowerBound,n=e.upperBound,r=Q(i.x,s.x),a=Q(i.y,s.y),m=$(n.x,o.x),h=$(n.y,o.y);this.lowerBound.setNum(r,a),this.upperBound.setNum(m,h)},t.prototype.combinePoints=function(t,e){this.lowerBound.setNum(Q(t.x,e.x),Q(t.y,e.y)),this.upperBound.setNum($(t.x,e.x),$(t.y,e.y))},t.prototype.set=function(t){this.lowerBound.setNum(t.lowerBound.x,t.lowerBound.y),this.upperBound.setNum(t.upperBound.x,t.upperBound.y)},t.prototype.contains=function(t){return this.lowerBound.x<=t.lowerBound.x&&this.lowerBound.y<=t.lowerBound.y&&t.upperBound.x<=this.upperBound.x&&t.upperBound.y<=this.upperBound.y},t.prototype.extend=function(e){return t.extend(this,e),this},t.extend=function(t,e){return t.lowerBound.x-=e,t.lowerBound.y-=e,t.upperBound.x+=e,t.upperBound.y+=e,t},t.testOverlap=function(t,e){var i=e.lowerBound.x-t.upperBound.x,o=t.lowerBound.x-e.upperBound.x,s=e.lowerBound.y-t.upperBound.y,n=t.lowerBound.y-e.upperBound.y;return!(i>0)&&!(s>0)&&!(o>0)&&!(n>0)},t.areEqual=function(t,e){return G.areEqual(t.lowerBound,e.lowerBound)&&G.areEqual(t.upperBound,e.upperBound)},t.diff=function(t,e){var i=$(0,Q(t.upperBound.x,e.upperBound.x)-$(e.lowerBound.x,t.lowerBound.x)),o=$(0,Q(t.upperBound.y,e.upperBound.y)-$(e.lowerBound.y,t.lowerBound.y));return(t.upperBound.x-t.lowerBound.x)*(t.upperBound.y-t.lowerBound.y)+(e.upperBound.x-e.lowerBound.x)*(e.upperBound.y-e.lowerBound.y)-i*o},t.prototype.rayCast=function(t,e){var i=-1/0,o=1/0,s=e.p1,n=G.sub(e.p2,e.p1),r=G.abs(n),a=G.zero();if(r.x<1e-9){if(s.x<this.lowerBound.x||this.upperBound.x<s.x)return!1}else{var m=1/n.x,h=(this.lowerBound.x-s.x)*m,c=(this.upperBound.x-s.x)*m,l=-1;if(h>c){var _=h;h=c,c=_,l=1}if(h>i&&(a.setZero(),a.x=l,i=h),i>(o=Q(o,c)))return!1}if(r.y<1e-9){if(s.y<this.lowerBound.y||this.upperBound.y<s.y)return!1}else{var m=1/n.y,h=(this.lowerBound.y-s.y)*m,c=(this.upperBound.y-s.y)*m,l=-1;if(h>c){var _=h;h=c,c=_,l=1}if(h>i&&(a.setZero(),a.y=l,i=h),i>(o=Q(o,c)))return!1}return!(i<0)&&!(e.maxFraction<i)&&(t.fraction=i,t.normal=a,!0)},t.prototype.toString=function(){return JSON.stringify(this)},t.combinePoints=function(t,e,i){return t.lowerBound.x=Q(e.x,i.x),t.lowerBound.y=Q(e.y,i.y),t.upperBound.x=$(e.x,i.x),t.upperBound.y=$(e.y,i.y),t},t.combinedPerimeter=function(t,e){var i=Q(t.lowerBound.x,e.lowerBound.x),o=Q(t.lowerBound.y,e.lowerBound.y);return 2*($(t.upperBound.x,e.upperBound.x)-i+$(t.upperBound.y,e.upperBound.y)-o)},t}(),te=Math.PI,ti=function(){function t(){}return Object.defineProperty(t,"polygonRadius",{get:function(){return 2*t.linearSlop},enumerable:!1,configurable:!0}),t.lengthUnitsPerMeter=1,t.maxManifoldPoints=2,t.maxPolygonVertices=12,t.aabbExtension=.1,t.aabbMultiplier=2,t.linearSlop=.005,t.angularSlop=2/180*te,t.maxSubSteps=8,t.maxTOIContacts=32,t.maxTOIIterations=20,t.maxDistanceIterations=20,t.velocityThreshold=1,t.maxLinearCorrection=.2,t.maxAngularCorrection=8/180*te,t.maxTranslation=2,t.maxRotation=.5*te,t.baumgarte=.2,t.toiBaugarte=.75,t.timeToSleep=.5,t.linearSleepTolerance=.01,t.angularSleepTolerance=2/180*te,t}(),to=function(){function t(){}return Object.defineProperty(t,"maxManifoldPoints",{get:function(){return ti.maxManifoldPoints},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxPolygonVertices",{get:function(){return ti.maxPolygonVertices},enumerable:!1,configurable:!0}),Object.defineProperty(t,"aabbExtension",{get:function(){return ti.aabbExtension*ti.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(t,"aabbMultiplier",{get:function(){return ti.aabbMultiplier},enumerable:!1,configurable:!0}),Object.defineProperty(t,"linearSlop",{get:function(){return ti.linearSlop*ti.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(t,"linearSlopSquared",{get:function(){return ti.linearSlop*ti.lengthUnitsPerMeter*ti.linearSlop*ti.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(t,"angularSlop",{get:function(){return ti.angularSlop},enumerable:!1,configurable:!0}),Object.defineProperty(t,"polygonRadius",{get:function(){return 2*ti.linearSlop},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxSubSteps",{get:function(){return ti.maxSubSteps},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxTOIContacts",{get:function(){return ti.maxTOIContacts},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxTOIIterations",{get:function(){return ti.maxTOIIterations},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxDistanceIterations",{get:function(){return ti.maxDistanceIterations},enumerable:!1,configurable:!0}),Object.defineProperty(t,"velocityThreshold",{get:function(){return ti.velocityThreshold*ti.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxLinearCorrection",{get:function(){return ti.maxLinearCorrection*ti.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxAngularCorrection",{get:function(){return ti.maxAngularCorrection},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxTranslation",{get:function(){return ti.maxTranslation*ti.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxTranslationSquared",{get:function(){return ti.maxTranslation*ti.lengthUnitsPerMeter*ti.maxTranslation*ti.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxRotation",{get:function(){return ti.maxRotation},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxRotationSquared",{get:function(){return ti.maxRotation*ti.maxRotation},enumerable:!1,configurable:!0}),Object.defineProperty(t,"baumgarte",{get:function(){return ti.baumgarte},enumerable:!1,configurable:!0}),Object.defineProperty(t,"toiBaugarte",{get:function(){return ti.toiBaugarte},enumerable:!1,configurable:!0}),Object.defineProperty(t,"timeToSleep",{get:function(){return ti.timeToSleep},enumerable:!1,configurable:!0}),Object.defineProperty(t,"linearSleepTolerance",{get:function(){return ti.linearSleepTolerance*ti.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(t,"linearSleepToleranceSqr",{get:function(){return ti.linearSleepTolerance*ti.lengthUnitsPerMeter*ti.linearSleepTolerance*ti.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(t,"angularSleepTolerance",{get:function(){return ti.angularSleepTolerance},enumerable:!1,configurable:!0}),Object.defineProperty(t,"angularSleepToleranceSqr",{get:function(){return ti.angularSleepTolerance*ti.angularSleepTolerance},enumerable:!1,configurable:!0}),t}(),ts=function(){function t(t){this._list=[],this._max=1/0,this._hasCreateFn=!1,this._createCount=0,this._hasAllocateFn=!1,this._allocateCount=0,this._hasReleaseFn=!1,this._releaseCount=0,this._hasDisposeFn=!1,this._disposeCount=0,this._list=[],this._max=t.max||this._max,this._createFn=t.create,this._hasCreateFn="function"==typeof this._createFn,this._allocateFn=t.allocate,this._hasAllocateFn="function"==typeof this._allocateFn,this._releaseFn=t.release,this._hasReleaseFn="function"==typeof this._releaseFn,this._disposeFn=t.dispose,this._hasDisposeFn="function"==typeof this._disposeFn}return t.prototype.max=function(t){return"number"==typeof t?(this._max=t,this):this._max},t.prototype.size=function(){return this._list.length},t.prototype.allocate=function(){var t;return this._list.length>0?t=this._list.shift():(this._createCount++,t=this._hasCreateFn?this._createFn():{}),this._allocateCount++,this._hasAllocateFn&&this._allocateFn(t),t},t.prototype.release=function(t){this._list.length<this._max?(this._releaseCount++,this._hasReleaseFn&&this._releaseFn(t),this._list.push(t)):(this._disposeCount++,this._hasDisposeFn&&(t=this._disposeFn(t)))},t.prototype.toString=function(){return" +"+this._createCount+" >"+this._allocateCount+" <"+this._releaseCount+" -"+this._disposeCount+" ="+this._list.length+"/"+this._max},t}(),tn=Math.abs,tr=Math.max,ta=function(){function t(t){this.aabb=new tt,this.userData=null,this.parent=null,this.child1=null,this.child2=null,this.height=-1,this.id=t}return t.prototype.toString=function(){return this.id+": "+this.userData},t.prototype.isLeaf=function(){return null==this.child1},t}(),tm=new ts({create:function(){return new ta},release:function(t){t.userData=null,t.parent=null,t.child1=null,t.child2=null,t.height=-1,t.id=void 0}}),th=function(){function t(){this.inputPool=new ts({create:function(){return{}},release:function(t){}}),this.stackPool=new ts({create:function(){return[]},release:function(t){t.length=0}}),this.iteratorPool=new ts({create:function(){return new tc},release:function(t){t.close()}}),this.m_root=null,this.m_nodes={},this.m_lastProxyId=0}return t.prototype.getUserData=function(t){return this.m_nodes[t].userData},t.prototype.getFatAABB=function(t){return this.m_nodes[t].aabb},t.prototype.allocateNode=function(){var t=tm.allocate();return t.id=++this.m_lastProxyId,this.m_nodes[t.id]=t,t},t.prototype.freeNode=function(t){delete this.m_nodes[t.id],tm.release(t)},t.prototype.createProxy=function(t,e){var i=this.allocateNode();return i.aabb.set(t),tt.extend(i.aabb,to.aabbExtension),i.userData=e,i.height=0,this.insertLeaf(i),i.id},t.prototype.destroyProxy=function(t){var e=this.m_nodes[t];this.removeLeaf(e),this.freeNode(e)},t.prototype.moveProxy=function(t,e,i){var o=this.m_nodes[t];return!o.aabb.contains(e)&&(this.removeLeaf(o),o.aabb.set(e),e=o.aabb,tt.extend(e,to.aabbExtension),i.x<0?e.lowerBound.x+=i.x*to.aabbMultiplier:e.upperBound.x+=i.x*to.aabbMultiplier,i.y<0?e.lowerBound.y+=i.y*to.aabbMultiplier:e.upperBound.y+=i.y*to.aabbMultiplier,this.insertLeaf(o),!0)},t.prototype.insertLeaf=function(t){if(null==this.m_root){this.m_root=t,this.m_root.parent=null;return}for(var e=t.aabb,i=this.m_root;!i.isLeaf();){var o=i.child1,s=i.child2,n=i.aabb.getPerimeter(),r=tt.combinedPerimeter(i.aabb,e),a=2*r,m=2*(r-n),h=tt.combinedPerimeter(e,o.aabb)+m;if(!o.isLeaf()){var c=o.aabb.getPerimeter();h-=c}var l=tt.combinedPerimeter(e,s.aabb)+m;if(!s.isLeaf()){var c=s.aabb.getPerimeter();l-=c}if(a<h&&a<l)break;i=h<l?o:s}var _=i,u=_.parent,p=this.allocateNode();for(p.parent=u,p.userData=null,p.aabb.combine(e,_.aabb),p.height=_.height+1,null!=u?(u.child1===_?u.child1=p:u.child2=p,p.child1=_,p.child2=t,_.parent=p,t.parent=p):(p.child1=_,p.child2=t,_.parent=p,t.parent=p,this.m_root=p),i=t.parent;null!=i;){var o=(i=this.balance(i)).child1,s=i.child2;i.height=1+tr(o.height,s.height),i.aabb.combine(o.aabb,s.aabb),i=i.parent}},t.prototype.removeLeaf=function(t){if(t===this.m_root){this.m_root=null;return}var e,i=t.parent,o=i.parent;if(e=i.child1===t?i.child2:i.child1,null!=o){o.child1===i?o.child1=e:o.child2=e,e.parent=o,this.freeNode(i);for(var s=o;null!=s;){var n=(s=this.balance(s)).child1,r=s.child2;s.aabb.combine(n.aabb,r.aabb),s.height=1+tr(n.height,r.height),s=s.parent}}else this.m_root=e,e.parent=null,this.freeNode(i)},t.prototype.balance=function(t){if(t.isLeaf()||t.height<2)return t;var e=t.child1,i=t.child2,o=i.height-e.height;if(o>1){var s=i.child1,n=i.child2;return i.child1=t,i.parent=t.parent,t.parent=i,null!=i.parent?i.parent.child1===t?i.parent.child1=i:i.parent.child2=i:this.m_root=i,s.height>n.height?(i.child2=s,t.child2=n,n.parent=t,t.aabb.combine(e.aabb,n.aabb),i.aabb.combine(t.aabb,s.aabb),t.height=1+tr(e.height,n.height),i.height=1+tr(t.height,s.height)):(i.child2=n,t.child2=s,s.parent=t,t.aabb.combine(e.aabb,s.aabb),i.aabb.combine(t.aabb,n.aabb),t.height=1+tr(e.height,s.height),i.height=1+tr(t.height,n.height)),i}if(o<-1){var r=e.child1,a=e.child2;return e.child1=t,e.parent=t.parent,t.parent=e,null!=e.parent?e.parent.child1===t?e.parent.child1=e:e.parent.child2=e:this.m_root=e,r.height>a.height?(e.child2=r,t.child1=a,a.parent=t,t.aabb.combine(i.aabb,a.aabb),e.aabb.combine(t.aabb,r.aabb),t.height=1+tr(i.height,a.height),e.height=1+tr(t.height,r.height)):(e.child2=a,t.child1=r,r.parent=t,t.aabb.combine(i.aabb,r.aabb),e.aabb.combine(t.aabb,a.aabb),t.height=1+tr(i.height,r.height),e.height=1+tr(t.height,a.height)),e}return t},t.prototype.getHeight=function(){return null==this.m_root?0:this.m_root.height},t.prototype.getAreaRatio=function(){if(null==this.m_root)return 0;for(var t,e=this.m_root.aabb.getPerimeter(),i=0,o=this.iteratorPool.allocate().preorder(this.m_root);t=o.next();)t.height<0||(i+=t.aabb.getPerimeter());return this.iteratorPool.release(o),i/e},t.prototype.computeHeight=function(t){var e;return(e=void 0!==t?this.m_nodes[t]:this.m_root).isLeaf()?0:1+tr(this.computeHeight(e.child1.id),this.computeHeight(e.child2.id))},t.prototype.validateStructure=function(t){if(null!=t){this.m_root;var e=t.child1,i=t.child2;t.isLeaf()||(this.validateStructure(e),this.validateStructure(i))}},t.prototype.validateMetrics=function(t){if(null!=t){var e=t.child1,i=t.child2;t.isLeaf()||(this.validateMetrics(e),this.validateMetrics(i))}},t.prototype.validate=function(){},t.prototype.getMaxBalance=function(){for(var t,e=0,i=this.iteratorPool.allocate().preorder(this.m_root);t=i.next();)t.height<=1||(e=tr(e,tn(t.child2.height-t.child1.height)));return this.iteratorPool.release(i),e},t.prototype.rebuildBottomUp=function(){for(var t,e=[],i=0,o=this.iteratorPool.allocate().preorder(this.m_root);t=o.next();)!(t.height<0)&&(t.isLeaf()?(t.parent=null,e[i]=t,++i):this.freeNode(t));for(this.iteratorPool.release(o);i>1;){for(var s=1/0,n=-1,r=-1,a=0;a<i;++a)for(var m=e[a].aabb,h=a+1;h<i;++h){var c=e[h].aabb,l=tt.combinedPerimeter(m,c);l<s&&(n=a,r=h,s=l)}var _=e[n],u=e[r],p=this.allocateNode();p.child1=_,p.child2=u,p.height=1+tr(_.height,u.height),p.aabb.combine(_.aabb,u.aabb),p.parent=null,_.parent=p,u.parent=p,e[r]=e[i-1],e[n]=p,--i}this.m_root=e[0]},t.prototype.shiftOrigin=function(t){for(var e,i=this.iteratorPool.allocate().preorder(this.m_root);e=i.next();){var o=e.aabb;o.lowerBound.x-=t.x,o.lowerBound.y-=t.y,o.upperBound.x-=t.x,o.upperBound.y-=t.y}this.iteratorPool.release(i)},t.prototype.query=function(t,e){var i=this.stackPool.allocate();for(i.push(this.m_root);i.length>0;){var o=i.pop();if(null!=o&&tt.testOverlap(o.aabb,t))if(o.isLeaf()){if(!1===e(o.id))return}else i.push(o.child1),i.push(o.child2)}this.stackPool.release(i)},t.prototype.rayCast=function(t,e){var i=t.p1,o=t.p2,s=G.sub(o,i);s.normalize();var n=G.crossNumVec2(1,s),r=G.abs(n),a=t.maxFraction,m=new tt,h=G.combine(1-a,i,a,o);m.combinePoints(i,h);var c=this.stackPool.allocate(),l=this.inputPool.allocate();for(c.push(this.m_root);c.length>0;){var _=c.pop();if(null!=_&&!1!==tt.testOverlap(_.aabb,m)){var u=_.aabb.getCenter(),p=_.aabb.getExtents();if(!(tn(G.dot(n,G.sub(i,u)))-G.dot(r,p)>0))if(_.isLeaf()){l.p1=G.clone(t.p1),l.p2=G.clone(t.p2),l.maxFraction=a;var y=e(l,_.id);if(0===y)break;y>0&&(a=y,h=G.combine(1-a,i,a,o),m.combinePoints(i,h))}else c.push(_.child1),c.push(_.child2)}}this.stackPool.release(c),this.inputPool.release(l)},t}(),tc=function(){function t(){this.parents=[],this.states=[]}return t.prototype.preorder=function(t){return this.parents.length=0,this.parents.push(t),this.states.length=0,this.states.push(0),this},t.prototype.next=function(){for(;this.parents.length>0;){var t=this.parents.length-1,e=this.parents[t];if(0===this.states[t])return this.states[t]=1,e;if(1===this.states[t]&&(this.states[t]=2,e.child1))return this.parents.push(e.child1),this.states.push(1),e.child1;if(2===this.states[t]&&(this.states[t]=3,e.child2))return this.parents.push(e.child2),this.states.push(1),e.child2;this.parents.pop(),this.states.pop()}},t.prototype.close=function(){this.parents.length=0},t}(),tl=Math.max,t_=Math.min,tu=function(){function t(){var t=this;this.m_tree=new th,this.m_moveBuffer=[],this.query=function(e,i){t.m_tree.query(e,i)},this.queryCallback=function(e){if(e===t.m_queryProxyId)return!0;var i=t_(e,t.m_queryProxyId),o=tl(e,t.m_queryProxyId),s=t.m_tree.getUserData(i),n=t.m_tree.getUserData(o);return t.m_callback(s,n),!0}}return t.prototype.getUserData=function(t){return this.m_tree.getUserData(t)},t.prototype.testOverlap=function(t,e){var i=this.m_tree.getFatAABB(t),o=this.m_tree.getFatAABB(e);return tt.testOverlap(i,o)},t.prototype.getFatAABB=function(t){return this.m_tree.getFatAABB(t)},t.prototype.getProxyCount=function(){return this.m_moveBuffer.length},t.prototype.getTreeHeight=function(){return this.m_tree.getHeight()},t.prototype.getTreeBalance=function(){return this.m_tree.getMaxBalance()},t.prototype.getTreeQuality=function(){return this.m_tree.getAreaRatio()},t.prototype.rayCast=function(t,e){this.m_tree.rayCast(t,e)},t.prototype.shiftOrigin=function(t){this.m_tree.shiftOrigin(t)},t.prototype.createProxy=function(t,e){var i=this.m_tree.createProxy(t,e);return this.bufferMove(i),i},t.prototype.destroyProxy=function(t){this.unbufferMove(t),this.m_tree.destroyProxy(t)},t.prototype.moveProxy=function(t,e,i){this.m_tree.moveProxy(t,e,i)&&this.bufferMove(t)},t.prototype.touchProxy=function(t){this.bufferMove(t)},t.prototype.bufferMove=function(t){this.m_moveBuffer.push(t)},t.prototype.unbufferMove=function(t){for(var e=0;e<this.m_moveBuffer.length;++e)this.m_moveBuffer[e]===t&&(this.m_moveBuffer[e]=null)},t.prototype.updatePairs=function(t){for(this.m_callback=t;this.m_moveBuffer.length>0;)if(this.m_queryProxyId=this.m_moveBuffer.pop(),null!==this.m_queryProxyId){var e=this.m_tree.getFatAABB(this.m_queryProxyId);this.m_tree.query(e,this.queryCallback)}},t}(),tp=Math.sin,ty=Math.cos,td=Math.sqrt;function tf(t,e){return{x:t,y:e}}function tv(t,e,i){return t.x=e,t.y=i,t}function tx(t,e){return t.x=e.x,t.y=e.y,t}function tA(t){return t.x=0,t.y=0,t}function tg(t){return t.x=-t.x,t.y=-t.y,t}function tb(t,e){return t.x+=e.x,t.y+=e.y,t}function tB(t,e){return t.x-=e.x,t.y-=e.y,t}function tw(t,e,i){return t.x=e.x-i.x,t.y=e.y-i.y,t}function tV(t,e){return t.x*=e,t.y*=e,t}function tC(t,e,i){return t.x=e*i.x,t.y=e*i.y,t}function tM(t,e,i){return t.x+=e*i.x,t.y+=e*i.y,t}function tI(t,e,i){return t.x-=e*i.x,t.y-=e*i.y,t}function tP(t,e,i,o,s){return t.x=e*i.x+o*s.x,t.y=e*i.y+o*s.y,t}function tz(t,e,i,o,s,n,r){return t.x=e*i.x+o*s.x+n*r.x,t.y=e*i.y+o*s.y+n*r.y,t}function tS(t){var e=td(t.x*t.x+t.y*t.y);if(e>0){var i=1/e;t.x*=i,t.y*=i}return t}function tF(t,e,i){var o=i*e.y,s=-i*e.x;return t.x=o,t.y=s,t}function tL(t,e,i){var o=-e*i.y,s=e*i.x;return t.x=o,t.y=s,t}function tT(t,e){return t.x*e.y-t.y*e.x}function tq(t,e){return t.x*e.x+t.y*e.y}function tk(t){return t.x*t.x+t.y*t.y}function tN(t,e){var i=t.x-e.x,o=t.y-e.y;return td(i*i+o*o)}function tj(t,e){var i=t.x-e.x,o=t.y-e.y;return i*i+o*o}function tD(t,e,i){return t.x=e.c*i.x-e.s*i.y,t.y=e.s*i.x+e.c*i.y,t}function tR(t,e,i){var o=e.c*i.x+e.s*i.y,s=-e.s*i.x+e.c*i.y;return t.x=o,t.y=s,t}function tO(t,e,i){return{p:tf(t,e),q:{s:tp(i),c:ty(i)}}}function tE(t,e){return t.p.x=e.p.x,t.p.y=e.p.y,t.q.s=e.q.s,t.q.c=e.q.c,t}function tY(t,e,i){var o=e.q.c*i.x-e.q.s*i.y+e.p.x,s=e.q.s*i.x+e.q.c*i.y+e.p.y;return t.x=o,t.y=s,t}function tW(t,e,i){var o=i.x-e.p.x,s=i.y-e.p.y,n=e.q.c*o+e.q.s*s,r=-e.q.s*o+e.q.c*s;return t.x=n,t.y=r,t}function tJ(t,e,i,o){var s=e.q.c*o.x-e.q.s*o.y+e.p.x,n=e.q.s*o.x+e.q.c*o.y+e.p.y,r=s-i.p.x,a=n-i.p.y,m=i.q.c*r+i.q.s*a,h=-i.q.s*r+i.q.c*a;return t.x=m,t.y=h,t}function tH(t,e,i){var o=e.q.c*i.q.c+e.q.s*i.q.s,s=e.q.c*i.q.s-e.q.s*i.q.c,n=e.q.c*(i.p.x-e.p.x)+e.q.s*(i.p.y-e.p.y),r=-e.q.s*(i.p.x-e.p.x)+e.q.c*(i.p.y-e.p.y);return t.q.c=o,t.q.s=s,t.p.x=n,t.p.y=r,t}var tU=Math.sin,tK=Math.cos,tZ=Math.atan2,tX=function(){function t(e){if(!(this instanceof t))return new t(e);"number"==typeof e?this.setAngle(e):"object"==typeof e?this.setRot(e):this.setIdentity()}return t.neo=function(e){var i=Object.create(t.prototype);return i.setAngle(e),i},t.clone=function(e){var i=Object.create(t.prototype);return i.s=e.s,i.c=e.c,i},t.identity=function(){var e=Object.create(t.prototype);return e.s=0,e.c=1,e},t.isValid=function(t){return null!=t&&Number.isFinite(t.s)&&Number.isFinite(t.c)},t.assert=function(t){},t.prototype.setIdentity=function(){this.s=0,this.c=1},t.prototype.set=function(t){"object"==typeof t?(this.s=t.s,this.c=t.c):(this.s=tU(t),this.c=tK(t))},t.prototype.setRot=function(t){this.s=t.s,this.c=t.c},t.prototype.setAngle=function(t){this.s=tU(t),this.c=tK(t)},t.prototype.getAngle=function(){return tZ(this.s,this.c)},t.prototype.getXAxis=function(){return G.neo(this.c,this.s)},t.prototype.getYAxis=function(){return G.neo(-this.s,this.c)},t.mul=function(e,i){if("c"in i&&"s"in i){var o=t.identity();return o.s=e.s*i.c+e.c*i.s,o.c=e.c*i.c-e.s*i.s,o}if("x"in i&&"y"in i)return G.neo(e.c*i.x-e.s*i.y,e.s*i.x+e.c*i.y)},t.mulRot=function(e,i){var o=t.identity();return o.s=e.s*i.c+e.c*i.s,o.c=e.c*i.c-e.s*i.s,o},t.mulVec2=function(t,e){return G.neo(t.c*e.x-t.s*e.y,t.s*e.x+t.c*e.y)},t.mulSub=function(t,e,i){var o=t.c*(e.x-i.x)-t.s*(e.y-i.y),s=t.s*(e.x-i.x)+t.c*(e.y-i.y);return G.neo(o,s)},t.mulT=function(e,i){if("c"in i&&"s"in i){var o=t.identity();return o.s=e.c*i.s-e.s*i.c,o.c=e.c*i.c+e.s*i.s,o}if("x"in i&&"y"in i)return G.neo(e.c*i.x+e.s*i.y,-e.s*i.x+e.c*i.y)},t.mulTRot=function(e,i){var o=t.identity();return o.s=e.c*i.s-e.s*i.c,o.c=e.c*i.c+e.s*i.s,o},t.mulTVec2=function(t,e){return G.neo(t.c*e.x+t.s*e.y,-t.s*e.x+t.c*e.y)},t}(),tG=Math.atan2,t$=Math.PI,tQ=tf(0,0),t0=function(){function t(){this.localCenter=G.zero(),this.c=G.zero(),this.a=0,this.alpha0=0,this.c0=G.zero(),this.a0=0}return t.prototype.recycle=function(){tA(this.localCenter),tA(this.c),this.a=0,this.alpha0=0,tA(this.c0),this.a0=0},t.prototype.setTransform=function(t){tY(tQ,t,this.localCenter),tx(this.c,tQ),tx(this.c0,tQ),this.a=this.a0=tG(t.q.s,t.q.c)},t.prototype.setLocalCenter=function(t,e){tx(this.localCenter,t),tY(tQ,e,this.localCenter),tx(this.c,tQ),tx(this.c0,tQ)},t.prototype.getTransform=function(t,e){var i,o;void 0===e&&(e=0),(i=t.q).c=ty(o=(1-e)*this.a0+e*this.a),i.s=tp(o),tP(t.p,1-e,this.c0,e,this.c),tB(t.p,tD(tQ,t.q,this.localCenter))},t.prototype.advance=function(t){var e=(t-this.alpha0)/(1-this.alpha0);tP(this.c0,e,this.c,1-e,this.c0),this.a0=e*this.a+(1-e)*this.a0,this.alpha0=t},t.prototype.forward=function(){this.a0=this.a,tx(this.c0,this.c)},t.prototype.normalize=function(){var t=W(this.a0,-t$,+t$);this.a-=this.a0-t,this.a0=t},t.prototype.set=function(t){tx(this.localCenter,t.localCenter),tx(this.c,t.c),this.a=t.a,this.alpha0=t.alpha0,tx(this.c0,t.c0),this.a0=t.a0},t}(),t1=function(){function t(e,i){if(!(this instanceof t))return new t(e,i);this.p=G.zero(),this.q=tX.identity(),void 0!==e&&this.p.setVec2(e),void 0!==i&&this.q.setAngle(i)}return t.clone=function(e){var i=Object.create(t.prototype);return i.p=G.clone(e.p),i.q=tX.clone(e.q),i},t.neo=function(e,i){var o=Object.create(t.prototype);return o.p=G.clone(e),o.q=tX.clone(i),o},t.identity=function(){var e=Object.create(t.prototype);return e.p=G.zero(),e.q=tX.identity(),e},t.prototype.setIdentity=function(){this.p.setZero(),this.q.setIdentity()},t.prototype.set=function(t,e){void 0===e?(this.p.set(t.p),this.q.set(t.q)):(this.p.set(t),this.q.set(e))},t.prototype.setNum=function(t,e){this.p.setVec2(t),this.q.setAngle(e)},t.prototype.setTransform=function(t){this.p.setVec2(t.p),this.q.setRot(t.q)},t.isValid=function(t){return null!=t&&G.isValid(t.p)&&tX.isValid(t.q)},t.assert=function(t){},t.mul=function(e,i){if(Array.isArray(i)){for(var o=[],s=0;s<i.length;s++)o[s]=t.mul(e,i[s]);return o}return"x"in i&&"y"in i?t.mulVec2(e,i):"p"in i&&"q"in i?t.mulXf(e,i):void 0},t.mulAll=function(e,i){for(var o=[],s=0;s<i.length;s++)o[s]=t.mul(e,i[s]);return o},t.mulFn=function(e){return function(i){return t.mul(e,i)}},t.mulVec2=function(t,e){var i=t.q.c*e.x-t.q.s*e.y+t.p.x,o=t.q.s*e.x+t.q.c*e.y+t.p.y;return G.neo(i,o)},t.mulXf=function(e,i){var o=t.identity();return o.q=tX.mulRot(e.q,i.q),o.p=G.add(tX.mulVec2(e.q,i.p),e.p),o},t.mulT=function(e,i){return"x"in i&&"y"in i?t.mulTVec2(e,i):"p"in i&&"q"in i?t.mulTXf(e,i):void 0},t.mulTVec2=function(t,e){var i=e.x-t.p.x,o=e.y-t.p.y,s=t.q.c*i+t.q.s*o,n=-t.q.s*i+t.q.c*o;return G.neo(s,n)},t.mulTXf=function(e,i){var o=t.identity();return o.q.setRot(tX.mulTRot(e.q,i.q)),o.p.setVec2(tX.mulTVec2(e.q,G.sub(i.p,e.p))),o},t}(),t2=function(){this.v=G.zero(),this.w=0},t3=Math.sin,t5=Math.cos,t9=function(){function t(){this.c=G.zero(),this.a=0}return t.prototype.getTransform=function(t,e){return t.q.c=t5(this.a),t.q.s=t3(this.a),t.p.x=this.c.x-(t.q.c*e.x-t.q.s*e.y),t.p.y=this.c.y-(t.q.s*e.x+t.q.c*e.y),t},t}();function t6(t,e,i,o){return t.q.c=t5(o),t.q.s=t3(o),t.p.x=i.x-(t.q.c*e.x-t.q.s*e.y),t.p.y=i.y-(t.q.s*e.x+t.q.c*e.y),t}var t8=function(){function t(){this.style={},this.appData={}}return t.isValid=function(t){return null!=t&&"string"==typeof t.m_type&&"number"==typeof t.m_radius},t}(),t4=new tt,t7=new tt,et=tf(0,0),ee={userData:null,friction:.2,restitution:0,density:0,isSensor:!1,filterGroupIndex:0,filterCategoryBits:1,filterMaskBits:65535},ei=function(t,e){this.aabb=new tt,this.fixture=t,this.childIndex=e},eo=function(){function t(t,e,i){this.style={},this.appData={},e.shape?(i=e,e=e.shape):"number"==typeof i&&(i={density:i}),i=O(i,ee),this.m_body=t,this.m_friction=i.friction,this.m_restitution=i.restitution,this.m_density=i.density,this.m_isSensor=i.isSensor,this.m_filterGroupIndex=i.filterGroupIndex,this.m_filterCategoryBits=i.filterCategoryBits,this.m_filterMaskBits=i.filterMaskBits,this.m_shape=e,this.m_next=null,this.m_proxies=[],this.m_proxyCount=0;for(var o=this.m_shape.getChildCount(),s=0;s<o;++s)this.m_proxies[s]=new ei(this,s);this.m_userData=i.userData,"object"==typeof i.style&&null!==i.style&&(this.style=i.style)}return t.prototype._reset=function(){var t=this.getBody(),e=t.m_world.m_broadPhase;this.destroyProxies(e),this.m_shape._reset&&this.m_shape._reset();for(var i=this.m_shape.getChildCount(),o=0;o<i;++o)this.m_proxies[o]=new ei(this,o);this.createProxies(e,t.m_xf),t.resetMassData()},t.prototype._serialize=function(){return{friction:this.m_friction,restitution:this.m_restitution,density:this.m_density,isSensor:this.m_isSensor,filterGroupIndex:this.m_filterGroupIndex,filterCategoryBits:this.m_filterCategoryBits,filterMaskBits:this.m_filterMaskBits,shape:this.m_shape}},t._deserialize=function(e,i,o){var s=o(t8,e.shape);return s&&new t(i,s,e)},t.prototype.getType=function(){return this.m_shape.m_type},t.prototype.getShape=function(){return this.m_shape},t.prototype.isSensor=function(){return this.m_isSensor},t.prototype.setSensor=function(t){t!=this.m_isSensor&&(this.m_body.setAwake(!0),this.m_isSensor=t)},t.prototype.getUserData=function(){return this.m_userData},t.prototype.setUserData=function(t){this.m_userData=t},t.prototype.getBody=function(){return this.m_body},t.prototype.getNext=function(){return this.m_next},t.prototype.getDensity=function(){return this.m_density},t.prototype.setDensity=function(t){this.m_density=t},t.prototype.getFriction=function(){return this.m_friction},t.prototype.setFriction=function(t){this.m_friction=t},t.prototype.getRestitution=function(){return this.m_restitution},t.prototype.setRestitution=function(t){this.m_restitution=t},t.prototype.testPoint=function(t){return this.m_shape.testPoint(this.m_body.getTransform(),t)},t.prototype.rayCast=function(t,e,i){return this.m_shape.rayCast(t,e,this.m_body.getTransform(),i)},t.prototype.getMassData=function(t){this.m_shape.computeMass(t,this.m_density)},t.prototype.getAABB=function(t){return this.m_proxies[t].aabb},t.prototype.createProxies=function(t,e){this.m_proxyCount=this.m_shape.getChildCount();for(var i=0;i<this.m_proxyCount;++i){var o=this.m_proxies[i];this.m_shape.computeAABB(o.aabb,e,i),o.proxyId=t.createProxy(o.aabb,o)}},t.prototype.destroyProxies=function(t){for(var e=0;e<this.m_proxyCount;++e){var i=this.m_proxies[e];t.destroyProxy(i.proxyId),i.proxyId=null}this.m_proxyCount=0},t.prototype.synchronize=function(t,e,i){for(var o=0;o<this.m_proxyCount;++o){var s=this.m_proxies[o];this.m_shape.computeAABB(t4,e,s.childIndex),this.m_shape.computeAABB(t7,i,s.childIndex),s.aabb.combine(t4,t7),tw(et,i.p,e.p),t.moveProxy(s.proxyId,s.aabb,et)}},t.prototype.setFilterData=function(t){this.m_filterGroupIndex=t.groupIndex,this.m_filterCategoryBits=t.categoryBits,this.m_filterMaskBits=t.maskBits,this.refilter()},t.prototype.getFilterGroupIndex=function(){return this.m_filterGroupIndex},t.prototype.setFilterGroupIndex=function(t){this.m_filterGroupIndex=t,this.refilter()},t.prototype.getFilterCategoryBits=function(){return this.m_filterCategoryBits},t.prototype.setFilterCategoryBits=function(t){this.m_filterCategoryBits=t,this.refilter()},t.prototype.getFilterMaskBits=function(){return this.m_filterMaskBits},t.prototype.setFilterMaskBits=function(t){this.m_filterMaskBits=t,this.refilter()},t.prototype.refilter=function(){if(null!=this.m_body){for(var t=this.m_body.getContactList();t;){var e=t.contact,i=e.getFixtureA(),o=e.getFixtureB();(i==this||o==this)&&e.flagForFiltering(),t=t.next}var s=this.m_body.getWorld();if(null!=s)for(var n=s.m_broadPhase,r=0;r<this.m_proxyCount;++r)n.touchProxy(this.m_proxies[r].proxyId)}},t.prototype.shouldCollide=function(t){if(t.m_filterGroupIndex===this.m_filterGroupIndex&&0!==t.m_filterGroupIndex)return t.m_filterGroupIndex>0;var e=(t.m_filterMaskBits&this.m_filterCategoryBits)!=0,i=(t.m_filterCategoryBits&this.m_filterMaskBits)!=0;return e&&i},t}(),es="static",en="kinematic",er="dynamic",ea=tf(0,0),em=tf(0,0),eh=tf(0,0),ec=tf(0,0),el=tO(0,0,0),e_={type:es,position:G.zero(),angle:0,linearVelocity:G.zero(),angularVelocity:0,linearDamping:0,angularDamping:0,fixedRotation:!1,bullet:!1,gravityScale:1,allowSleep:!0,awake:!0,active:!0,userData:null},eu=function(){function t(t,e){this.style={},this.appData={},e=O(e,e_),this.m_world=t,this.m_awakeFlag=e.awake,this.m_autoSleepFlag=e.allowSleep,this.m_bulletFlag=e.bullet,this.m_fixedRotationFlag=e.fixedRotation,this.m_activeFlag=e.active,this.m_islandFlag=!1,this.m_toiFlag=!1,this.m_userData=e.userData,this.m_type=e.type,this.m_type==er?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_xf=t1.identity(),this.m_xf.p.setVec2(e.position),this.m_xf.q.setAngle(e.angle),this.m_sweep=new t0,this.m_sweep.setTransform(this.m_xf),this.c_velocity=new t2,this.c_position=new t9,this.m_force=G.zero(),this.m_torque=0,this.m_linearVelocity=G.clone(e.linearVelocity),this.m_angularVelocity=e.angularVelocity,this.m_linearDamping=e.linearDamping,this.m_angularDamping=e.angularDamping,this.m_gravityScale=e.gravityScale,this.m_sleepTime=0,this.m_jointList=null,this.m_contactList=null,this.m_fixtureList=null,this.m_prev=null,this.m_next=null,this.m_destroyed=!1,"object"==typeof e.style&&null!==e.style&&(this.style=e.style)}return t.prototype._serialize=function(){for(var t=[],e=this.m_fixtureList;e;e=e.m_next)t.push(e);return{type:this.m_type,bullet:this.m_bulletFlag,position:this.m_xf.p,angle:this.m_xf.q.getAngle(),linearVelocity:this.m_linearVelocity,angularVelocity:this.m_angularVelocity,fixtures:t}},t._deserialize=function(e,i,o){var s=new t(i,e);if(e.fixtures)for(var n=e.fixtures.length-1;n>=0;n--){var r=o(eo,e.fixtures[n],s);s._addFixture(r)}return s},t.prototype.isWorldLocked=function(){return!!(this.m_world&&this.m_world.isLocked())},t.prototype.getWorld=function(){return this.m_world},t.prototype.getNext=function(){return this.m_next},t.prototype.setUserData=function(t){this.m_userData=t},t.prototype.getUserData=function(){return this.m_userData},t.prototype.getFixtureList=function(){return this.m_fixtureList},t.prototype.getJointList=function(){return this.m_jointList},t.prototype.getContactList=function(){return this.m_contactList},t.prototype.isStatic=function(){return this.m_type==es},t.prototype.isDynamic=function(){return this.m_type==er},t.prototype.isKinematic=function(){return this.m_type==en},t.prototype.setStatic=function(){return this.setType(es),this},t.prototype.setDynamic=function(){return this.setType(er),this},t.prototype.setKinematic=function(){return this.setType(en),this},t.prototype.getType=function(){return this.m_type},t.prototype.setType=function(t){if(!0!=this.isWorldLocked()&&this.m_type!=t){this.m_type=t,this.resetMassData(),this.m_type==es&&(this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_sweep.forward(),this.synchronizeFixtures()),this.setAwake(!0),this.m_force.setZero(),this.m_torque=0;for(var e=this.m_contactList;e;){var i=e;e=e.next,this.m_world.destroyContact(i.contact)}this.m_contactList=null;for(var o=this.m_world.m_broadPhase,s=this.m_fixtureList;s;s=s.m_next)for(var n=0;n<s.m_proxyCount;++n)o.touchProxy(s.m_proxies[n].proxyId)}},t.prototype.isBullet=function(){return this.m_bulletFlag},t.prototype.setBullet=function(t){this.m_bulletFlag=!!t},t.prototype.isSleepingAllowed=function(){return this.m_autoSleepFlag},t.prototype.setSleepingAllowed=function(t){this.m_autoSleepFlag=!!t,!1==this.m_autoSleepFlag&&this.setAwake(!0)},t.prototype.isAwake=function(){return this.m_awakeFlag},t.prototype.setAwake=function(t){t?(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_force.setZero(),this.m_torque=0)},t.prototype.isActive=function(){return this.m_activeFlag},t.prototype.setActive=function(t){if(t!=this.m_activeFlag)if(this.m_activeFlag=!!t,this.m_activeFlag){for(var e=this.m_world.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.createProxies(e,this.m_xf);this.m_world.m_newFixture=!0}else{for(var e=this.m_world.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.destroyProxies(e);for(var o=this.m_contactList;o;){var s=o;o=o.next,this.m_world.destroyContact(s.contact)}this.m_contactList=null}},t.prototype.isFixedRotation=function(){return this.m_fixedRotationFlag},t.prototype.setFixedRotation=function(t){this.m_fixedRotationFlag!=t&&(this.m_fixedRotationFlag=!!t,this.m_angularVelocity=0,this.resetMassData())},t.prototype.getTransform=function(){return this.m_xf},t.prototype.setTransform=function(t,e){if(!0!=this.isWorldLocked()){"number"==typeof e?this.m_xf.setNum(t,e):this.m_xf.setTransform(t),this.m_sweep.setTransform(this.m_xf);for(var i=this.m_world.m_broadPhase,o=this.m_fixtureList;o;o=o.m_next)o.synchronize(i,this.m_xf,this.m_xf);this.setAwake(!0)}},t.prototype.synchronizeTransform=function(){this.m_sweep.getTransform(this.m_xf,1)},t.prototype.synchronizeFixtures=function(){this.m_sweep.getTransform(el,0);for(var t=this.m_world.m_broadPhase,e=this.m_fixtureList;e;e=e.m_next)e.synchronize(t,el,this.m_xf)},t.prototype.advance=function(t){this.m_sweep.advance(t),tx(this.m_sweep.c,this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_sweep.getTransform(this.m_xf,1)},t.prototype.getPosition=function(){return this.m_xf.p},t.prototype.setPosition=function(t){this.setTransform(t,this.m_sweep.a)},t.prototype.getAngle=function(){return this.m_sweep.a},t.prototype.setAngle=function(t){this.setTransform(this.m_xf.p,t)},t.prototype.getWorldCenter=function(){return this.m_sweep.c},t.prototype.getLocalCenter=function(){return this.m_sweep.localCenter},t.prototype.getLinearVelocity=function(){return this.m_linearVelocity},t.prototype.getLinearVelocityFromWorldPoint=function(t){var e=G.sub(t,this.m_sweep.c);return G.add(this.m_linearVelocity,G.crossNumVec2(this.m_angularVelocity,e))},t.prototype.getLinearVelocityFromLocalPoint=function(t){return this.getLinearVelocityFromWorldPoint(this.getWorldPoint(t))},t.prototype.setLinearVelocity=function(t){this.m_type!=es&&(G.dot(t,t)>0&&this.setAwake(!0),this.m_linearVelocity.setVec2(t))},t.prototype.getAngularVelocity=function(){return this.m_angularVelocity},t.prototype.setAngularVelocity=function(t){this.m_type!=es&&(t*t>0&&this.setAwake(!0),this.m_angularVelocity=t)},t.prototype.getLinearDamping=function(){return this.m_linearDamping},t.prototype.setLinearDamping=function(t){this.m_linearDamping=t},t.prototype.getAngularDamping=function(){return this.m_angularDamping},t.prototype.setAngularDamping=function(t){this.m_angularDamping=t},t.prototype.getGravityScale=function(){return this.m_gravityScale},t.prototype.setGravityScale=function(t){this.m_gravityScale=t},t.prototype.getMass=function(){return this.m_mass},t.prototype.getInertia=function(){return this.m_I+this.m_mass*G.dot(this.m_sweep.localCenter,this.m_sweep.localCenter)},t.prototype.getMassData=function(t){t.mass=this.m_mass,t.I=this.getInertia(),tx(t.center,this.m_sweep.localCenter)},t.prototype.resetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,tA(this.m_sweep.localCenter),this.isStatic()||this.isKinematic()){tx(this.m_sweep.c0,this.m_xf.p),tx(this.m_sweep.c,this.m_xf.p),this.m_sweep.a0=this.m_sweep.a;return}tA(em);for(var t=this.m_fixtureList;t;t=t.m_next)if(0!=t.m_density){var e={mass:0,center:tf(0,0),I:0};t.getMassData(e),this.m_mass+=e.mass,tM(em,e.mass,e.center),this.m_I+=e.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,tC(em,this.m_invMass,em)):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&!1==this.m_fixedRotationFlag?(this.m_I-=this.m_mass*tq(em,em),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0),tx(ea,this.m_sweep.c),this.m_sweep.setLocalCenter(em,this.m_xf),tw(eh,this.m_sweep.c,ea),tL(ec,this.m_angularVelocity,eh),tb(this.m_linearVelocity,ec)},t.prototype.setMassData=function(t){!0==this.isWorldLocked()||this.m_type==er&&(this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=t.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,t.I>0&&!1==this.m_fixedRotationFlag&&(this.m_I=t.I-this.m_mass*tq(t.center,t.center),this.m_invI=1/this.m_I),tx(ea,this.m_sweep.c),this.m_sweep.setLocalCenter(t.center,this.m_xf),tw(eh,this.m_sweep.c,ea),tL(ec,this.m_angularVelocity,eh),tb(this.m_linearVelocity,ec))},t.prototype.applyForce=function(t,e,i){void 0===i&&(i=!0),this.m_type==er&&(i&&!1==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_force.add(t),this.m_torque+=G.crossVec2Vec2(G.sub(e,this.m_sweep.c),t)))},t.prototype.applyForceToCenter=function(t,e){void 0===e&&(e=!0),this.m_type==er&&(e&&!1==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&this.m_force.add(t))},t.prototype.applyTorque=function(t,e){void 0===e&&(e=!0),this.m_type==er&&(e&&!1==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_torque+=t))},t.prototype.applyLinearImpulse=function(t,e,i){void 0===i&&(i=!0),this.m_type==er&&(i&&!1==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.addMul(this.m_invMass,t),this.m_angularVelocity+=this.m_invI*G.crossVec2Vec2(G.sub(e,this.m_sweep.c),t)))},t.prototype.applyAngularImpulse=function(t,e){void 0===e&&(e=!0),this.m_type==er&&(e&&!1==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*t))},t.prototype.shouldCollide=function(t){if(this.m_type!=er&&t.m_type!=er)return!1;for(var e=this.m_jointList;e;e=e.next)if(e.other==t&&!1==e.joint.m_collideConnected)return!1;return!0},t.prototype._addFixture=function(t){if(!0==this.isWorldLocked())return null;if(this.m_activeFlag){var e=this.m_world.m_broadPhase;t.createProxies(e,this.m_xf)}return t.m_next=this.m_fixtureList,this.m_fixtureList=t,t.m_density>0&&this.resetMassData(),this.m_world.m_newFixture=!0,t},t.prototype.createFixture=function(t,e){if(!0==this.isWorldLocked())return null;var i=new eo(this,t,e);return this._addFixture(i),i},t.prototype.destroyFixture=function(t){if(!0!=this.isWorldLocked()){if(this.m_fixtureList===t)this.m_fixtureList=t.m_next;else for(var e=this.m_fixtureList;null!=e;){if(e.m_next===t){e.m_next=t.m_next;break}e=e.m_next}for(var i=this.m_contactList;i;){var o=i.contact;i=i.next;var s=o.getFixtureA(),n=o.getFixtureB();(t==s||t==n)&&this.m_world.destroyContact(o)}if(this.m_activeFlag){var r=this.m_world.m_broadPhase;t.destroyProxies(r)}t.m_body=null,t.m_next=null,this.m_world.publish("remove-fixture",t),this.resetMassData()}},t.prototype.getWorldPoint=function(t){return t1.mulVec2(this.m_xf,t)},t.prototype.getWorldVector=function(t){return tX.mulVec2(this.m_xf.q,t)},t.prototype.getLocalPoint=function(t){return t1.mulTVec2(this.m_xf,t)},t.prototype.getLocalVector=function(t){return tX.mulTVec2(this.m_xf.q,t)},t.STATIC="static",t.KINEMATIC="kinematic",t.DYNAMIC="dynamic",t}(),ep=function(){this.other=null,this.joint=null,this.prev=null,this.next=null},ey=function(){function t(t,e,i){this.m_type="unknown-joint",this.m_prev=null,this.m_next=null,this.m_edgeA=new ep,this.m_edgeB=new ep,this.m_islandFlag=!1,this.style={},this.appData={},e="bodyA"in t?t.bodyA:e,i="bodyB"in t?t.bodyB:i,this.m_bodyA=e,this.m_bodyB=i,this.m_collideConnected=!!t.collideConnected,this.m_userData=t.userData,"object"==typeof t.style&&null!==t.style&&(this.style=t.style)}return t.prototype.isActive=function(){return this.m_bodyA.isActive()&&this.m_bodyB.isActive()},t.prototype.getType=function(){return this.m_type},t.prototype.getBodyA=function(){return this.m_bodyA},t.prototype.getBodyB=function(){return this.m_bodyB},t.prototype.getNext=function(){return this.m_next},t.prototype.getUserData=function(){return this.m_userData},t.prototype.setUserData=function(t){this.m_userData=t},t.prototype.getCollideConnected=function(){return this.m_collideConnected},t.prototype.shiftOrigin=function(t){},t.prototype._resetAnchors=function(t){return this._reset(t)},t}(),ed={gjkCalls:0,gjkIters:0,gjkMaxIters:0,toiTime:0,toiMaxTime:0,toiCalls:0,toiIters:0,toiMaxIters:0,toiRootIters:0,toiMaxRootIters:0,toString:function(t){t="string"==typeof t?t:"\n";var e="";for(var i in this)"function"!=typeof this[i]&&"object"!=typeof this[i]&&(e+=i+": "+this[i]+t);return e}},ef=Math.max,ev=tf(0,0),ex=tf(0,0),eA=tf(0,0),eg=tf(0,0),eb=tf(0,0),eB=tf(0,0),ew=tf(0,0);ed.gjkCalls=0,ed.gjkIters=0,ed.gjkMaxIters=0;var eV=function(){function t(){this.proxyA=new eP,this.proxyB=new eP,this.transformA=t1.identity(),this.transformB=t1.identity(),this.useRadii=!1}return t.prototype.recycle=function(){this.proxyA.recycle(),this.proxyB.recycle(),this.transformA.setIdentity(),this.transformB.setIdentity(),this.useRadii=!1},t}(),eC=function(){function t(){this.pointA=tf(0,0),this.pointB=tf(0,0),this.distance=0,this.iterations=0}return t.prototype.recycle=function(){tA(this.pointA),tA(this.pointB),this.distance=0,this.iterations=0},t}(),eM=function(){function t(){this.metric=0,this.indexA=[],this.indexB=[],this.count=0}return t.prototype.recycle=function(){this.metric=0,this.indexA.length=0,this.indexB.length=0,this.count=0},t}(),eI=function(t,e,i){++ed.gjkCalls;var o=i.proxyA,s=i.proxyB,n=i.transformA,r=i.transformB;eL.recycle(),eL.readCache(e,o,n,s,r);for(var a=eL.m_v,m=to.maxDistanceIterations,h=[],c=[],l=0,_=0;_<m;){l=eL.m_count;for(var u=0;u<l;++u)h[u]=a[u].indexA,c[u]=a[u].indexB;if(eL.solve(),3===eL.m_count)break;var p=eL.getSearchDirection();if(tk(p)<1e-9*1e-9)break;var y=a[eL.m_count];y.indexA=o.getSupport(tR(ev,n.q,tC(ev,-1,p))),tY(y.wA,n,o.getVertex(y.indexA)),y.indexB=s.getSupport(tR(ev,r.q,p)),tY(y.wB,r,s.getVertex(y.indexB)),tw(y.w,y.wB,y.wA),++_,++ed.gjkIters;for(var d=!1,u=0;u<l;++u)if(y.indexA===h[u]&&y.indexB===c[u]){d=!0;break}if(d)break;++eL.m_count}if(ed.gjkMaxIters=ef(ed.gjkMaxIters,_),eL.getWitnessPoints(t.pointA,t.pointB),t.distance=tN(t.pointA,t.pointB),t.iterations=_,eL.writeCache(e),i.useRadii){var f=o.m_radius,v=s.m_radius;if(t.distance>f+v&&t.distance>1e-9)t.distance-=f+v,tw(ex,t.pointB,t.pointA),tS(ex),tM(t.pointA,f,ex),tI(t.pointB,v,ex);else{var x=tw(ev,t.pointA,t.pointB);tx(t.pointA,x),tx(t.pointB,x),t.distance=0}}},eP=function(){function t(){this.m_vertices=[],this.m_count=0,this.m_radius=0}return t.prototype.recycle=function(){this.m_vertices.length=0,this.m_count=0,this.m_radius=0},t.prototype.getVertexCount=function(){return this.m_count},t.prototype.getVertex=function(t){return this.m_vertices[t]},t.prototype.getSupport=function(t){for(var e=-1,i=-1/0,o=0;o<this.m_count;++o){var s=tq(this.m_vertices[o],t);s>i&&(e=o,i=s)}return e},t.prototype.getSupportVertex=function(t){return this.m_vertices[this.getSupport(t)]},t.prototype.set=function(t,e){t.computeDistanceProxy(this,e)},t.prototype.setVertices=function(t,e,i){this.m_vertices=t,this.m_count=e,this.m_radius=i},t}(),ez=function(){function t(){this.wA=tf(0,0),this.indexA=0,this.wB=tf(0,0),this.indexB=0,this.w=tf(0,0),this.a=0}return t.prototype.recycle=function(){this.indexA=0,this.indexB=0,tA(this.wA),tA(this.wB),tA(this.w),this.a=0},t.prototype.set=function(t){this.indexA=t.indexA,this.indexB=t.indexB,tx(this.wA,t.wA),tx(this.wB,t.wB),tx(this.w,t.w),this.a=t.a},t}(),eS=tf(0,0),eF=tf(0,0),eL=new(function(){function t(){this.m_v1=new ez,this.m_v2=new ez,this.m_v3=new ez,this.m_v=[this.m_v1,this.m_v2,this.m_v3]}return t.prototype.recycle=function(){this.m_v1.recycle(),this.m_v2.recycle(),this.m_v3.recycle(),this.m_count=0},t.prototype.toString=function(){return 3===this.m_count?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y,this.m_v3.a,this.m_v3.wA.x,this.m_v3.wA.y,this.m_v3.wB.x,this.m_v3.wB.y].toString():2===this.m_count?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y].toString():1===this.m_count?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y].toString():"+"+this.m_count},t.prototype.readCache=function(t,e,i,o,s){this.m_count=t.count;for(var n=0;n<this.m_count;++n){var r=this.m_v[n];r.indexA=t.indexA[n],r.indexB=t.indexB[n];var a=e.getVertex(r.indexA),m=o.getVertex(r.indexB);tY(r.wA,i,a),tY(r.wB,s,m),tw(r.w,r.wB,r.wA),r.a=0}if(this.m_count>1){var h=t.metric,c=this.getMetric();(c<.5*h||2*h<c||c<1e-9)&&(this.m_count=0)}if(0===this.m_count){var r=this.m_v[0];r.indexA=0,r.indexB=0;var a=e.getVertex(0),m=o.getVertex(0);tY(r.wA,i,a),tY(r.wB,s,m),tw(r.w,r.wB,r.wA),r.a=1,this.m_count=1}},t.prototype.writeCache=function(t){t.metric=this.getMetric(),t.count=this.m_count;for(var e=0;e<this.m_count;++e)t.indexA[e]=this.m_v[e].indexA,t.indexB[e]=this.m_v[e].indexB},t.prototype.getSearchDirection=function(){var t=this.m_v1,e=this.m_v2;switch(this.m_count){case 1:return tv(eS,-t.w.x,-t.w.y);case 2:if(tw(eA,e.w,t.w),-tT(eA,t.w)>0)return tv(eS,-eA.y,eA.x);return tv(eS,eA.y,-eA.x);default:return tA(eS)}},t.prototype.getClosestPoint=function(){var t=this.m_v1,e=this.m_v2;switch(this.m_count){case 0:case 3:default:return tA(eF);case 1:return tx(eF,t.w);case 2:return tP(eF,t.a,t.w,e.a,e.w)}},t.prototype.getWitnessPoints=function(t,e){var i=this.m_v1,o=this.m_v2,s=this.m_v3;switch(this.m_count){case 0:break;case 1:tx(t,i.wA),tx(e,i.wB);break;case 2:tP(t,i.a,i.wA,o.a,o.wA),tP(e,i.a,i.wB,o.a,o.wB);break;case 3:tz(t,i.a,i.wA,o.a,o.wA,s.a,s.wA),tx(e,t)}},t.prototype.getMetric=function(){switch(this.m_count){case 0:case 1:default:return 0;case 2:return tN(this.m_v1.w,this.m_v2.w);case 3:return tT(tw(eB,this.m_v2.w,this.m_v1.w),tw(ew,this.m_v3.w,this.m_v1.w))}},t.prototype.solve=function(){switch(this.m_count){case 1:break;case 2:this.solve2();break;case 3:this.solve3()}},t.prototype.solve2=function(){var t=this.m_v1.w,e=this.m_v2.w;tw(eA,e,t);var i=-tq(t,eA);if(i<=0){this.m_v1.a=1,this.m_count=1;return}var o=tq(e,eA);if(o<=0){this.m_v2.a=1,this.m_count=1,this.m_v1.set(this.m_v2);return}var s=1/(o+i);this.m_v1.a=o*s,this.m_v2.a=i*s,this.m_count=2},t.prototype.solve3=function(){var t=this.m_v1.w,e=this.m_v2.w,i=this.m_v3.w;tw(eA,e,t);var o=tq(t,eA),s=tq(e,eA),n=-o;tw(eg,i,t);var r=tq(t,eg),a=tq(i,eg),m=-r;tw(eb,i,e);var h=tq(e,eb),c=tq(i,eb),l=-h,_=tT(eA,eg),u=_*tT(e,i),p=_*tT(i,t),y=_*tT(t,e);if(n<=0&&m<=0){this.m_v1.a=1,this.m_count=1;return}if(s>0&&n>0&&y<=0){var d=1/(s+n);this.m_v1.a=s*d,this.m_v2.a=n*d,this.m_count=2;return}if(a>0&&m>0&&p<=0){var f=1/(a+m);this.m_v1.a=a*f,this.m_v3.a=m*f,this.m_count=2,this.m_v2.set(this.m_v3);return}if(s<=0&&l<=0){this.m_v2.a=1,this.m_count=1,this.m_v1.set(this.m_v2);return}if(a<=0&&c<=0){this.m_v3.a=1,this.m_count=1,this.m_v1.set(this.m_v3);return}if(c>0&&l>0&&u<=0){var v=1/(c+l);this.m_v2.a=c*v,this.m_v3.a=l*v,this.m_count=2,this.m_v1.set(this.m_v3);return}var x=1/(u+p+y);this.m_v1.a=u*x,this.m_v2.a=p*x,this.m_v3.a=y*x,this.m_count=3},t}()),eT=new eV,eq=new eM,ek=new eC,eN=function(t,e,i,o,s,n){return eT.recycle(),eT.proxyA.set(t,e),eT.proxyB.set(i,o),tE(eT.transformA,s),tE(eT.transformB,n),eT.useRadii=!0,ek.recycle(),eq.recycle(),eI(ek,eq,eT),ek.distance<1e-8};eI.testOverlap=eN,eI.Input=eV,eI.Output=eC,eI.Proxy=eP,eI.Cache=eM,(function(){this.proxyA=new eP,this.proxyB=new eP,this.transformA=t1.identity(),this.transformB=t1.identity(),this.translationB=G.zero()}).prototype.recycle=function(){this.proxyA.recycle(),this.proxyB.recycle(),this.transformA.setIdentity(),this.transformB.setIdentity(),tA(this.translationB)};var ej=Math.abs,eD=Math.max,eR=function(){function t(){this.proxyA=new eP,this.proxyB=new eP,this.sweepA=new t0,this.sweepB=new t0}return t.prototype.recycle=function(){this.proxyA.recycle(),this.proxyB.recycle(),this.sweepA.recycle(),this.sweepB.recycle(),this.tMax=-1},t}();(e=l||(l={}))[e.e_unset=-1]="e_unset",e[e.e_unknown=0]="e_unknown",e[e.e_failed=1]="e_failed",e[e.e_overlapped=2]="e_overlapped",e[e.e_touching=3]="e_touching",e[e.e_separated=4]="e_separated";var eO=function(){function t(){this.state=l.e_unset,this.t=-1}return t.prototype.recycle=function(){this.state=l.e_unset,this.t=-1},t}();ed.toiTime=0,ed.toiMaxTime=0,ed.toiCalls=0,ed.toiIters=0,ed.toiMaxIters=0,ed.toiRootIters=0,ed.toiMaxRootIters=0;var eE=new eV,eY=new eC,eW=new eM,eJ=tO(0,0,0),eH=tO(0,0,0),eU=tf(0,0),eK=tf(0,0),eZ=tf(0,0),eX=tf(0,0),eG=tf(0,0),e$=tf(0,0),eQ=tf(0,0),e0=tf(0,0),e1=function(t,e){var i,o=Date.now();++ed.toiCalls,t.state=l.e_unknown,t.t=e.tMax;var s=e.proxyA,n=e.proxyB,r=e.sweepA,a=e.sweepB;r.normalize(),a.normalize();var m=e.tMax,h=s.m_radius+n.m_radius,c=eD(to.linearSlop,h-3*to.linearSlop),_=.25*to.linearSlop,u=0,p=to.maxTOIIterations,y=0;for(eW.recycle(),eE.proxyA.setVertices(s.m_vertices,s.m_count,s.m_radius),eE.proxyB.setVertices(n.m_vertices,n.m_count,n.m_radius),eE.useRadii=!1;;){if(r.getTransform(eJ,u),a.getTransform(eH,u),tE(eE.transformA,eJ),tE(eE.transformB,eH),eI(eY,eW,eE),eY.distance<=0){t.state=l.e_overlapped,t.t=0;break}if(eY.distance<c+_){t.state=l.e_touching,t.t=u;break}e2.initialize(eW,s,r,n,a,u);for(var d=!1,f=m,v=0;;){var x=e2.findMinSeparation(f);if(x>c+_){t.state=l.e_separated,t.t=m,d=!0;break}if(x>c-_){u=f;break}var A=e2.evaluate(u);if(A<c-_){t.state=l.e_failed,t.t=u,d=!0;break}if(A<=c+_){t.state=l.e_touching,t.t=u,d=!0;break}for(var g=0,b=u,B=f;;){var w=void 0;w=1&g?b+(c-A)*(B-b)/(x-A):.5*(b+B),++g,++ed.toiRootIters;var V=e2.evaluate(w);if(ej(V-c)<_){f=w;break}if(V>c?(b=w,A=V):(B=w,x=V),50===g)break}if(ed.toiMaxRootIters=eD(ed.toiMaxRootIters,g),++v===to.maxPolygonVertices)break}if(++y,++ed.toiIters,d)break;if(y===p){t.state=l.e_failed,t.t=u;break}}ed.toiMaxIters=eD(ed.toiMaxIters,y);var C=(i=o,Date.now()-i);ed.toiMaxTime=eD(ed.toiMaxTime,C),ed.toiTime+=C,e2.recycle()};(i=_||(_={}))[i.e_unset=-1]="e_unset",i[i.e_points=1]="e_points",i[i.e_faceA=2]="e_faceA",i[i.e_faceB=3]="e_faceB";var e2=new(function(){function t(){this.m_proxyA=null,this.m_proxyB=null,this.m_sweepA=null,this.m_sweepB=null,this.m_type=_.e_unset,this.m_localPoint=tf(0,0),this.m_axis=tf(0,0),this.indexA=-1,this.indexB=-1}return t.prototype.recycle=function(){this.m_proxyA=null,this.m_proxyB=null,this.m_sweepA=null,this.m_sweepB=null,this.m_type=_.e_unset,tA(this.m_localPoint),tA(this.m_axis),this.indexA=-1,this.indexB=-1},t.prototype.initialize=function(t,e,i,o,s,n){var r=t.count;if(this.m_proxyA=e,this.m_proxyB=o,this.m_sweepA=i,this.m_sweepB=s,this.m_sweepA.getTransform(eJ,n),this.m_sweepB.getTransform(eH,n),1===r){this.m_type=_.e_points;var a=this.m_proxyA.getVertex(t.indexA[0]),m=this.m_proxyB.getVertex(t.indexB[0]);tY(eK,eJ,a),tY(eZ,eH,m),tw(this.m_axis,eZ,eK);var h=function(t){var e=td(t.x*t.x+t.y*t.y);if(0!==e){var i=1/e;t.x*=i,t.y*=i}return e}(this.m_axis);return h}if(t.indexA[0]===t.indexA[1]){this.m_type=_.e_faceB;var c=o.getVertex(t.indexB[0]),l=o.getVertex(t.indexB[1]);tF(this.m_axis,tw(eU,l,c),1),tS(this.m_axis),tD(eX,eH.q,this.m_axis),tP(this.m_localPoint,.5,c,.5,l),tY(eZ,eH,this.m_localPoint);var u=e.getVertex(t.indexA[0]),h=tq(t1.mulVec2(eJ,u),eX)-tq(eZ,eX);return h<0&&(tg(this.m_axis),h=-h),h}this.m_type=_.e_faceA;var p=this.m_proxyA.getVertex(t.indexA[0]),y=this.m_proxyA.getVertex(t.indexA[1]);tF(this.m_axis,tw(eU,y,p),1),tS(this.m_axis),tD(eX,eJ.q,this.m_axis),tP(this.m_localPoint,.5,p,.5,y),tY(eK,eJ,this.m_localPoint),tY(eZ,eH,this.m_proxyB.getVertex(t.indexB[0]));var h=tq(eZ,eX)-tq(eK,eX);return h<0&&(tg(this.m_axis),h=-h),h},t.prototype.compute=function(t,e){switch(this.m_sweepA.getTransform(eJ,e),this.m_sweepB.getTransform(eH,e),this.m_type){case _.e_points:t&&(tR(eG,eJ.q,this.m_axis),tR(e$,eH.q,tC(eU,-1,this.m_axis)),this.indexA=this.m_proxyA.getSupport(eG),this.indexB=this.m_proxyB.getSupport(e$)),tx(eQ,this.m_proxyA.getVertex(this.indexA)),tx(e0,this.m_proxyB.getVertex(this.indexB)),tY(eK,eJ,eQ),tY(eZ,eH,e0);var i=tq(eZ,this.m_axis)-tq(eK,this.m_axis);return i;case _.e_faceA:tD(eX,eJ.q,this.m_axis),tY(eK,eJ,this.m_localPoint),t&&(tR(e$,eH.q,tC(eU,-1,eX)),this.indexA=-1,this.indexB=this.m_proxyB.getSupport(e$)),tx(e0,this.m_proxyB.getVertex(this.indexB)),tY(eZ,eH,e0);var i=tq(eZ,eX)-tq(eK,eX);return i;case _.e_faceB:tD(eX,eH.q,this.m_axis),tY(eZ,eH,this.m_localPoint),t&&(tR(eG,eJ.q,tC(eU,-1,eX)),this.indexB=-1,this.indexA=this.m_proxyA.getSupport(eG)),tx(eQ,this.m_proxyA.getVertex(this.indexA)),tY(eK,eJ,eQ);var i=tq(eK,eX)-tq(eZ,eX);return i;default:return t&&(this.indexA=-1,this.indexB=-1),0}},t.prototype.findMinSeparation=function(t){return this.compute(!0,t)},t.prototype.evaluate=function(t){return this.compute(!1,t)},t}());e1.Input=eR,e1.Output=eO;var e3=Math.abs,e5=Math.sqrt,e9=Math.min,e6=function(){function t(){this.dt=0,this.inv_dt=0,this.velocityIterations=0,this.positionIterations=0,this.warmStarting=!1,this.blockSolve=!0,this.inv_dt0=0,this.dtRatio=1}return t.prototype.reset=function(t){this.dt>0&&(this.inv_dt0=this.inv_dt),this.dt=t,this.inv_dt=0==t?0:1/t,this.dtRatio=t*this.inv_dt0},t}(),e8=new e6,e4=tf(0,0),e7=tf(0,0),it=tf(0,0),ie=new eR,ii=new eO,io=new t0,is=new t0,ir=new t0,ia=function(){function t(t){this.contact=t,this.normals=[],this.tangents=[]}return t.prototype.recycle=function(){this.normals.length=0,this.tangents.length=0},Object.defineProperty(t.prototype,"normalImpulses",{get:function(){var t=this.contact,e=this.normals;e.length=0;for(var i=0;i<t.v_points.length;++i)e.push(t.v_points[i].normalImpulse);return e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tangentImpulses",{get:function(){var t=this.contact,e=this.tangents;e.length=0;for(var i=0;i<t.v_points.length;++i)e.push(t.v_points[i].tangentImpulse);return e},enumerable:!1,configurable:!0}),t}(),im=function(){function t(t){this.m_world=t,this.m_stack=[],this.m_bodies=[],this.m_contacts=[],this.m_joints=[]}return t.prototype.clear=function(){this.m_stack.length=0,this.m_bodies.length=0,this.m_contacts.length=0,this.m_joints.length=0},t.prototype.addBody=function(t){this.m_bodies.push(t)},t.prototype.addContact=function(t){this.m_contacts.push(t)},t.prototype.addJoint=function(t){this.m_joints.push(t)},t.prototype.solveWorld=function(t){for(var e=this.m_world,i=e.m_bodyList;i;i=i.m_next)i.m_islandFlag=!1;for(var o=e.m_contactList;o;o=o.m_next)o.m_islandFlag=!1;for(var s=e.m_jointList;s;s=s.m_next)s.m_islandFlag=!1;for(var n=this.m_stack,r=e.m_bodyList;r;r=r.m_next)if(!r.m_islandFlag&&!1!=r.isAwake()&&!1!=r.isActive()&&!r.isStatic()){for(this.clear(),n.push(r),r.m_islandFlag=!0;n.length>0;){var i=n.pop();if(this.addBody(i),i.m_awakeFlag=!0,!i.isStatic()){for(var a=i.m_contactList;a;a=a.next){var m=a.contact;if(!m.m_islandFlag&&!1!=m.isEnabled()&&!1!=m.isTouching()){var h=m.m_fixtureA.m_isSensor,c=m.m_fixtureB.m_isSensor;if(!h&&!c){this.addContact(m),m.m_islandFlag=!0;var l=a.other;l.m_islandFlag||(n.push(l),l.m_islandFlag=!0)}}}for(var _=i.m_jointList;_;_=_.next){if(!0!=_.joint.m_islandFlag){var l=_.other;!1!=l.isActive()&&(this.addJoint(_.joint),_.joint.m_islandFlag=!0,l.m_islandFlag||(n.push(l),l.m_islandFlag=!0))}}}}this.solveIsland(t);for(var u=0;u<this.m_bodies.length;++u){var i=this.m_bodies[u];i.isStatic()&&(i.m_islandFlag=!1)}}},t.prototype.solveIsland=function(t){for(var e=this.m_world,i=e.m_gravity,o=e.m_allowSleep,s=t.dt,n=0;n<this.m_bodies.length;++n){var r=this.m_bodies[n];tx(e4,r.m_sweep.c);var a=r.m_sweep.a;tx(e7,r.m_linearVelocity);var m=r.m_angularVelocity;tx(r.m_sweep.c0,r.m_sweep.c),r.m_sweep.a0=r.m_sweep.a,r.isDynamic()&&(tM(e7,s*r.m_gravityScale,i),tM(e7,s*r.m_invMass,r.m_force),m+=s*r.m_invI*r.m_torque,tC(e7,1/(1+s*r.m_linearDamping),e7),m*=1/(1+s*r.m_angularDamping)),tx(r.c_position.c,e4),r.c_position.a=a,tx(r.c_velocity.v,e7),r.c_velocity.w=m}for(var n=0;n<this.m_contacts.length;++n){var h=this.m_contacts[n];h.initConstraint(t)}for(var n=0;n<this.m_contacts.length;++n){var h=this.m_contacts[n];h.initVelocityConstraint(t)}if(t.warmStarting)for(var n=0;n<this.m_contacts.length;++n){var h=this.m_contacts[n];h.warmStartConstraint(t)}for(var n=0;n<this.m_joints.length;++n){var c=this.m_joints[n];c.initVelocityConstraints(t)}for(var n=0;n<t.velocityIterations;++n){for(var l=0;l<this.m_joints.length;++l){var c=this.m_joints[l];c.solveVelocityConstraints(t)}for(var l=0;l<this.m_contacts.length;++l){var h=this.m_contacts[l];h.solveVelocityConstraint(t)}}for(var n=0;n<this.m_contacts.length;++n){var h=this.m_contacts[n];h.storeConstraintImpulses(t)}for(var n=0;n<this.m_bodies.length;++n){var r=this.m_bodies[n];tx(e4,r.c_position.c);var a=r.c_position.a;tx(e7,r.c_velocity.v);var m=r.c_velocity.w;tC(it,s,e7);var _=tk(it);if(_>to.maxTranslationSquared){var u=to.maxTranslation/e5(_);tV(e7,u)}var p=s*m;if(p*p>to.maxRotationSquared){var u=to.maxRotation/e3(p);m*=u}tM(e4,s,e7),a+=s*m,tx(r.c_position.c,e4),r.c_position.a=a,tx(r.c_velocity.v,e7),r.c_velocity.w=m}for(var y=!1,n=0;n<t.positionIterations;++n){for(var d=0,l=0;l<this.m_contacts.length;++l){var h=this.m_contacts[l];d=e9(d,h.solvePositionConstraint(t))}for(var f=d>=-3*to.linearSlop,v=!0,l=0;l<this.m_joints.length;++l){var c=this.m_joints[l],x=c.solvePositionConstraints(t);v=v&&x}if(f&&v){y=!0;break}}for(var n=0;n<this.m_bodies.length;++n){var r=this.m_bodies[n];tx(r.m_sweep.c,r.c_position.c),r.m_sweep.a=r.c_position.a,tx(r.m_linearVelocity,r.c_velocity.v),r.m_angularVelocity=r.c_velocity.w,r.synchronizeTransform()}if(this.postSolveIsland(),o){for(var A=1/0,g=to.linearSleepToleranceSqr,b=to.angularSleepToleranceSqr,n=0;n<this.m_bodies.length;++n){var r=this.m_bodies[n];r.isStatic()||(!1==r.m_autoSleepFlag||r.m_angularVelocity*r.m_angularVelocity>b||tk(r.m_linearVelocity)>g?(r.m_sleepTime=0,A=0):(r.m_sleepTime+=s,A=e9(A,r.m_sleepTime)))}if(A>=to.timeToSleep&&y)for(var n=0;n<this.m_bodies.length;++n){var r=this.m_bodies[n];r.setAwake(!1)}}},t.prototype.solveWorldTOI=function(t){var e=this.m_world;if(e.m_stepComplete){for(var i=e.m_bodyList;i;i=i.m_next)i.m_islandFlag=!1,i.m_sweep.alpha0=0;for(var o=e.m_contactList;o;o=o.m_next)o.m_toiFlag=!1,o.m_islandFlag=!1,o.m_toiCount=0,o.m_toi=1}for(;;){for(var s=null,n=1,r=e.m_contactList;r;r=r.m_next)if(!1!=r.isEnabled()&&!(r.m_toiCount>to.maxSubSteps)){var a=1;if(r.m_toiFlag)a=r.m_toi;else{var m=r.getFixtureA(),h=r.getFixtureB();if(m.isSensor()||h.isSensor())continue;var c=m.getBody(),_=h.getBody(),u=c.isAwake()&&!c.isStatic(),p=_.isAwake()&&!_.isStatic();if(!1==u&&!1==p)continue;var y=c.isBullet()||!c.isDynamic(),d=_.isBullet()||!_.isDynamic();if(!1==y&&!1==d)continue;var f=c.m_sweep.alpha0;c.m_sweep.alpha0<_.m_sweep.alpha0?(f=_.m_sweep.alpha0,c.m_sweep.advance(f)):_.m_sweep.alpha0<c.m_sweep.alpha0&&(f=c.m_sweep.alpha0,_.m_sweep.advance(f));var v=r.getChildIndexA(),x=r.getChildIndexB();ie.proxyA.set(m.getShape(),v),ie.proxyB.set(h.getShape(),x),ie.sweepA.set(c.m_sweep),ie.sweepB.set(_.m_sweep),ie.tMax=1,e1(ii,ie);var A=ii.t;a=ii.state==l.e_touching?e9(f+(1-f)*A,1):1,r.m_toi=a,r.m_toiFlag=!0}a<n&&(s=r,n=a)}if(null==s||.99999999<n){e.m_stepComplete=!0;break}var g=s.getFixtureA(),b=s.getFixtureB(),B=g.getBody(),w=b.getBody();if(is.set(B.m_sweep),ir.set(w.m_sweep),B.advance(n),w.advance(n),s.update(e),s.m_toiFlag=!1,++s.m_toiCount,!1==s.isEnabled()||!1==s.isTouching()){s.setEnabled(!1),B.m_sweep.set(is),w.m_sweep.set(ir),B.synchronizeTransform(),w.synchronizeTransform();continue}B.setAwake(!0),w.setAwake(!0),this.clear(),this.addBody(B),this.addBody(w),this.addContact(s),B.m_islandFlag=!0,w.m_islandFlag=!0,s.m_islandFlag=!0;for(var V=[B,w],C=0;C<V.length;++C){var M=V[C];if(M.isDynamic())for(var I=M.m_contactList;I;I=I.next){var P=I.contact;if(P.m_islandFlag)continue;var z=I.other;if(!z.isDynamic()||M.isBullet()||z.isBullet()){var S=P.m_fixtureA.m_isSensor,F=P.m_fixtureB.m_isSensor;if(!S&&!F){if(io.set(z.m_sweep),!1==z.m_islandFlag&&z.advance(n),P.update(e),!1==P.isEnabled()||!1==P.isTouching()){z.m_sweep.set(io),z.synchronizeTransform();continue}P.m_islandFlag=!0,this.addContact(P),z.m_islandFlag||(z.m_islandFlag=!0,z.isStatic()||z.setAwake(!0),this.addBody(z))}}}}e8.reset((1-n)*t.dt),e8.dtRatio=1,e8.positionIterations=20,e8.velocityIterations=t.velocityIterations,e8.warmStarting=!1,this.solveIslandTOI(e8,B,w);for(var C=0;C<this.m_bodies.length;++C){var M=this.m_bodies[C];if(M.m_islandFlag=!1,M.isDynamic()){M.synchronizeFixtures();for(var I=M.m_contactList;I;I=I.next)I.contact.m_toiFlag=!1,I.contact.m_islandFlag=!1}}if(e.findNewContacts(),e.m_subStepping){e.m_stepComplete=!1;break}}},t.prototype.solveIslandTOI=function(t,e,i){for(var o,o=0;o<this.m_bodies.length;++o){var s=this.m_bodies[o];tx(s.c_position.c,s.m_sweep.c),s.c_position.a=s.m_sweep.a,tx(s.c_velocity.v,s.m_linearVelocity),s.c_velocity.w=s.m_angularVelocity}for(var o=0;o<this.m_contacts.length;++o){var n=this.m_contacts[o];n.initConstraint(t)}for(var o=0;o<t.positionIterations;++o){for(var r=0,a=0;a<this.m_contacts.length;++a){var n=this.m_contacts[a];r=e9(r,n.solvePositionConstraintTOI(t,e,i))}if(r>=-1.5*to.linearSlop)break}tx(e.m_sweep.c0,e.c_position.c),e.m_sweep.a0=e.c_position.a,tx(i.m_sweep.c0,i.c_position.c),i.m_sweep.a0=i.c_position.a;for(var o=0;o<this.m_contacts.length;++o){var n=this.m_contacts[o];n.initVelocityConstraint(t)}for(var o=0;o<t.velocityIterations;++o)for(var a=0;a<this.m_contacts.length;++a){var n=this.m_contacts[a];n.solveVelocityConstraint(t)}for(var m=t.dt,o=0;o<this.m_bodies.length;++o){var s=this.m_bodies[o];tx(e4,s.c_position.c);var h=s.c_position.a;tx(e7,s.c_velocity.v);var c=s.c_velocity.w;tC(it,m,e7);var l=tk(it);if(l>to.maxTranslationSquared){var _=to.maxTranslation/e5(l);tV(e7,_)}var u=m*c;if(u*u>to.maxRotationSquared){var _=to.maxRotation/e3(u);c*=_}tM(e4,m,e7),h+=m*c,tx(s.c_position.c,e4),s.c_position.a=h,tx(s.c_velocity.v,e7),s.c_velocity.w=c,tx(s.m_sweep.c,e4),s.m_sweep.a=h,tx(s.m_linearVelocity,e7),s.m_angularVelocity=c,s.synchronizeTransform()}this.postSolveIsland()},t.prototype.postSolveIsland=function(){for(var t=0;t<this.m_contacts.length;++t){var e=this.m_contacts[t];this.m_world.postSolve(e,e.m_impulse)}},t}();im.TimeStep=e6;var ih=function(){function t(t,e,i,o){"object"==typeof t&&null!==t?(this.ex=G.clone(t),this.ey=G.clone(e)):"number"==typeof t?(this.ex=G.neo(t,i),this.ey=G.neo(e,o)):(this.ex=G.zero(),this.ey=G.zero())}return t.prototype.toString=function(){return JSON.stringify(this)},t.isValid=function(t){return null!=t&&G.isValid(t.ex)&&G.isValid(t.ey)},t.assert=function(t){},t.prototype.set=function(t,e,i,o){"number"==typeof t&&"number"==typeof e&&"number"==typeof i&&"number"==typeof o?(this.ex.setNum(t,i),this.ey.setNum(e,o)):"object"==typeof t&&"object"==typeof e?(this.ex.setVec2(t),this.ey.setVec2(e)):"object"==typeof t&&(this.ex.setVec2(t.ex),this.ey.setVec2(t.ey))},t.prototype.setIdentity=function(){this.ex.x=1,this.ey.x=0,this.ex.y=0,this.ey.y=1},t.prototype.setZero=function(){this.ex.x=0,this.ey.x=0,this.ex.y=0,this.ey.y=0},t.prototype.getInverse=function(){var e=this.ex.x,i=this.ey.x,o=this.ex.y,s=this.ey.y,n=e*s-i*o;0!==n&&(n=1/n);var r=new t;return r.ex.x=n*s,r.ey.x=-n*i,r.ex.y=-n*o,r.ey.y=n*e,r},t.prototype.solve=function(t){var e=this.ex.x,i=this.ey.x,o=this.ex.y,s=this.ey.y,n=e*s-i*o;0!==n&&(n=1/n);var r=G.zero();return r.x=n*(s*t.x-i*t.y),r.y=n*(e*t.y-o*t.x),r},t.mul=function(e,i){if(i&&"x"in i&&"y"in i){var o=e.ex.x*i.x+e.ey.x*i.y,s=e.ex.y*i.x+e.ey.y*i.y;return G.neo(o,s)}if(i&&"ex"in i&&"ey"in i)return new t(e.ex.x*i.ex.x+e.ey.x*i.ex.y,e.ex.x*i.ey.x+e.ey.x*i.ey.y,e.ex.y*i.ex.x+e.ey.y*i.ex.y,e.ex.y*i.ey.x+e.ey.y*i.ey.y)},t.mulVec2=function(t,e){var i=t.ex.x*e.x+t.ey.x*e.y,o=t.ex.y*e.x+t.ey.y*e.y;return G.neo(i,o)},t.mulMat22=function(e,i){return new t(e.ex.x*i.ex.x+e.ey.x*i.ex.y,e.ex.x*i.ey.x+e.ey.x*i.ey.y,e.ex.y*i.ex.x+e.ey.y*i.ex.y,e.ex.y*i.ey.x+e.ey.y*i.ey.y)},t.mulT=function(e,i){return i&&"x"in i&&"y"in i?G.neo(G.dot(i,e.ex),G.dot(i,e.ey)):i&&"ex"in i&&"ey"in i?new t(G.neo(G.dot(e.ex,i.ex),G.dot(e.ey,i.ex)),G.neo(G.dot(e.ex,i.ey),G.dot(e.ey,i.ey))):void 0},t.mulTVec2=function(t,e){return G.neo(G.dot(e,t.ex),G.dot(e,t.ey))},t.mulTMat22=function(e,i){return new t(G.neo(G.dot(e.ex,i.ex),G.dot(e.ey,i.ex)),G.neo(G.dot(e.ex,i.ey),G.dot(e.ey,i.ey)))},t.abs=function(e){return new t(G.abs(e.ex),G.abs(e.ey))},t.add=function(e,i){return new t(G.add(e.ex,i.ex),G.add(e.ey,i.ey))},t}(),ic=Math.sqrt,il=tf(0,0),i_=tf(0,0),iu=tf(0,0),ip=tf(0,0),iy=tf(0,0),id=tf(0,0),iv=tf(0,0),ix=tf(0,0);(o=u||(u={}))[o.e_unset=-1]="e_unset",o[o.e_circles=0]="e_circles",o[o.e_faceA=1]="e_faceA",o[o.e_faceB=2]="e_faceB",(s=p||(p={}))[s.e_unset=-1]="e_unset",s[s.e_vertex=0]="e_vertex",s[s.e_face=1]="e_face",(n=y||(y={}))[n.nullState=0]="nullState",n[n.addState=1]="addState",n[n.persistState=2]="persistState",n[n.removeState=3]="removeState";var iA=function(){function t(){this.v=tf(0,0),this.id=new iB}return t.prototype.set=function(t){tx(this.v,t.v),this.id.set(t.id)},t.prototype.recycle=function(){tA(this.v),this.id.recycle()},t}(),ig=function(){function t(){this.localNormal=tf(0,0),this.localPoint=tf(0,0),this.points=[new ib,new ib],this.pointCount=0}return t.prototype.set=function(t){this.type=t.type,tx(this.localNormal,t.localNormal),tx(this.localPoint,t.localPoint),this.pointCount=t.pointCount,this.points[0].set(t.points[0]),this.points[1].set(t.points[1])},t.prototype.recycle=function(){this.type=u.e_unset,tA(this.localNormal),tA(this.localPoint),this.pointCount=0,this.points[0].recycle(),this.points[1].recycle()},t.prototype.getWorldManifold=function(t,e,i,o,s){if(0==this.pointCount)return t;(t=t||new iw).pointCount=this.pointCount;var n=t.normal,r=t.points,a=t.separations;switch(this.type){case u.e_circles:tv(n,1,0);var m=this.points[0];tY(il,e,this.localPoint),tY(i_,o,m.localPoint),tw(id,i_,il);var h=tk(id);h>1e-9*1e-9&&tC(n,1/ic(h),id),tP(ip,1,il,i,n),tP(iy,1,i_,-s,n),tP(r[0],.5,ip,.5,iy),a[0]=tq(tw(iu,iy,ip),n);break;case u.e_faceA:tD(n,e.q,this.localNormal),tY(iv,e,this.localPoint);for(var c=0;c<this.pointCount;++c){var m=this.points[c];tY(ix,o,m.localPoint),tP(ip,1,ix,i-tq(tw(iu,ix,iv),n),n),tP(iy,1,ix,-s,n),tP(r[c],.5,ip,.5,iy),a[c]=tq(tw(iu,iy,ip),n)}break;case u.e_faceB:tD(n,o.q,this.localNormal),tY(iv,o,this.localPoint);for(var c=0;c<this.pointCount;++c){var m=this.points[c];tY(ix,e,m.localPoint),tP(iy,1,ix,s-tq(tw(iu,ix,iv),n),n),tP(ip,1,ix,-i,n),tP(r[c],.5,ip,.5,iy),a[c]=tq(tw(iu,ip,iy),n)}tg(n)}return t},t.clipSegmentToLine=iC,t.ClipVertex=iA,t.getPointStates=iV,t.PointState=y,t}(),ib=function(){function t(){this.localPoint=tf(0,0),this.normalImpulse=0,this.tangentImpulse=0,this.id=new iB}return t.prototype.set=function(t){tx(this.localPoint,t.localPoint),this.normalImpulse=t.normalImpulse,this.tangentImpulse=t.tangentImpulse,this.id.set(t.id)},t.prototype.recycle=function(){tA(this.localPoint),this.normalImpulse=0,this.tangentImpulse=0,this.id.recycle()},t}(),iB=function(){function t(){this.key=-1,this.indexA=-1,this.indexB=-1,this.typeA=p.e_unset,this.typeB=p.e_unset}return t.prototype.setFeatures=function(t,e,i,o){this.indexA=t,this.indexB=i,this.typeA=e,this.typeB=o,this.key=this.indexA+4*this.indexB+16*this.typeA+64*this.typeB},t.prototype.set=function(t){this.indexA=t.indexA,this.indexB=t.indexB,this.typeA=t.typeA,this.typeB=t.typeB,this.key=this.indexA+4*this.indexB+16*this.typeA+64*this.typeB},t.prototype.swapFeatures=function(){var t=this.indexA,e=this.indexB,i=this.typeA,o=this.typeB;this.indexA=e,this.indexB=t,this.typeA=o,this.typeB=i,this.key=this.indexA+4*this.indexB+16*this.typeA+64*this.typeB},t.prototype.recycle=function(){this.indexA=0,this.indexB=0,this.typeA=p.e_unset,this.typeB=p.e_unset,this.key=-1},t}(),iw=function(){function t(){this.normal=tf(0,0),this.points=[tf(0,0),tf(0,0)],this.separations=[0,0],this.pointCount=0}return t.prototype.recycle=function(){tA(this.normal),tA(this.points[0]),tA(this.points[1]),this.separations[0]=0,this.separations[1]=0,this.pointCount=0},t}();function iV(t,e,i,o){for(var s=0;s<i.pointCount;++s){var n=i.points[s].id;t[s]=y.removeState;for(var r=0;r<o.pointCount;++r)if(o.points[r].id.key===n.key){t[s]=y.persistState;break}}for(var s=0;s<o.pointCount;++s){var n=o.points[s].id;e[s]=y.addState;for(var r=0;r<i.pointCount;++r)if(i.points[r].id.key===n.key){e[s]=y.persistState;break}}}function iC(t,e,i,o,s){var n=0,r=tq(i,e[0].v)-o,a=tq(i,e[1].v)-o;if(r<=0&&t[n++].set(e[0]),a<=0&&t[n++].set(e[1]),r*a<0){var m=r/(r-a);tP(t[n].v,1-m,e[0].v,m,e[1].v),t[n].id.setFeatures(s,p.e_vertex,e[0].id.indexB,p.e_face),++n}return n}var iM=Math.sqrt,iI=Math.max,iP=Math.min,iz=new ts({create:function(){return new i4},release:function(t){t.recycle()}}),iS=new ig,iF=new iw,iL=function(){function t(t){this.prev=null,this.next=null,this.other=null,this.contact=t}return t.prototype.recycle=function(){this.prev=null,this.next=null,this.other=null},t}(),iT=[],iq=function(){function t(){this.rA=tf(0,0),this.rB=tf(0,0),this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}return t.prototype.recycle=function(){tA(this.rA),tA(this.rB),this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0},t}(),ik=tf(0,0),iN=tf(0,0),ij=tf(0,0),iD=tf(0,0),iR=tf(0,0),iO=tO(0,0,0),iE=tO(0,0,0),iY=tf(0,0),iW=tf(0,0),iJ=tf(0,0),iH=tf(0,0),iU=tf(0,0),iK=tf(0,0),iZ=tf(0,0),iX=tf(0,0),iG=tf(0,0),i$=tf(0,0),iQ=tf(0,0),i0=tf(0,0),i1=tf(0,0),i2=tf(0,0),i3=tf(0,0),i5=tf(0,0),i9=tf(0,0),i6=tf(0,0),i8=tf(0,0),i4=function(){function t(){this.m_nodeA=new iL(this),this.m_nodeB=new iL(this),this.m_fixtureA=null,this.m_fixtureB=null,this.m_indexA=-1,this.m_indexB=-1,this.m_evaluateFcn=null,this.m_manifold=new ig,this.m_prev=null,this.m_next=null,this.m_toi=1,this.m_toiCount=0,this.m_toiFlag=!1,this.m_friction=0,this.m_restitution=0,this.m_tangentSpeed=0,this.m_enabledFlag=!0,this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_impulse=new ia(this),this.v_points=[new iq,new iq],this.v_normal=tf(0,0),this.v_normalMass=new ih,this.v_K=new ih,this.v_pointCount=0,this.v_tangentSpeed=0,this.v_friction=0,this.v_restitution=0,this.v_invMassA=0,this.v_invMassB=0,this.v_invIA=0,this.v_invIB=0,this.p_localPoints=[tf(0,0),tf(0,0)],this.p_localNormal=tf(0,0),this.p_localPoint=tf(0,0),this.p_localCenterA=tf(0,0),this.p_localCenterB=tf(0,0),this.p_type=u.e_unset,this.p_radiusA=0,this.p_radiusB=0,this.p_pointCount=0,this.p_invMassA=0,this.p_invMassB=0,this.p_invIA=0,this.p_invIB=0}return t.prototype.initialize=function(t,e,i,o,s){var n,r;this.m_fixtureA=t,this.m_fixtureB=i,this.m_indexA=e,this.m_indexB=o,this.m_evaluateFcn=s,this.m_friction=iM(this.m_fixtureA.m_friction*this.m_fixtureB.m_friction),this.m_restitution=(n=this.m_fixtureA.m_restitution)>(r=this.m_fixtureB.m_restitution)?n:r},t.prototype.recycle=function(){this.m_nodeA.recycle(),this.m_nodeB.recycle(),this.m_fixtureA=null,this.m_fixtureB=null,this.m_indexA=-1,this.m_indexB=-1,this.m_evaluateFcn=null,this.m_manifold.recycle(),this.m_prev=null,this.m_next=null,this.m_toi=1,this.m_toiCount=0,this.m_toiFlag=!1,this.m_friction=0,this.m_restitution=0,this.m_tangentSpeed=0,this.m_enabledFlag=!0,this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_impulse.recycle();for(var t=0,e=this.v_points;t<e.length;t++)e[t].recycle();tA(this.v_normal),this.v_normalMass.setZero(),this.v_K.setZero(),this.v_pointCount=0,this.v_tangentSpeed=0,this.v_friction=0,this.v_restitution=0,this.v_invMassA=0,this.v_invMassB=0,this.v_invIA=0,this.v_invIB=0;for(var i=0,o=this.p_localPoints;i<o.length;i++)tA(o[i]);tA(this.p_localNormal),tA(this.p_localPoint),tA(this.p_localCenterA),tA(this.p_localCenterB),this.p_type=u.e_unset,this.p_radiusA=0,this.p_radiusB=0,this.p_pointCount=0,this.p_invMassA=0,this.p_invMassB=0,this.p_invIA=0,this.p_invIB=0},t.prototype.initConstraint=function(t){var e=this.m_fixtureA,i=this.m_fixtureB;if(null!==e&&null!==i){var o=e.m_body,s=i.m_body;if(null!==o&&null!==s){var n=e.m_shape,r=i.m_shape;if(null!==n&&null!==r){var a=this.m_manifold,m=a.pointCount;this.v_invMassA=o.m_invMass,this.v_invMassB=s.m_invMass,this.v_invIA=o.m_invI,this.v_invIB=s.m_invI,this.v_friction=this.m_friction,this.v_restitution=this.m_restitution,this.v_tangentSpeed=this.m_tangentSpeed,this.v_pointCount=m,this.v_K.setZero(),this.v_normalMass.setZero(),this.p_invMassA=o.m_invMass,this.p_invMassB=s.m_invMass,this.p_invIA=o.m_invI,this.p_invIB=s.m_invI,tx(this.p_localCenterA,o.m_sweep.localCenter),tx(this.p_localCenterB,s.m_sweep.localCenter),this.p_radiusA=n.m_radius,this.p_radiusB=r.m_radius,this.p_type=a.type,tx(this.p_localNormal,a.localNormal),tx(this.p_localPoint,a.localPoint),this.p_pointCount=m;for(var h=0;h<to.maxManifoldPoints;++h)this.v_points[h].recycle(),tA(this.p_localPoints[h]);for(var h=0;h<m;++h){var c=a.points[h],l=this.v_points[h];t.warmStarting&&(l.normalImpulse=t.dtRatio*c.normalImpulse,l.tangentImpulse=t.dtRatio*c.tangentImpulse),tx(this.p_localPoints[h],c.localPoint)}}}}},t.prototype.getManifold=function(){return this.m_manifold},t.prototype.getWorldManifold=function(t){var e=this.m_fixtureA,i=this.m_fixtureB;if(null!==e&&null!==i){var o=e.m_body,s=i.m_body;if(null!==o&&null!==s){var n=e.m_shape,r=i.m_shape;if(null!==n&&null!==r)return this.m_manifold.getWorldManifold(t,o.getTransform(),n.m_radius,s.getTransform(),r.m_radius)}}},t.prototype.setEnabled=function(t){this.m_enabledFlag=!!t},t.prototype.isEnabled=function(){return this.m_enabledFlag},t.prototype.isTouching=function(){return this.m_touchingFlag},t.prototype.getNext=function(){return this.m_next},t.prototype.getFixtureA=function(){return this.m_fixtureA},t.prototype.getFixtureB=function(){return this.m_fixtureB},t.prototype.getChildIndexA=function(){return this.m_indexA},t.prototype.getChildIndexB=function(){return this.m_indexB},t.prototype.flagForFiltering=function(){this.m_filterFlag=!0},t.prototype.setFriction=function(t){this.m_friction=t},t.prototype.getFriction=function(){return this.m_friction},t.prototype.resetFriction=function(){var t=this.m_fixtureA,e=this.m_fixtureB;null!==t&&null!==e&&(this.m_friction=iM(t.m_friction*e.m_friction))},t.prototype.setRestitution=function(t){this.m_restitution=t},t.prototype.getRestitution=function(){return this.m_restitution},t.prototype.resetRestitution=function(){var t,e,i=this.m_fixtureA,o=this.m_fixtureB;null!==i&&null!==o&&(this.m_restitution=(t=i.m_restitution)>(e=o.m_restitution)?t:e)},t.prototype.setTangentSpeed=function(t){this.m_tangentSpeed=t},t.prototype.getTangentSpeed=function(){return this.m_tangentSpeed},t.prototype.evaluate=function(t,e,i){var o=this.m_fixtureA,s=this.m_fixtureB;null!==o&&null!==s&&this.m_evaluateFcn(t,e,o,this.m_indexA,i,s,this.m_indexB)},t.prototype.update=function(t){var e=this.m_fixtureA,i=this.m_fixtureB;if(null!==e&&null!==i){var o=e.m_body,s=i.m_body;if(null!==o&&null!==s){var n=e.m_shape,r=i.m_shape;if(null!==n&&null!==r){this.m_enabledFlag=!0;var a=!1,m=this.m_touchingFlag,h=e.m_isSensor,c=i.m_isSensor,l=h||c,_=o.m_xf,u=s.m_xf;if(l)a=eN(n,this.m_indexA,r,this.m_indexB,_,u),this.m_manifold.pointCount=0;else{iS.recycle(),iS.set(this.m_manifold),this.m_manifold.recycle(),this.evaluate(this.m_manifold,_,u),a=this.m_manifold.pointCount>0;for(var p=0;p<this.m_manifold.pointCount;++p){var y=this.m_manifold.points[p];y.normalImpulse=0,y.tangentImpulse=0;for(var d=0;d<iS.pointCount;++d){var f=iS.points[d];if(f.id.key===y.id.key){y.normalImpulse=f.normalImpulse,y.tangentImpulse=f.tangentImpulse;break}}}a!==m&&(o.setAwake(!0),s.setAwake(!0))}this.m_touchingFlag=a;var v="object"==typeof t&&null!==t;!m&&a&&v&&t.beginContact(this),m&&!a&&v&&t.endContact(this),!l&&a&&v&&iS&&t.preSolve(this,iS)}}}},t.prototype.solvePositionConstraint=function(t){return this._solvePositionConstraint(t,null,null)},t.prototype.solvePositionConstraintTOI=function(t,e,i){return this._solvePositionConstraint(t,e,i)},t.prototype._solvePositionConstraint=function(t,e,i){var o=null!==e&&null!==i,s=0,n=this.m_fixtureA,r=this.m_fixtureB;if(null===n||null===r)return s;var a=n.m_body,m=r.m_body;if(null===a||null===m)return s;var h=a.c_position,c=m.c_position,l=this.p_localCenterA,_=this.p_localCenterB,p=0,y=0;o&&a!==e&&a!==i||(p=this.p_invMassA,y=this.p_invIA);var d=0,f=0;o&&m!==e&&m!==i||(d=this.p_invMassB,f=this.p_invIB),tx(ik,h.c);var v=h.a;tx(ij,c.c);for(var x=c.a,A=0;A<this.p_pointCount;++A){t6(iO,l,ik,v),t6(iE,_,ij,x);var g=void 0;switch(this.p_type){case u.e_circles:tY(iY,iO,this.p_localPoint),tY(iW,iE,this.p_localPoints[0]),tw(iX,iW,iY),tS(iX),tP(iG,.5,iY,.5,iW),g=tq(iW,iX)-tq(iY,iX)-this.p_radiusA-this.p_radiusB;break;case u.e_faceA:tD(iX,iO.q,this.p_localNormal),tY(iH,iO,this.p_localPoint),tY(iJ,iE,this.p_localPoints[A]),g=tq(iJ,iX)-tq(iH,iX)-this.p_radiusA-this.p_radiusB,tx(iG,iJ);break;case u.e_faceB:tD(iX,iE.q,this.p_localNormal),tY(iH,iE,this.p_localPoint),tY(iJ,iO,this.p_localPoints[A]),g=tq(iJ,iX)-tq(iH,iX)-this.p_radiusA-this.p_radiusB,tx(iG,iJ),tg(iX);break;default:return s}tw(iU,iG,ik),tw(iK,iG,ij),s=iP(s,g);var b=J((o?to.toiBaugarte:to.baumgarte)*(g+to.linearSlop),-to.maxLinearCorrection,0),B=tT(iU,iX),w=tT(iK,iX),V=p+d+y*B*B+f*w*w;tC(iZ,V>0?-b/V:0,iX),tI(ik,p,iZ),v-=y*tT(iU,iZ),tM(ij,d,iZ),x+=f*tT(iK,iZ)}return tx(h.c,ik),h.a=v,tx(c.c,ij),c.a=x,s},t.prototype.initVelocityConstraint=function(t){var e=this.m_fixtureA,i=this.m_fixtureB;if(null!==e&&null!==i){var o=e.m_body,s=i.m_body;if(null!==o&&null!==s){var n=o.c_velocity,r=s.c_velocity,a=o.c_position,m=s.c_position,h=this.p_radiusA,c=this.p_radiusB,l=this.m_manifold,_=this.v_invMassA,u=this.v_invMassB,p=this.v_invIA,y=this.v_invIB,d=this.p_localCenterA,f=this.p_localCenterB;tx(ik,a.c);var v=a.a;tx(iN,n.v);var x=n.w;tx(ij,m.c);var A=m.a;tx(iD,r.v);var g=r.w;t6(iO,d,ik,v),t6(iE,f,ij,A),iF.recycle(),l.getWorldManifold(iF,iO,h,iE,c),tx(this.v_normal,iF.normal);for(var b=0;b<this.v_pointCount;++b){var B,w=this.v_points[b],V=iF.points[b];tw(w.rA,V,ik),tw(w.rB,V,ij);var C=tT(w.rA,this.v_normal),M=tT(w.rB,this.v_normal),I=_+u+p*C*C+y*M*M;w.normalMass=I>0?1/I:0,tF(iR,this.v_normal,1);var P=tT(w.rA,iR),z=tT(w.rB,iR),S=_+u+p*P*P+y*z*z;w.tangentMass=S>0?1/S:0,w.velocityBias=0,(B=0+tq(this.v_normal,iD)+tq(this.v_normal,tL(i8,g,w.rB))-tq(this.v_normal,iN)-tq(this.v_normal,tL(i8,x,w.rA)))<-to.velocityThreshold&&(w.velocityBias=-this.v_restitution*B)}if(2==this.v_pointCount&&t.blockSolve){var F=this.v_points[0],L=this.v_points[1],T=tT(F.rA,this.v_normal),q=tT(F.rB,this.v_normal),k=tT(L.rA,this.v_normal),N=tT(L.rB,this.v_normal),j=_+u+p*T*T+y*q*q,D=_+u+p*k*k+y*N*N,R=_+u+p*T*k+y*q*N;if(j*j<1e3*(j*D-R*R)){this.v_K.ex.setNum(j,R),this.v_K.ey.setNum(R,D);var O=this.v_K.ex.x,E=this.v_K.ey.x,Y=this.v_K.ex.y,W=this.v_K.ey.y,J=O*W-E*Y;0!==J&&(J=1/J),this.v_normalMass.ex.x=J*W,this.v_normalMass.ey.x=-J*E,this.v_normalMass.ex.y=-J*Y,this.v_normalMass.ey.y=J*O}else this.v_pointCount=1}tx(a.c,ik),a.a=v,tx(n.v,iN),n.w=x,tx(m.c,ij),m.a=A,tx(r.v,iD),r.w=g}}},t.prototype.warmStartConstraint=function(t){var e=this.m_fixtureA,i=this.m_fixtureB;if(null!==e&&null!==i){var o=e.m_body,s=i.m_body;if(null!==o&&null!==s){var n=o.c_velocity,r=s.c_velocity,a=this.v_invMassA,m=this.v_invIA,h=this.v_invMassB,c=this.v_invIB;tx(iN,n.v);var l=n.w;tx(iD,r.v);var _=r.w;tx(iX,this.v_normal),tF(iR,iX,1);for(var u=0;u<this.v_pointCount;++u){var p=this.v_points[u];tP(iZ,p.normalImpulse,iX,p.tangentImpulse,iR),l-=m*tT(p.rA,iZ),tI(iN,a,iZ),_+=c*tT(p.rB,iZ),tM(iD,h,iZ)}tx(n.v,iN),n.w=l,tx(r.v,iD),r.w=_}}},t.prototype.storeConstraintImpulses=function(t){for(var e=this.m_manifold,i=0;i<this.v_pointCount;++i)e.points[i].normalImpulse=this.v_points[i].normalImpulse,e.points[i].tangentImpulse=this.v_points[i].tangentImpulse},t.prototype.solveVelocityConstraint=function(t){var e=this.m_fixtureA,i=this.m_fixtureB;if(null!==e&&null!==i){var o=e.m_body,s=i.m_body;if(null!==o&&null!==s){var n=o.c_velocity,r=s.c_velocity,a=this.v_invMassA,m=this.v_invIA,h=this.v_invMassB,c=this.v_invIB;tx(iN,n.v);var l=n.w;tx(iD,r.v);var _=r.w;tx(iX,this.v_normal),tF(iR,iX,1);for(var u=this.v_friction,p=0;p<this.v_pointCount;++p){var y=this.v_points[p];tA(i$),tb(i$,iD),tb(i$,tL(i8,_,y.rB)),tB(i$,iN),tB(i$,tL(i8,l,y.rA));var d=tq(i$,iR)-this.v_tangentSpeed,f=-(y.tangentMass*d),v=u*y.normalImpulse,x=J(y.tangentImpulse+f,-v,v);f=x-y.tangentImpulse,y.tangentImpulse=x,tC(iZ,f,iR),tI(iN,a,iZ),l-=m*tT(y.rA,iZ),tM(iD,h,iZ),_+=c*tT(y.rB,iZ)}if(1==this.v_pointCount||!1==t.blockSolve)for(var A=0;A<this.v_pointCount;++A){var y=this.v_points[A];tA(i$),tb(i$,iD),tb(i$,tL(i8,_,y.rB)),tB(i$,iN),tB(i$,tL(i8,l,y.rA));var g=tq(i$,iX),f=-y.normalMass*(g-y.velocityBias),x=iI(y.normalImpulse+f,0);f=x-y.normalImpulse,y.normalImpulse=x,tC(iZ,f,iX),tI(iN,a,iZ),l-=m*tT(y.rA,iZ),tM(iD,h,iZ),_+=c*tT(y.rB,iZ)}else{var b=this.v_points[0],B=this.v_points[1];tv(i2,b.normalImpulse,B.normalImpulse),tA(iQ),tb(iQ,iD),tb(iQ,tL(i8,_,b.rB)),tB(iQ,iN),tB(iQ,tL(i8,l,b.rA)),tA(i0),tb(i0,iD),tb(i0,tL(i8,_,B.rB)),tB(i0,iN),tB(i0,tL(i8,l,B.rA));var w=tq(iQ,iX),V=tq(i0,iX);for(tv(i1,w-b.velocityBias,V-B.velocityBias),i1.x-=this.v_K.ex.x*i2.x+this.v_K.ey.x*i2.y,i1.y-=this.v_K.ex.y*i2.x+this.v_K.ey.y*i2.y;;){if(tA(i3),i3.x=-(this.v_normalMass.ex.x*i1.x+this.v_normalMass.ey.x*i1.y),i3.y=-(this.v_normalMass.ex.y*i1.x+this.v_normalMass.ey.y*i1.y),i3.x>=0&&i3.y>=0||(i3.x=-b.normalMass*i1.x,i3.y=0,w=0,V=this.v_K.ex.y*i3.x+i1.y,i3.x>=0&&V>=0)||(i3.x=0,i3.y=-B.normalMass*i1.y,w=this.v_K.ey.x*i3.y+i1.x,V=0,i3.y>=0&&w>=0)){tw(i5,i3,i2),tC(i9,i5.x,iX),tC(i6,i5.y,iX),tz(iN,-a,i9,-a,i6,1,iN),l-=m*(tT(b.rA,i9)+tT(B.rA,i6)),tz(iD,h,i9,h,i6,1,iD),_+=c*(tT(b.rB,i9)+tT(B.rB,i6)),b.normalImpulse=i3.x,B.normalImpulse=i3.y;break}i3.x=0,i3.y=0,w=i1.x,V=i1.y,w>=0&&V>=0&&(tw(i5,i3,i2),tC(i9,i5.x,iX),tC(i6,i5.y,iX),tz(iN,-a,i9,-a,i6,1,iN),l-=m*(tT(b.rA,i9)+tT(B.rA,i6)),tz(iD,h,i9,h,i6,1,iD),_+=c*(tT(b.rB,i9)+tT(B.rB,i6)),b.normalImpulse=i3.x,B.normalImpulse=i3.y);break}}tx(n.v,iN),n.w=l,tx(r.v,iD),r.w=_}}},t.addType=function(t,e,i){iT[t]=iT[t]||{},iT[t][e]=i},t.create=function(t,e,i,o){var s,n=t.m_shape.m_type,r=i.m_shape.m_type,a=iz.allocate();if(s=iT[n]&&iT[n][r])a.initialize(t,e,i,o,s);else{if(!(s=iT[r]&&iT[r][n]))return null;a.initialize(i,o,t,e,s)}t=a.m_fixtureA,i=a.m_fixtureB,e=a.getChildIndexA(),o=a.getChildIndexB();var m=t.m_body,h=i.m_body;return a.m_nodeA.contact=a,a.m_nodeA.other=h,a.m_nodeA.prev=null,a.m_nodeA.next=m.m_contactList,null!=m.m_contactList&&(m.m_contactList.prev=a.m_nodeA),m.m_contactList=a.m_nodeA,a.m_nodeB.contact=a,a.m_nodeB.other=m,a.m_nodeB.prev=null,a.m_nodeB.next=h.m_contactList,null!=h.m_contactList&&(h.m_contactList.prev=a.m_nodeB),h.m_contactList=a.m_nodeB,!1==t.isSensor()&&!1==i.isSensor()&&(m.setAwake(!0),h.setAwake(!0)),a},t.destroy=function(t,e){var i=t.m_fixtureA,o=t.m_fixtureB;if(null!==i&&null!==o){var s=i.m_body,n=o.m_body;null!==s&&null!==n&&(t.isTouching()&&e.endContact(t),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA==s.m_contactList&&(s.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB==n.m_contactList&&(n.m_contactList=t.m_nodeB.next),!(t.m_manifold.pointCount>0)||i.m_isSensor||o.m_isSensor||(s.setAwake(!0),n.setAwake(!0)),iz.release(t))}},t}(),i7={gravity:G.zero(),allowSleep:!0,warmStarting:!0,continuousPhysics:!0,subStepping:!1,blockSolve:!0,velocityIterations:8,positionIterations:3},ot=function(){function t(e){if(!(this instanceof t))return new t(e);this.s_step=new e6,e?G.isValid(e)&&(e={gravity:e}):e={},e=O(e,i7),this.m_solver=new im(this),this.m_broadPhase=new tu,this.m_contactList=null,this.m_contactCount=0,this.m_bodyList=null,this.m_bodyCount=0,this.m_jointList=null,this.m_jointCount=0,this.m_stepComplete=!0,this.m_allowSleep=e.allowSleep,this.m_gravity=G.clone(e.gravity),this.m_clearForces=!0,this.m_newFixture=!1,this.m_locked=!1,this.m_warmStarting=e.warmStarting,this.m_continuousPhysics=e.continuousPhysics,this.m_subStepping=e.subStepping,this.m_blockSolve=e.blockSolve,this.m_velocityIterations=e.velocityIterations,this.m_positionIterations=e.positionIterations,this.m_t=0,this.m_step_callback=[]}return t.prototype._serialize=function(){for(var t=[],e=[],i=this.getBodyList();i;i=i.getNext())t.push(i);for(var o=this.getJointList();o;o=o.getNext())"function"==typeof o._serialize&&e.push(o);return{gravity:this.m_gravity,bodies:t,joints:e}},t._deserialize=function(e,i,o){if(!e)return new t;var s=new t(e.gravity);if(e.bodies)for(var n=e.bodies.length-1;n>=0;n-=1)s._addBody(o(eu,e.bodies[n],s));if(e.joints)for(var n=e.joints.length-1;n>=0;n--)s.createJoint(o(ey,e.joints[n],s));return s},t.prototype.getBodyList=function(){return this.m_bodyList},t.prototype.getJointList=function(){return this.m_jointList},t.prototype.getContactList=function(){return this.m_contactList},t.prototype.getBodyCount=function(){return this.m_bodyCount},t.prototype.getJointCount=function(){return this.m_jointCount},t.prototype.getContactCount=function(){return this.m_contactCount},t.prototype.setGravity=function(t){this.m_gravity.set(t)},t.prototype.getGravity=function(){return this.m_gravity},t.prototype.isLocked=function(){return this.m_locked},t.prototype.setAllowSleeping=function(t){if(t!=this.m_allowSleep&&(this.m_allowSleep=t,!1==this.m_allowSleep))for(var e=this.m_bodyList;e;e=e.m_next)e.setAwake(!0)},t.prototype.getAllowSleeping=function(){return this.m_allowSleep},t.prototype.setWarmStarting=function(t){this.m_warmStarting=t},t.prototype.getWarmStarting=function(){return this.m_warmStarting},t.prototype.setContinuousPhysics=function(t){this.m_continuousPhysics=t},t.prototype.getContinuousPhysics=function(){return this.m_continuousPhysics},t.prototype.setSubStepping=function(t){this.m_subStepping=t},t.prototype.getSubStepping=function(){return this.m_subStepping},t.prototype.setAutoClearForces=function(t){this.m_clearForces=t},t.prototype.getAutoClearForces=function(){return this.m_clearForces},t.prototype.clearForces=function(){for(var t=this.m_bodyList;t;t=t.getNext())t.m_force.setZero(),t.m_torque=0},t.prototype.queryAABB=function(t,e){var i=this.m_broadPhase;this.m_broadPhase.query(t,function(t){return e(i.getUserData(t).fixture)})},t.prototype.rayCast=function(t,e,i){var o=this.m_broadPhase;this.m_broadPhase.rayCast({maxFraction:1,p1:t,p2:e},function(t,e){var s=o.getUserData(e),n=s.fixture,r=s.childIndex,a={};if(n.rayCast(a,t,r)){var m=a.fraction;return i(n,G.add(G.mulNumVec2(1-m,t.p1),G.mulNumVec2(m,t.p2)),a.normal,m)}return t.maxFraction})},t.prototype.getProxyCount=function(){return this.m_broadPhase.getProxyCount()},t.prototype.getTreeHeight=function(){return this.m_broadPhase.getTreeHeight()},t.prototype.getTreeBalance=function(){return this.m_broadPhase.getTreeBalance()},t.prototype.getTreeQuality=function(){return this.m_broadPhase.getTreeQuality()},t.prototype.shiftOrigin=function(t){if(!this.isLocked()){for(var e=this.m_bodyList;e;e=e.m_next)e.m_xf.p.sub(t),e.m_sweep.c0.sub(t),e.m_sweep.c.sub(t);for(var i=this.m_jointList;i;i=i.m_next)i.shiftOrigin(t);this.m_broadPhase.shiftOrigin(t)}},t.prototype._addBody=function(t){!this.isLocked()&&(t.m_prev=null,t.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=t),this.m_bodyList=t,++this.m_bodyCount)},t.prototype.createBody=function(t,e){if(this.isLocked())return null;var i={};t&&(G.isValid(t)?i={position:t,angle:e}:"object"==typeof t&&(i=t));var o=new eu(this,i);return this._addBody(o),o},t.prototype.createDynamicBody=function(t,e){var i={};return t&&(G.isValid(t)?i={position:t,angle:e}:"object"==typeof t&&(i=t)),i.type="dynamic",this.createBody(i)},t.prototype.createKinematicBody=function(t,e){var i={};return t&&(G.isValid(t)?i={position:t,angle:e}:"object"==typeof t&&(i=t)),i.type="kinematic",this.createBody(i)},t.prototype.destroyBody=function(t){if(!this.isLocked()){if(t.m_destroyed)return!1;for(var e=t.m_jointList;e;){var i=e;e=e.next,this.publish("remove-joint",i.joint),this.destroyJoint(i.joint),t.m_jointList=e}t.m_jointList=null;for(var o=t.m_contactList;o;){var s=o;o=o.next,this.destroyContact(s.contact),t.m_contactList=o}t.m_contactList=null;for(var n=t.m_fixtureList;n;){var r=n;n=n.m_next,this.publish("remove-fixture",r),r.destroyProxies(this.m_broadPhase),t.m_fixtureList=n}return t.m_fixtureList=null,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_bodyList&&(this.m_bodyList=t.m_next),t.m_destroyed=!0,--this.m_bodyCount,this.publish("remove-body",t),!0}},t.prototype.createJoint=function(t){if(this.isLocked())return null;if(t.m_prev=null,t.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=t),this.m_jointList=t,++this.m_jointCount,t.m_edgeA.joint=t,t.m_edgeA.other=t.m_bodyB,t.m_edgeA.prev=null,t.m_edgeA.next=t.m_bodyA.m_jointList,t.m_bodyA.m_jointList&&(t.m_bodyA.m_jointList.prev=t.m_edgeA),t.m_bodyA.m_jointList=t.m_edgeA,t.m_edgeB.joint=t,t.m_edgeB.other=t.m_bodyA,t.m_edgeB.prev=null,t.m_edgeB.next=t.m_bodyB.m_jointList,t.m_bodyB.m_jointList&&(t.m_bodyB.m_jointList.prev=t.m_edgeB),t.m_bodyB.m_jointList=t.m_edgeB,!1==t.m_collideConnected)for(var e=t.m_bodyB.getContactList();e;e=e.next)e.other==t.m_bodyA&&e.contact.flagForFiltering();return t},t.prototype.destroyJoint=function(t){if(!this.isLocked()){t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_jointList&&(this.m_jointList=t.m_next);var e=t.m_bodyA,i=t.m_bodyB;if(e.setAwake(!0),i.setAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA==e.m_jointList&&(e.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB==i.m_jointList&&(i.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,--this.m_jointCount,!1==t.m_collideConnected)for(var o=i.getContactList();o;)o.other==e&&o.contact.flagForFiltering(),o=o.next;this.publish("remove-joint",t)}},t.prototype.step=function(t,e,i){if(this.publish("pre-step",t),(0|e)!==e&&(e=0),e=e||this.m_velocityIterations,i=i||this.m_positionIterations,this.m_newFixture&&(this.findNewContacts(),this.m_newFixture=!1),this.m_locked=!0,this.s_step.reset(t),this.s_step.velocityIterations=e,this.s_step.positionIterations=i,this.s_step.warmStarting=this.m_warmStarting,this.s_step.blockSolve=this.m_blockSolve,this.updateContacts(),this.m_stepComplete&&t>0){this.m_solver.solveWorld(this.s_step);for(var o,s=this.m_bodyList;s;s=s.getNext())!1!=s.m_islandFlag&&(s.isStatic()||s.synchronizeFixtures());this.findNewContacts()}for(this.m_continuousPhysics&&t>0&&this.m_solver.solveWorldTOI(this.s_step),this.m_clearForces&&this.clearForces(),this.m_locked=!1;o=this.m_step_callback.shift();)o(this);this.publish("post-step",t)},t.prototype.queueUpdate=function(t){this.isLocked()?this.m_step_callback.push(t):t(this)},t.prototype.findNewContacts=function(){var t=this;this.m_broadPhase.updatePairs(function(e,i){return t.createContact(e,i)})},t.prototype.createContact=function(t,e){var i=t.fixture,o=e.fixture,s=t.childIndex,n=e.childIndex,r=i.getBody(),a=o.getBody();if(r!=a){for(var m=a.getContactList();m;){if(m.other==r){var h=m.contact.getFixtureA(),c=m.contact.getFixtureB(),l=m.contact.getChildIndexA(),_=m.contact.getChildIndexB();if(h==i&&c==o&&l==s&&_==n||h==o&&c==i&&l==n&&_==s)return}m=m.next}if(!1!=a.shouldCollide(r)&&!1!=o.shouldCollide(i)){var u=i4.create(i,s,o,n);null!=u&&(u.m_prev=null,null!=this.m_contactList&&(u.m_next=this.m_contactList,this.m_contactList.m_prev=u),this.m_contactList=u,++this.m_contactCount)}}},t.prototype.updateContacts=function(){for(var t,e=this.m_contactList;t=e;){e=t.getNext();var i=t.getFixtureA(),o=t.getFixtureB(),s=t.getChildIndexA(),n=t.getChildIndexB(),r=i.getBody(),a=o.getBody();if(t.m_filterFlag){if(!1==a.shouldCollide(r)||!1==o.shouldCollide(i)){this.destroyContact(t);continue}t.m_filterFlag=!1}var m=r.isAwake()&&!r.isStatic(),h=a.isAwake()&&!a.isStatic();if(!1!=m||!1!=h){var c=i.m_proxies[s].proxyId,l=o.m_proxies[n].proxyId;if(!1==this.m_broadPhase.testOverlap(c,l)){this.destroyContact(t);continue}t.update(this)}}},t.prototype.destroyContact=function(t){t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_contactList&&(this.m_contactList=t.m_next),i4.destroy(t,this),--this.m_contactCount},t.prototype.on=function(t,e){return"string"!=typeof t||"function"!=typeof e||(this._listeners||(this._listeners={}),this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push(e)),this},t.prototype.off=function(t,e){if("string"!=typeof t||"function"!=typeof e)return this;var i=this._listeners&&this._listeners[t];if(!i||!i.length)return this;var o=i.indexOf(e);return o>=0&&i.splice(o,1),this},t.prototype.publish=function(t,e,i,o){var s=this._listeners&&this._listeners[t];if(!s||!s.length)return 0;for(var n=0;n<s.length;n++)s[n].call(this,e,i,o);return s.length},t.prototype.beginContact=function(t){this.publish("begin-contact",t)},t.prototype.endContact=function(t){this.publish("end-contact",t)},t.prototype.preSolve=function(t,e){this.publish("pre-solve",t,e)},t.prototype.postSolve=function(t,e){this.publish("post-solve",t,e)},t}(),oe=function(){function t(e,i,o){if(!(this instanceof t))return new t(e,i,o);void 0===e?(this.x=0,this.y=0,this.z=0):"object"==typeof e?(this.x=e.x,this.y=e.y,this.z=e.z):(this.x=e,this.y=i,this.z=o)}return t.prototype._serialize=function(){return{x:this.x,y:this.y,z:this.z}},t._deserialize=function(e){var i=Object.create(t.prototype);return i.x=e.x,i.y=e.y,i.z=e.z,i},t.neo=function(e,i,o){var s=Object.create(t.prototype);return s.x=e,s.y=i,s.z=o,s},t.zero=function(){var e=Object.create(t.prototype);return e.x=0,e.y=0,e.z=0,e},t.clone=function(e){return t.neo(e.x,e.y,e.z)},t.prototype.toString=function(){return JSON.stringify(this)},t.isValid=function(t){return null!=t&&Number.isFinite(t.x)&&Number.isFinite(t.y)&&Number.isFinite(t.z)},t.assert=function(t){},t.prototype.setZero=function(){return this.x=0,this.y=0,this.z=0,this},t.prototype.set=function(t,e,i){return this.x=t,this.y=e,this.z=i,this},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},t.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},t.prototype.mul=function(t){return this.x*=t,this.y*=t,this.z*=t,this},t.areEqual=function(t,e){return t===e||"object"==typeof t&&null!==t&&"object"==typeof e&&null!==e&&t.x===e.x&&t.y===e.y&&t.z===e.z},t.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},t.cross=function(e,i){return new t(e.y*i.z-e.z*i.y,e.z*i.x-e.x*i.z,e.x*i.y-e.y*i.x)},t.add=function(e,i){return new t(e.x+i.x,e.y+i.y,e.z+i.z)},t.sub=function(e,i){return new t(e.x-i.x,e.y-i.y,e.z-i.z)},t.mul=function(e,i){return new t(i*e.x,i*e.y,i*e.z)},t.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},t.neg=function(e){return new t(-e.x,-e.y,-e.z)},t}(),oi=tf(0,0),oo=tf(0,0),os=function(t){function e(i,o){var s=this;return s instanceof e?((s=t.call(this)||this).m_type=e.TYPE,s.m_radius=to.polygonRadius,s.m_vertex1=i?G.clone(i):G.zero(),s.m_vertex2=o?G.clone(o):G.zero(),s.m_vertex0=G.zero(),s.m_vertex3=G.zero(),s.m_hasVertex0=!1,s.m_hasVertex3=!1,s):new e(i,o)}return D(e,t),e.prototype._serialize=function(){return{type:this.m_type,vertex1:this.m_vertex1,vertex2:this.m_vertex2,vertex0:this.m_vertex0,vertex3:this.m_vertex3,hasVertex0:this.m_hasVertex0,hasVertex3:this.m_hasVertex3}},e._deserialize=function(t){var i=new e(t.vertex1,t.vertex2);return i.m_hasVertex0&&i.setPrevVertex(t.vertex0),i.m_hasVertex3&&i.setNextVertex(t.vertex3),i},e.prototype._reset=function(){},e.prototype.getRadius=function(){return this.m_radius},e.prototype.getType=function(){return this.m_type},e.prototype.setNext=function(t){return this.setNextVertex(t)},e.prototype.setNextVertex=function(t){return t?(this.m_vertex3.setVec2(t),this.m_hasVertex3=!0):(this.m_vertex3.setZero(),this.m_hasVertex3=!1),this},e.prototype.getNextVertex=function(){return this.m_vertex3},e.prototype.setPrev=function(t){return this.setPrevVertex(t)},e.prototype.setPrevVertex=function(t){return t?(this.m_vertex0.setVec2(t),this.m_hasVertex0=!0):(this.m_vertex0.setZero(),this.m_hasVertex0=!1),this},e.prototype.getPrevVertex=function(){return this.m_vertex0},e.prototype._set=function(t,e){return this.m_vertex1.setVec2(t),this.m_vertex2.setVec2(e),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this},e.prototype._clone=function(){var t=new e;return t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_vertex1.setVec2(this.m_vertex1),t.m_vertex2.setVec2(this.m_vertex2),t.m_vertex0.setVec2(this.m_vertex0),t.m_vertex3.setVec2(this.m_vertex3),t.m_hasVertex0=this.m_hasVertex0,t.m_hasVertex3=this.m_hasVertex3,t},e.prototype.getChildCount=function(){return 1},e.prototype.testPoint=function(t,e){return!1},e.prototype.rayCast=function(t,e,i,o){var s=tX.mulTVec2(i.q,G.sub(e.p1,i.p)),n=tX.mulTVec2(i.q,G.sub(e.p2,i.p)),r=G.sub(n,s),a=this.m_vertex1,m=this.m_vertex2,h=G.sub(m,a),c=G.neo(h.y,-h.x);c.normalize();var l=G.dot(c,G.sub(a,s)),_=G.dot(c,r);if(0==_)return!1;var u=l/_;if(u<0||e.maxFraction<u)return!1;var p=G.add(s,G.mulNumVec2(u,r)),y=G.sub(m,a),d=G.dot(y,y);if(0==d)return!1;var f=G.dot(G.sub(p,a),y)/d;return!(f<0)&&!(1<f)&&(t.fraction=u,l>0?t.normal=tX.mulVec2(i.q,c).neg():t.normal=tX.mulVec2(i.q,c),!0)},e.prototype.computeAABB=function(t,e,i){tY(oi,e,this.m_vertex1),tY(oo,e,this.m_vertex2),tt.combinePoints(t,oi,oo),tt.extend(t,this.m_radius)},e.prototype.computeMass=function(t,e){t.mass=0,tP(t.center,.5,this.m_vertex1,.5,this.m_vertex2),t.I=0},e.prototype.computeDistanceProxy=function(t){t.m_vertices[0]=this.m_vertex1,t.m_vertices[1]=this.m_vertex2,t.m_vertices.length=2,t.m_count=2,t.m_radius=this.m_radius},e.TYPE="edge",e}(t8),on=tf(0,0),or=tf(0,0),oa=function(t){function e(i,o){var s=this;return s instanceof e?((s=t.call(this)||this).m_type=e.TYPE,s.m_radius=to.polygonRadius,s.m_vertices=[],s.m_count=0,s.m_prevVertex=null,s.m_nextVertex=null,s.m_hasPrevVertex=!1,s.m_hasNextVertex=!1,s.m_isLoop=!!o,i&&i.length&&(o?s._createLoop(i):s._createChain(i)),s):new e(i,o)}return D(e,t),e.prototype._serialize=function(){var t={type:this.m_type,vertices:this.m_isLoop?this.m_vertices.slice(0,this.m_vertices.length-1):this.m_vertices,isLoop:this.m_isLoop,hasPrevVertex:this.m_hasPrevVertex,hasNextVertex:this.m_hasNextVertex,prevVertex:null,nextVertex:null};return this.m_prevVertex&&(t.prevVertex=this.m_prevVertex),this.m_nextVertex&&(t.nextVertex=this.m_nextVertex),t},e._deserialize=function(t,i,o){var s=[];if(t.vertices)for(var n=0;n<t.vertices.length;n++)s.push(o(G,t.vertices[n]));var r=new e(s,t.isLoop);return t.prevVertex&&r.setPrevVertex(t.prevVertex),t.nextVertex&&r.setNextVertex(t.nextVertex),r},e.prototype.getType=function(){return this.m_type},e.prototype.getRadius=function(){return this.m_radius},e.prototype._createLoop=function(t){if(!(t.length<3)){this.m_vertices=[],this.m_count=t.length+1;for(var e,e=0;e<t.length;++e)this.m_vertices[e]=G.clone(t[e]);return this.m_vertices[t.length]=G.clone(t[0]),this.m_prevVertex=this.m_vertices[this.m_count-2],this.m_nextVertex=this.m_vertices[1],this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this}},e.prototype._createChain=function(t){var e;this.m_vertices=[],this.m_count=t.length;for(var e=0;e<t.length;++e)this.m_vertices[e]=G.clone(t[e]);return this.m_prevVertex=null,this.m_nextVertex=null,this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this},e.prototype._reset=function(){this.m_isLoop?this._createLoop(this.m_vertices.slice(0,this.m_vertices.length-1)):this._createChain(this.m_vertices)},e.prototype.setPrevVertex=function(t){this.m_prevVertex=t,this.m_hasPrevVertex=!0},e.prototype.getPrevVertex=function(){return this.m_prevVertex},e.prototype.setNextVertex=function(t){this.m_nextVertex=t,this.m_hasNextVertex=!0},e.prototype.getNextVertex=function(){return this.m_nextVertex},e.prototype._clone=function(){var t=new e;return t._createChain(this.m_vertices),t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_prevVertex=this.m_prevVertex,t.m_nextVertex=this.m_nextVertex,t.m_hasPrevVertex=this.m_hasPrevVertex,t.m_hasNextVertex=this.m_hasNextVertex,t},e.prototype.getChildCount=function(){return this.m_count-1},e.prototype.getChildEdge=function(t,e){t.m_type=os.TYPE,t.m_radius=this.m_radius,t.m_vertex1=this.m_vertices[e],t.m_vertex2=this.m_vertices[e+1],e>0?(t.m_vertex0=this.m_vertices[e-1],t.m_hasVertex0=!0):(t.m_vertex0=this.m_prevVertex,t.m_hasVertex0=this.m_hasPrevVertex),e<this.m_count-2?(t.m_vertex3=this.m_vertices[e+2],t.m_hasVertex3=!0):(t.m_vertex3=this.m_nextVertex,t.m_hasVertex3=this.m_hasNextVertex)},e.prototype.getVertex=function(t){return t<this.m_count?this.m_vertices[t]:this.m_vertices[0]},e.prototype.isLoop=function(){return this.m_isLoop},e.prototype.testPoint=function(t,e){return!1},e.prototype.rayCast=function(t,e,i,o){return new os(this.getVertex(o),this.getVertex(o+1)).rayCast(t,e,i,0)},e.prototype.computeAABB=function(t,e,i){tY(on,e,this.getVertex(i)),tY(or,e,this.getVertex(i+1)),tt.combinePoints(t,on,or)},e.prototype.computeMass=function(t,e){t.mass=0,tA(t.center),t.I=0},e.prototype.computeDistanceProxy=function(t,e){t.m_vertices[0]=this.getVertex(e),t.m_vertices[1]=this.getVertex(e+1),t.m_count=2,t.m_radius=this.m_radius},e.TYPE="chain",e}(t8),om=Math.max,oh=Math.min,oc=tf(0,0),ol=tf(0,0),o_=tf(0,0),ou=tf(0,0),op=tf(0,0),oy=tf(0,0),od=function(t){function e(i){var o=this;return o instanceof e?((o=t.call(this)||this).m_type=e.TYPE,o.m_radius=to.polygonRadius,o.m_centroid=G.zero(),o.m_vertices=[],o.m_normals=[],o.m_count=0,i&&i.length&&o._set(i),o):new e(i)}return D(e,t),e.prototype._serialize=function(){return{type:this.m_type,vertices:this.m_vertices}},e._deserialize=function(t,i,o){var s=[];if(t.vertices)for(var n=0;n<t.vertices.length;n++)s.push(o(G,t.vertices[n]));return new e(s)},e.prototype.getType=function(){return this.m_type},e.prototype.getRadius=function(){return this.m_radius},e.prototype._clone=function(){var t=new e;t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_count=this.m_count,t.m_centroid.setVec2(this.m_centroid);for(var i=0;i<this.m_count;i++)t.m_vertices.push(this.m_vertices[i].clone());for(var i=0;i<this.m_normals.length;i++)t.m_normals.push(this.m_normals[i].clone());return t},e.prototype.getChildCount=function(){return 1},e.prototype._reset=function(){this._set(this.m_vertices)},e.prototype._set=function(t){if(t.length<3)return void this._setAsBox(1,1);for(var e=oh(t.length,to.maxPolygonVertices),i=[],o=0;o<e;++o){for(var s=t[o],n=!0,r=0;r<i.length;++r)if(G.distanceSquared(s,i[r])<.25*to.linearSlopSquared){n=!1;break}n&&i.push(G.clone(s))}if((e=i.length)<3)return void this._setAsBox(1,1);for(var a=0,m=i[0].x,o=1;o<e;++o){var h=i[o].x;(h>m||h===m&&i[o].y<i[a].y)&&(a=o,m=h)}for(var c=[],l=0,_=a;;){c[l]=_;for(var u=0,r=1;r<e;++r){if(u===_){u=r;continue}var p=G.sub(i[u],i[c[l]]),s=G.sub(i[r],i[c[l]]),y=G.crossVec2Vec2(p,s);y<0&&(u=r),0===y&&s.lengthSquared()>p.lengthSquared()&&(u=r)}if(++l,_=u,u===a)break}if(l<3)return void this._setAsBox(1,1);this.m_count=l,this.m_vertices=[];for(var o=0;o<l;++o)this.m_vertices[o]=i[c[o]];for(var o=0;o<l;++o){var d=o,f=o+1<l?o+1:0,v=G.sub(this.m_vertices[f],this.m_vertices[d]);this.m_normals[o]=G.crossVec2Num(v,1),this.m_normals[o].normalize()}this.m_centroid=function(t,e){for(var i,o=G.zero(),s=0,n=G.zero(),r=1/3,i=0;i<e;++i){var a=t[i],m=i+1<e?t[i+1]:t[0],h=G.sub(a,n),c=G.sub(m,n),l=.5*G.crossVec2Vec2(h,c);s+=l,tz(oc,1,n,1,a,1,m),tM(o,l*r,oc)}return o.mul(1/s),o}(this.m_vertices,l)},e.prototype._setAsBox=function(t,e,i,o){if(this.m_vertices[0]=G.neo(t,-e),this.m_vertices[1]=G.neo(t,e),this.m_vertices[2]=G.neo(-t,e),this.m_vertices[3]=G.neo(-t,-e),this.m_normals[0]=G.neo(1,0),this.m_normals[1]=G.neo(0,1),this.m_normals[2]=G.neo(-1,0),this.m_normals[3]=G.neo(0,-1),this.m_count=4,i&&G.isValid(i)){o=o||0,tx(this.m_centroid,i);var s=t1.identity();s.p.setVec2(i),s.q.setAngle(o);for(var n=0;n<this.m_count;++n)this.m_vertices[n]=t1.mulVec2(s,this.m_vertices[n]),this.m_normals[n]=tX.mulVec2(s.q,this.m_normals[n])}},e.prototype.testPoint=function(t,e){for(var i=tW(oc,t,e),o=0;o<this.m_count;++o)if(tq(this.m_normals[o],i)-tq(this.m_normals[o],this.m_vertices[o])>0)return!1;return!0},e.prototype.rayCast=function(t,e,i,o){for(var s=tX.mulTVec2(i.q,G.sub(e.p1,i.p)),n=tX.mulTVec2(i.q,G.sub(e.p2,i.p)),r=G.sub(n,s),a=0,m=e.maxFraction,h=-1,c=0;c<this.m_count;++c){var l=G.dot(this.m_normals[c],G.sub(this.m_vertices[c],s)),_=G.dot(this.m_normals[c],r);if(0==_){if(l<0)return!1}else _<0&&l<a*_?(a=l/_,h=c):_>0&&l<m*_&&(m=l/_);if(m<a)return!1}return h>=0&&(t.fraction=a,t.normal=tX.mulVec2(i.q,this.m_normals[h]),!0)},e.prototype.computeAABB=function(t,e,i){for(var o=1/0,s=1/0,n=-1/0,r=-1/0,a=0;a<this.m_count;++a){var m=tY(oc,e,this.m_vertices[a]);o=oh(o,m.x),n=om(n,m.x),s=oh(s,m.y),r=om(r,m.y)}tv(t.lowerBound,o-this.m_radius,s-this.m_radius),tv(t.upperBound,n+this.m_radius,r+this.m_radius)},e.prototype.computeMass=function(t,e){tA(op);var i,o=0,s=0;tA(oy);for(var n=0;n<this.m_count;++n)tb(oy,this.m_vertices[n]);tC(oy,1/this.m_count,oy);for(var r=1/3,n=0;n<this.m_count;++n){tw(o_,this.m_vertices[n],oy),n+1<this.m_count?tw(ou,this.m_vertices[n+1],oy):tw(ou,this.m_vertices[0],oy);var a=tT(o_,ou),m=.5*a;o+=m,tP(oc,m*r,o_,m*r,ou),tb(op,oc);var h=o_.x,c=o_.y,l=ou.x,_=ou.y;s+=.25*r*a*(h*h+l*h+l*l+(c*c+_*c+_*_))}t.mass=e*o,tC(op,1/o,op),i=t.center,i.x=op.x+oy.x,i.y=op.x+oy.y,t.I=e*s,t.I+=t.mass*(tq(t.center,t.center)-tq(op,op))},e.prototype.validate=function(){for(var t=0;t<this.m_count;++t){var e=t,i=t<this.m_count-1?e+1:0,o=this.m_vertices[e];tw(ol,this.m_vertices[i],o);for(var s=0;s<this.m_count;++s)if(s!=e&&s!=i&&0>tT(ol,tw(oc,this.m_vertices[s],o)))return!1}return!0},e.prototype.computeDistanceProxy=function(t){for(var e=0;e<this.m_count;++e)t.m_vertices[e]=this.m_vertices[e];t.m_vertices.length=this.m_count,t.m_count=this.m_count,t.m_radius=this.m_radius},e.TYPE="polygon",e}(t8),of=Math.sqrt,ov=Math.PI,ox=tf(0,0),oA=function(t){function e(i,o){var s=this;return s instanceof e?((s=t.call(this)||this).m_type=e.TYPE,s.m_p=G.zero(),s.m_radius=1,"object"==typeof i&&G.isValid(i)?(s.m_p.setVec2(i),"number"==typeof o&&(s.m_radius=o)):"number"==typeof i&&(s.m_radius=i),s):new e(i,o)}return D(e,t),e.prototype._serialize=function(){return{type:this.m_type,p:this.m_p,radius:this.m_radius}},e._deserialize=function(t){return new e(t.p,t.radius)},e.prototype._reset=function(){},e.prototype.getType=function(){return this.m_type},e.prototype.getRadius=function(){return this.m_radius},e.prototype.getCenter=function(){return this.m_p},e.prototype._clone=function(){var t=new e;return t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_p=this.m_p.clone(),t},e.prototype.getChildCount=function(){return 1},e.prototype.testPoint=function(t,e){return tj(e,tY(ox,t,this.m_p))<=this.m_radius*this.m_radius},e.prototype.rayCast=function(t,e,i,o){var s=G.add(i.p,tX.mulVec2(i.q,this.m_p)),n=G.sub(e.p1,s),r=G.dot(n,n)-this.m_radius*this.m_radius,a=G.sub(e.p2,e.p1),m=G.dot(n,a),h=G.dot(a,a),c=m*m-h*r;if(c<0||h<1e-9)return!1;var l=-(m+of(c));return 0<=l&&l<=e.maxFraction*h&&(t.fraction=l/=h,t.normal=G.add(n,G.mulNumVec2(l,a)),t.normal.normalize(),!0)},e.prototype.computeAABB=function(t,e,i){var o=tY(ox,e,this.m_p);tv(t.lowerBound,o.x-this.m_radius,o.y-this.m_radius),tv(t.upperBound,o.x+this.m_radius,o.y+this.m_radius)},e.prototype.computeMass=function(t,e){t.mass=e*ov*this.m_radius*this.m_radius,tx(t.center,this.m_p),t.I=t.mass*(.5*this.m_radius*this.m_radius+tk(this.m_p))},e.prototype.computeDistanceProxy=function(t){t.m_vertices[0]=this.m_p,t.m_vertices.length=1,t.m_count=1,t.m_radius=this.m_radius},e.TYPE="circle",e}(t8),og=Math.abs,ob=Math.PI,oB={frequencyHz:0,dampingRatio:0},ow=function(t){function e(i,o,s,n,r){var a=this;if(!(a instanceof e))return new e(i,o,s,n,r);if(s&&n&&"m_type"in n&&"x"in s&&"y"in s){var m=s;s=n,n=m}return i=O(i,oB),o=(a=t.call(this,i,o,s)||this).m_bodyA,s=a.m_bodyB,a.m_type=e.TYPE,a.m_localAnchorA=G.clone(n?o.getLocalPoint(n):i.localAnchorA||G.zero()),a.m_localAnchorB=G.clone(r?s.getLocalPoint(r):i.localAnchorB||G.zero()),a.m_length=Number.isFinite(i.length)?i.length:G.distance(o.getWorldPoint(a.m_localAnchorA),s.getWorldPoint(a.m_localAnchorB)),a.m_frequencyHz=i.frequencyHz,a.m_dampingRatio=i.dampingRatio,a.m_impulse=0,a.m_gamma=0,a.m_bias=0,a}return D(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,length:this.m_length,impulse:this.m_impulse,gamma:this.m_gamma,bias:this.m_bias}},e._deserialize=function(t,i,o){return(t=R({},t)).bodyA=o(eu,t.bodyA,i),t.bodyB=o(eu,t.bodyB,i),new e(t)},e.prototype._reset=function(t){t.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.setVec2(t.localAnchorA),t.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.setVec2(t.localAnchorB),t.length>0?this.m_length=+t.length:t.length<0||(t.anchorA||t.anchorA||t.anchorA||t.anchorA)&&(this.m_length=G.distance(this.m_bodyA.getWorldPoint(this.m_localAnchorA),this.m_bodyB.getWorldPoint(this.m_localAnchorB))),Number.isFinite(t.frequencyHz)&&(this.m_frequencyHz=t.frequencyHz),Number.isFinite(t.dampingRatio)&&(this.m_dampingRatio=t.dampingRatio)},e.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.setLength=function(t){this.m_length=t},e.prototype.getLength=function(){return this.m_length},e.prototype.setFrequency=function(t){this.m_frequencyHz=t},e.prototype.getFrequency=function(){return this.m_frequencyHz},e.prototype.setDampingRatio=function(t){this.m_dampingRatio=t},e.prototype.getDampingRatio=function(){return this.m_dampingRatio},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return G.mulNumVec2(this.m_impulse,this.m_u).mul(t)},e.prototype.getReactionTorque=function(t){return 0},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,o=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,a=this.m_bodyB.c_velocity.v,m=this.m_bodyB.c_velocity.w,h=tX.neo(i),c=tX.neo(r);this.m_rA=tX.mulVec2(h,G.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=tX.mulVec2(c,G.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_u=G.sub(G.add(n,this.m_rB),G.add(e,this.m_rA));var l=this.m_u.length();l>to.linearSlop?this.m_u.mul(1/l):this.m_u.setNum(0,0);var _=G.crossVec2Vec2(this.m_rA,this.m_u),u=G.crossVec2Vec2(this.m_rB,this.m_u),p=this.m_invMassA+this.m_invIA*_*_+this.m_invMassB+this.m_invIB*u*u;if(this.m_mass=0!=p?1/p:0,this.m_frequencyHz>0){var y=l-this.m_length,d=2*ob*this.m_frequencyHz,f=2*this.m_mass*this.m_dampingRatio*d,v=this.m_mass*d*d,x=t.dt;this.m_gamma=x*(f+x*v),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=y*x*v*this.m_gamma,p+=this.m_gamma,this.m_mass=0!=p?1/p:0}else this.m_gamma=0,this.m_bias=0;if(t.warmStarting){this.m_impulse*=t.dtRatio;var A=G.mulNumVec2(this.m_impulse,this.m_u);o.subMul(this.m_invMassA,A),s-=this.m_invIA*G.crossVec2Vec2(this.m_rA,A),a.addMul(this.m_invMassB,A),m+=this.m_invIB*G.crossVec2Vec2(this.m_rB,A)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.setVec2(o),this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v.setVec2(a),this.m_bodyB.c_velocity.w=m},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=G.add(e,G.crossNumVec2(i,this.m_rA)),r=G.add(o,G.crossNumVec2(s,this.m_rB)),a=G.dot(this.m_u,r)-G.dot(this.m_u,n),m=-this.m_mass*(a+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=m;var h=G.mulNumVec2(m,this.m_u);e.subMul(this.m_invMassA,h),i-=this.m_invIA*G.crossVec2Vec2(this.m_rA,h),o.addMul(this.m_invMassB,h),s+=this.m_invIB*G.crossVec2Vec2(this.m_rB,h),this.m_bodyA.c_velocity.v.setVec2(e),this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v.setVec2(o),this.m_bodyB.c_velocity.w=s},e.prototype.solvePositionConstraints=function(t){if(this.m_frequencyHz>0)return!0;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,o=this.m_bodyB.c_position.c,s=this.m_bodyB.c_position.a,n=tX.neo(i),r=tX.neo(s),a=tX.mulSub(n,this.m_localAnchorA,this.m_localCenterA),m=tX.mulSub(r,this.m_localAnchorB,this.m_localCenterB),h=G.sub(G.add(o,m),G.add(e,a)),c=J(h.normalize()-this.m_length,-to.maxLinearCorrection,to.maxLinearCorrection),l=-this.m_mass*c,_=G.mulNumVec2(l,h);return e.subMul(this.m_invMassA,_),i-=this.m_invIA*G.crossVec2Vec2(a,_),o.addMul(this.m_invMassB,_),s+=this.m_invIB*G.crossVec2Vec2(m,_),this.m_bodyA.c_position.c.setVec2(e),this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c.setVec2(o),this.m_bodyB.c_position.a=s,og(c)<to.linearSlop},e.TYPE="distance-joint",e}(ey),oV={maxForce:0,maxTorque:0},oC=function(t){function e(i,o,s,n){var r=this;return r instanceof e?(i=O(i,oV),o=(r=t.call(this,i,o,s)||this).m_bodyA,s=r.m_bodyB,r.m_type=e.TYPE,r.m_localAnchorA=G.clone(n?o.getLocalPoint(n):i.localAnchorA||G.zero()),r.m_localAnchorB=G.clone(n?s.getLocalPoint(n):i.localAnchorB||G.zero()),r.m_linearImpulse=G.zero(),r.m_angularImpulse=0,r.m_maxForce=i.maxForce,r.m_maxTorque=i.maxTorque,r):new e(i,o,s,n)}return D(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,maxForce:this.m_maxForce,maxTorque:this.m_maxTorque,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB}},e._deserialize=function(t,i,o){return(t=R({},t)).bodyA=o(eu,t.bodyA,i),t.bodyB=o(eu,t.bodyB,i),new e(t)},e.prototype._reset=function(t){t.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.setVec2(t.localAnchorA),t.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.setVec2(t.localAnchorB),Number.isFinite(t.maxForce)&&(this.m_maxForce=t.maxForce),Number.isFinite(t.maxTorque)&&(this.m_maxTorque=t.maxTorque)},e.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.setMaxForce=function(t){this.m_maxForce=t},e.prototype.getMaxForce=function(){return this.m_maxForce},e.prototype.setMaxTorque=function(t){this.m_maxTorque=t},e.prototype.getMaxTorque=function(){return this.m_maxTorque},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return G.mulNumVec2(t,this.m_linearImpulse)},e.prototype.getReactionTorque=function(t){return t*this.m_angularImpulse},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,a=tX.neo(e),m=tX.neo(s);this.m_rA=tX.mulVec2(a,G.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=tX.mulVec2(m,G.sub(this.m_localAnchorB,this.m_localCenterB));var h=this.m_invMassA,c=this.m_invMassB,l=this.m_invIA,_=this.m_invIB,u=new ih;if(u.ex.x=h+c+l*this.m_rA.y*this.m_rA.y+_*this.m_rB.y*this.m_rB.y,u.ex.y=-l*this.m_rA.x*this.m_rA.y-_*this.m_rB.x*this.m_rB.y,u.ey.x=u.ex.y,u.ey.y=h+c+l*this.m_rA.x*this.m_rA.x+_*this.m_rB.x*this.m_rB.x,this.m_linearMass=u.getInverse(),this.m_angularMass=l+_,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.warmStarting){this.m_linearImpulse.mul(t.dtRatio),this.m_angularImpulse*=t.dtRatio;var p=G.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);i.subMul(h,p),o-=l*(G.crossVec2Vec2(this.m_rA,p)+this.m_angularImpulse),n.addMul(c,p),r+=_*(G.crossVec2Vec2(this.m_rB,p)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=r},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,a=this.m_invIA,m=this.m_invIB,h=t.dt,c=s-i,l=-this.m_angularMass*c,_=this.m_angularImpulse,u=h*this.m_maxTorque;this.m_angularImpulse=J(this.m_angularImpulse+l,-u,u),i-=a*(l=this.m_angularImpulse-_),s+=m*l;var c=G.sub(G.add(o,G.crossNumVec2(s,this.m_rB)),G.add(e,G.crossNumVec2(i,this.m_rA))),l=G.neg(ih.mulVec2(this.m_linearMass,c)),_=this.m_linearImpulse;this.m_linearImpulse.add(l);var u=h*this.m_maxForce;this.m_linearImpulse.lengthSquared()>u*u&&(this.m_linearImpulse.normalize(),this.m_linearImpulse.mul(u)),l=G.sub(this.m_linearImpulse,_),e.subMul(n,l),i-=a*G.crossVec2Vec2(this.m_rA,l),o.addMul(r,l),s+=m*G.crossVec2Vec2(this.m_rB,l),this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=o,this.m_bodyB.c_velocity.w=s},e.prototype.solvePositionConstraints=function(t){return!0},e.TYPE="friction-joint",e}(ey),oM=function(){function t(t,e,i){"object"==typeof t&&null!==t?(this.ex=oe.clone(t),this.ey=oe.clone(e),this.ez=oe.clone(i)):(this.ex=oe.zero(),this.ey=oe.zero(),this.ez=oe.zero())}return t.prototype.toString=function(){return JSON.stringify(this)},t.isValid=function(t){return null!=t&&oe.isValid(t.ex)&&oe.isValid(t.ey)&&oe.isValid(t.ez)},t.assert=function(t){},t.prototype.setZero=function(){return this.ex.setZero(),this.ey.setZero(),this.ez.setZero(),this},t.prototype.solve33=function(t){var e=this.ey.y*this.ez.z-this.ey.z*this.ez.y,i=this.ey.z*this.ez.x-this.ey.x*this.ez.z,o=this.ey.x*this.ez.y-this.ey.y*this.ez.x,s=this.ex.x*e+this.ex.y*i+this.ex.z*o;0!==s&&(s=1/s);var n=new oe;return e=this.ey.y*this.ez.z-this.ey.z*this.ez.y,i=this.ey.z*this.ez.x-this.ey.x*this.ez.z,o=this.ey.x*this.ez.y-this.ey.y*this.ez.x,n.x=s*(t.x*e+t.y*i+t.z*o),e=t.y*this.ez.z-t.z*this.ez.y,i=t.z*this.ez.x-t.x*this.ez.z,o=t.x*this.ez.y-t.y*this.ez.x,n.y=s*(this.ex.x*e+this.ex.y*i+this.ex.z*o),e=this.ey.y*t.z-this.ey.z*t.y,i=this.ey.z*t.x-this.ey.x*t.z,o=this.ey.x*t.y-this.ey.y*t.x,n.z=s*(this.ex.x*e+this.ex.y*i+this.ex.z*o),n},t.prototype.solve22=function(t){var e=this.ex.x,i=this.ey.x,o=this.ex.y,s=this.ey.y,n=e*s-i*o;0!==n&&(n=1/n);var r=G.zero();return r.x=n*(s*t.x-i*t.y),r.y=n*(e*t.y-o*t.x),r},t.prototype.getInverse22=function(t){var e=this.ex.x,i=this.ey.x,o=this.ex.y,s=this.ey.y,n=e*s-i*o;0!==n&&(n=1/n),t.ex.x=n*s,t.ey.x=-n*i,t.ex.z=0,t.ex.y=-n*o,t.ey.y=n*e,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0},t.prototype.getSymInverse33=function(t){var e=oe.dot(this.ex,oe.cross(this.ey,this.ez));0!==e&&(e=1/e);var i=this.ex.x,o=this.ey.x,s=this.ez.x,n=this.ey.y,r=this.ez.y,a=this.ez.z;t.ex.x=e*(n*a-r*r),t.ex.y=e*(s*r-o*a),t.ex.z=e*(o*r-s*n),t.ey.x=t.ex.y,t.ey.y=e*(i*a-s*s),t.ey.z=e*(s*o-i*r),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=e*(i*n-o*o)},t.mul=function(t,e){if(e&&"z"in e&&"y"in e&&"x"in e){var i=t.ex.x*e.x+t.ey.x*e.y+t.ez.x*e.z,o=t.ex.y*e.x+t.ey.y*e.y+t.ez.y*e.z;return new oe(i,o,t.ex.z*e.x+t.ey.z*e.y+t.ez.z*e.z)}if(e&&"y"in e&&"x"in e){var i=t.ex.x*e.x+t.ey.x*e.y,o=t.ex.y*e.x+t.ey.y*e.y;return G.neo(i,o)}},t.mulVec3=function(t,e){return new oe(t.ex.x*e.x+t.ey.x*e.y+t.ez.x*e.z,t.ex.y*e.x+t.ey.y*e.y+t.ez.y*e.z,t.ex.z*e.x+t.ey.z*e.y+t.ez.z*e.z)},t.mulVec2=function(t,e){var i=t.ex.x*e.x+t.ey.x*e.y,o=t.ex.y*e.x+t.ey.y*e.y;return G.neo(i,o)},t.add=function(e,i){return new t(oe.add(e.ex,i.ex),oe.add(e.ey,i.ey),oe.add(e.ez,i.ez))},t}(),oI=Math.abs;(r=d||(d={}))[r.inactiveLimit=0]="inactiveLimit",r[r.atLowerLimit=1]="atLowerLimit",r[r.atUpperLimit=2]="atUpperLimit",r[r.equalLimits=3]="equalLimits";var oP=function(t){function e(i,o,s,n){var r,a,m,h,c,l,_=this;return _ instanceof e?(i=null!=i?i:{},o=(_=t.call(this,i,o,s)||this).m_bodyA,s=_.m_bodyB,_.m_mass=new oM,_.m_limitState=d.inactiveLimit,_.m_type=e.TYPE,G.isValid(n)?_.m_localAnchorA=o.getLocalPoint(n):G.isValid(i.localAnchorA)?_.m_localAnchorA=G.clone(i.localAnchorA):_.m_localAnchorA=G.zero(),G.isValid(n)?_.m_localAnchorB=s.getLocalPoint(n):G.isValid(i.localAnchorB)?_.m_localAnchorB=G.clone(i.localAnchorB):_.m_localAnchorB=G.zero(),Number.isFinite(i.referenceAngle)?_.m_referenceAngle=i.referenceAngle:_.m_referenceAngle=s.getAngle()-o.getAngle(),_.m_impulse=new oe,_.m_motorImpulse=0,_.m_lowerAngle=null!=(r=i.lowerAngle)?r:0,_.m_upperAngle=null!=(a=i.upperAngle)?a:0,_.m_maxMotorTorque=null!=(m=i.maxMotorTorque)?m:0,_.m_motorSpeed=null!=(h=i.motorSpeed)?h:0,_.m_enableLimit=null!=(c=i.enableLimit)&&c,_.m_enableMotor=null!=(l=i.enableMotor)&&l,_):new e(i,o,s,n)}return D(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,lowerAngle:this.m_lowerAngle,upperAngle:this.m_upperAngle,maxMotorTorque:this.m_maxMotorTorque,motorSpeed:this.m_motorSpeed,enableLimit:this.m_enableLimit,enableMotor:this.m_enableMotor,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,referenceAngle:this.m_referenceAngle}},e._deserialize=function(t,i,o){return(t=R({},t)).bodyA=o(eu,t.bodyA,i),t.bodyB=o(eu,t.bodyB,i),new e(t)},e.prototype._reset=function(t){t.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.setVec2(t.localAnchorA),t.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.setVec2(t.localAnchorB),Number.isFinite(t.referenceAngle)&&(this.m_referenceAngle=t.referenceAngle),void 0!==t.enableLimit&&(this.m_enableLimit=t.enableLimit),Number.isFinite(t.lowerAngle)&&(this.m_lowerAngle=t.lowerAngle),Number.isFinite(t.upperAngle)&&(this.m_upperAngle=t.upperAngle),Number.isFinite(t.maxMotorTorque)&&(this.m_maxMotorTorque=t.maxMotorTorque),Number.isFinite(t.motorSpeed)&&(this.m_motorSpeed=t.motorSpeed),void 0!==t.enableMotor&&(this.m_enableMotor=t.enableMotor)},e.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.getReferenceAngle=function(){return this.m_referenceAngle},e.prototype.getJointAngle=function(){var t=this.m_bodyA;return this.m_bodyB.m_sweep.a-t.m_sweep.a-this.m_referenceAngle},e.prototype.getJointSpeed=function(){var t=this.m_bodyA;return this.m_bodyB.m_angularVelocity-t.m_angularVelocity},e.prototype.isMotorEnabled=function(){return this.m_enableMotor},e.prototype.enableMotor=function(t){t!=this.m_enableMotor&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=t)},e.prototype.getMotorTorque=function(t){return t*this.m_motorImpulse},e.prototype.setMotorSpeed=function(t){t!=this.m_motorSpeed&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=t)},e.prototype.getMotorSpeed=function(){return this.m_motorSpeed},e.prototype.setMaxMotorTorque=function(t){t!=this.m_maxMotorTorque&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=t)},e.prototype.getMaxMotorTorque=function(){return this.m_maxMotorTorque},e.prototype.isLimitEnabled=function(){return this.m_enableLimit},e.prototype.enableLimit=function(t){t!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},e.prototype.getLowerLimit=function(){return this.m_lowerAngle},e.prototype.getUpperLimit=function(){return this.m_upperAngle},e.prototype.setLimits=function(t,e){(t!=this.m_lowerAngle||e!=this.m_upperAngle)&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=t,this.m_upperAngle=e)},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return G.neo(this.m_impulse.x,this.m_impulse.y).mul(t)},e.prototype.getReactionTorque=function(t){return t*this.m_impulse.z},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,a=tX.neo(e),m=tX.neo(s);this.m_rA=tX.mulVec2(a,G.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=tX.mulVec2(m,G.sub(this.m_localAnchorB,this.m_localCenterB));var h=this.m_invMassA,c=this.m_invMassB,l=this.m_invIA,_=this.m_invIB,u=l+_===0;if(this.m_mass.ex.x=h+c+this.m_rA.y*this.m_rA.y*l+this.m_rB.y*this.m_rB.y*_,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*l-this.m_rB.y*this.m_rB.x*_,this.m_mass.ez.x=-this.m_rA.y*l-this.m_rB.y*_,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=h+c+this.m_rA.x*this.m_rA.x*l+this.m_rB.x*this.m_rB.x*_,this.m_mass.ez.y=this.m_rA.x*l+this.m_rB.x*_,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=l+_,this.m_motorMass=l+_,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),(!1==this.m_enableMotor||u)&&(this.m_motorImpulse=0),this.m_enableLimit&&!1==u){var p=s-e-this.m_referenceAngle;oI(this.m_upperAngle-this.m_lowerAngle)<2*to.angularSlop?this.m_limitState=d.equalLimits:p<=this.m_lowerAngle?(this.m_limitState!=d.atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=d.atLowerLimit):p>=this.m_upperAngle?(this.m_limitState!=d.atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=d.atUpperLimit):(this.m_limitState=d.inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=d.inactiveLimit;if(t.warmStarting){this.m_impulse.mul(t.dtRatio),this.m_motorImpulse*=t.dtRatio;var y=G.neo(this.m_impulse.x,this.m_impulse.y);i.subMul(h,y),o-=l*(G.crossVec2Vec2(this.m_rA,y)+this.m_motorImpulse+this.m_impulse.z),n.addMul(c,y),r+=_*(G.crossVec2Vec2(this.m_rB,y)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=r},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,a=this.m_invIA,m=this.m_invIB,h=a+m===0;if(this.m_enableMotor&&this.m_limitState!=d.equalLimits&&!1==h){var c=s-i-this.m_motorSpeed,l=-this.m_motorMass*c,_=this.m_motorImpulse,u=t.dt*this.m_maxMotorTorque;this.m_motorImpulse=J(this.m_motorImpulse+l,-u,u),i-=a*(l=this.m_motorImpulse-_),s+=m*l}if(this.m_enableLimit&&this.m_limitState!=d.inactiveLimit&&!1==h){var p=G.zero();p.addCombine(1,o,1,G.crossNumVec2(s,this.m_rB)),p.subCombine(1,e,1,G.crossNumVec2(i,this.m_rA));var y=s-i,c=new oe(p.x,p.y,y),l=oe.neg(this.m_mass.solve33(c));if(this.m_limitState==d.equalLimits)this.m_impulse.add(l);else if(this.m_limitState==d.atLowerLimit){var f=this.m_impulse.z+l.z;if(f<0){var v=G.combine(-1,p,this.m_impulse.z,G.neo(this.m_mass.ez.x,this.m_mass.ez.y)),x=this.m_mass.solve22(v);l.x=x.x,l.y=x.y,l.z=-this.m_impulse.z,this.m_impulse.x+=x.x,this.m_impulse.y+=x.y,this.m_impulse.z=0}else this.m_impulse.add(l)}else if(this.m_limitState==d.atUpperLimit){var f=this.m_impulse.z+l.z;if(f>0){var v=G.combine(-1,p,this.m_impulse.z,G.neo(this.m_mass.ez.x,this.m_mass.ez.y)),x=this.m_mass.solve22(v);l.x=x.x,l.y=x.y,l.z=-this.m_impulse.z,this.m_impulse.x+=x.x,this.m_impulse.y+=x.y,this.m_impulse.z=0}else this.m_impulse.add(l)}var A=G.neo(l.x,l.y);e.subMul(n,A),i-=a*(G.crossVec2Vec2(this.m_rA,A)+l.z),o.addMul(r,A),s+=m*(G.crossVec2Vec2(this.m_rB,A)+l.z)}else{var c=G.zero();c.addCombine(1,o,1,G.crossNumVec2(s,this.m_rB)),c.subCombine(1,e,1,G.crossNumVec2(i,this.m_rA));var l=this.m_mass.solve22(G.neg(c));this.m_impulse.x+=l.x,this.m_impulse.y+=l.y,e.subMul(n,l),i-=a*G.crossVec2Vec2(this.m_rA,l),o.addMul(r,l),s+=m*G.crossVec2Vec2(this.m_rB,l)}this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=o,this.m_bodyB.c_velocity.w=s},e.prototype.solvePositionConstraints=function(t){var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,o=this.m_bodyB.c_position.c,s=this.m_bodyB.c_position.a,n=tX.neo(i),r=tX.neo(s),a=0,m=0,h=this.m_invIA+this.m_invIB==0;if(this.m_enableLimit&&this.m_limitState!=d.inactiveLimit&&!1==h){var c=s-i-this.m_referenceAngle,l=0;if(this.m_limitState==d.equalLimits){var _=J(c-this.m_lowerAngle,-to.maxAngularCorrection,to.maxAngularCorrection);l=-this.m_motorMass*_,a=oI(_)}else if(this.m_limitState==d.atLowerLimit){var _=c-this.m_lowerAngle;a=-_,_=J(_+to.angularSlop,-to.maxAngularCorrection,0),l=-this.m_motorMass*_}else if(this.m_limitState==d.atUpperLimit){var _=c-this.m_upperAngle;a=_,_=J(_-to.angularSlop,0,to.maxAngularCorrection),l=-this.m_motorMass*_}i-=this.m_invIA*l,s+=this.m_invIB*l}n.setAngle(i),r.setAngle(s);var u=tX.mulVec2(n,G.sub(this.m_localAnchorA,this.m_localCenterA)),p=tX.mulVec2(r,G.sub(this.m_localAnchorB,this.m_localCenterB)),_=G.zero();_.addCombine(1,o,1,p),_.subCombine(1,e,1,u),m=_.length();var y=this.m_invMassA,f=this.m_invMassB,v=this.m_invIA,x=this.m_invIB,A=new ih;A.ex.x=y+f+v*u.y*u.y+x*p.y*p.y,A.ex.y=-v*u.x*u.y-x*p.x*p.y,A.ey.x=A.ex.y,A.ey.y=y+f+v*u.x*u.x+x*p.x*p.x;var g=G.neg(A.solve(_));return e.subMul(y,g),i-=v*G.crossVec2Vec2(u,g),o.addMul(f,g),s+=x*G.crossVec2Vec2(p,g),this.m_bodyA.c_position.c.setVec2(e),this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c.setVec2(o),this.m_bodyB.c_position.a=s,m<=to.linearSlop&&a<=to.angularSlop},e.TYPE="revolute-joint",e}(ey),oz=Math.abs,oS=Math.max,oF=Math.min;(a=f||(f={}))[a.inactiveLimit=0]="inactiveLimit",a[a.atLowerLimit=1]="atLowerLimit",a[a.atUpperLimit=2]="atUpperLimit",a[a.equalLimits=3]="equalLimits";var oL={enableLimit:!1,lowerTranslation:0,upperTranslation:0,enableMotor:!1,maxMotorForce:0,motorSpeed:0},oT=function(t){function e(i,o,s,n,r){var a=this;return a instanceof e?(i=O(i,oL),o=(a=t.call(this,i,o,s)||this).m_bodyA,s=a.m_bodyB,a.m_type=e.TYPE,a.m_localAnchorA=G.clone(n?o.getLocalPoint(n):i.localAnchorA||G.zero()),a.m_localAnchorB=G.clone(n?s.getLocalPoint(n):i.localAnchorB||G.zero()),a.m_localXAxisA=G.clone(r?o.getLocalVector(r):i.localAxisA||G.neo(1,0)),a.m_localXAxisA.normalize(),a.m_localYAxisA=G.crossNumVec2(1,a.m_localXAxisA),a.m_referenceAngle=Number.isFinite(i.referenceAngle)?i.referenceAngle:s.getAngle()-o.getAngle(),a.m_impulse=new oe,a.m_motorMass=0,a.m_motorImpulse=0,a.m_lowerTranslation=i.lowerTranslation,a.m_upperTranslation=i.upperTranslation,a.m_maxMotorForce=i.maxMotorForce,a.m_motorSpeed=i.motorSpeed,a.m_enableLimit=i.enableLimit,a.m_enableMotor=i.enableMotor,a.m_limitState=f.inactiveLimit,a.m_axis=G.zero(),a.m_perp=G.zero(),a.m_K=new oM,a):new e(i,o,s,n,r)}return D(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,lowerTranslation:this.m_lowerTranslation,upperTranslation:this.m_upperTranslation,maxMotorForce:this.m_maxMotorForce,motorSpeed:this.m_motorSpeed,enableLimit:this.m_enableLimit,enableMotor:this.m_enableMotor,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,localAxisA:this.m_localXAxisA,referenceAngle:this.m_referenceAngle}},e._deserialize=function(t,i,o){return(t=R({},t)).bodyA=o(eu,t.bodyA,i),t.bodyB=o(eu,t.bodyB,i),t.localAxisA=G.clone(t.localAxisA),new e(t)},e.prototype._reset=function(t){t.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.setVec2(t.localAnchorA),t.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.setVec2(t.localAnchorB),t.localAxisA&&(this.m_localXAxisA.setVec2(t.localAxisA),this.m_localYAxisA.setVec2(G.crossNumVec2(1,t.localAxisA))),Number.isFinite(t.referenceAngle)&&(this.m_referenceAngle=t.referenceAngle),void 0!==t.enableLimit&&(this.m_enableLimit=!!t.enableLimit),Number.isFinite(t.lowerTranslation)&&(this.m_lowerTranslation=t.lowerTranslation),Number.isFinite(t.upperTranslation)&&(this.m_upperTranslation=t.upperTranslation),void 0!==t.enableMotor&&(this.m_enableMotor=!!t.enableMotor),Number.isFinite(t.maxMotorForce)&&(this.m_maxMotorForce=t.maxMotorForce),Number.isFinite(t.motorSpeed)&&(this.m_motorSpeed=t.motorSpeed)},e.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.getLocalAxisA=function(){return this.m_localXAxisA},e.prototype.getReferenceAngle=function(){return this.m_referenceAngle},e.prototype.getJointTranslation=function(){var t=this.m_bodyA.getWorldPoint(this.m_localAnchorA),e=this.m_bodyB.getWorldPoint(this.m_localAnchorB),i=G.sub(e,t),o=this.m_bodyA.getWorldVector(this.m_localXAxisA);return G.dot(i,o)},e.prototype.getJointSpeed=function(){var t=this.m_bodyA,e=this.m_bodyB,i=tX.mulVec2(t.m_xf.q,G.sub(this.m_localAnchorA,t.m_sweep.localCenter)),o=tX.mulVec2(e.m_xf.q,G.sub(this.m_localAnchorB,e.m_sweep.localCenter)),s=G.add(t.m_sweep.c,i),n=G.add(e.m_sweep.c,o),r=G.sub(n,s),a=tX.mulVec2(t.m_xf.q,this.m_localXAxisA),m=t.m_linearVelocity,h=e.m_linearVelocity,c=t.m_angularVelocity,l=e.m_angularVelocity;return G.dot(r,G.crossNumVec2(c,a))+G.dot(a,G.sub(G.addCrossNumVec2(h,l,o),G.addCrossNumVec2(m,c,i)))},e.prototype.isLimitEnabled=function(){return this.m_enableLimit},e.prototype.enableLimit=function(t){t!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},e.prototype.getLowerLimit=function(){return this.m_lowerTranslation},e.prototype.getUpperLimit=function(){return this.m_upperTranslation},e.prototype.setLimits=function(t,e){(t!=this.m_lowerTranslation||e!=this.m_upperTranslation)&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e,this.m_impulse.z=0)},e.prototype.isMotorEnabled=function(){return this.m_enableMotor},e.prototype.enableMotor=function(t){t!=this.m_enableMotor&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=t)},e.prototype.setMotorSpeed=function(t){t!=this.m_motorSpeed&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=t)},e.prototype.setMaxMotorForce=function(t){t!=this.m_maxMotorForce&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorForce=t)},e.prototype.getMaxMotorForce=function(){return this.m_maxMotorForce},e.prototype.getMotorSpeed=function(){return this.m_motorSpeed},e.prototype.getMotorForce=function(t){return t*this.m_motorImpulse},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return G.combine(this.m_impulse.x,this.m_perp,this.m_motorImpulse+this.m_impulse.z,this.m_axis).mul(t)},e.prototype.getReactionTorque=function(t){return t*this.m_impulse.y},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,o=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,a=this.m_bodyB.c_velocity.v,m=this.m_bodyB.c_velocity.w,h=tX.neo(i),c=tX.neo(r),l=tX.mulVec2(h,G.sub(this.m_localAnchorA,this.m_localCenterA)),_=tX.mulVec2(c,G.sub(this.m_localAnchorB,this.m_localCenterB)),u=G.zero();u.addCombine(1,n,1,_),u.subCombine(1,e,1,l);var p=this.m_invMassA,y=this.m_invMassB,d=this.m_invIA,v=this.m_invIB;this.m_axis=tX.mulVec2(h,this.m_localXAxisA),this.m_a1=G.crossVec2Vec2(G.add(u,l),this.m_axis),this.m_a2=G.crossVec2Vec2(_,this.m_axis),this.m_motorMass=p+y+d*this.m_a1*this.m_a1+v*this.m_a2*this.m_a2,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),this.m_perp=tX.mulVec2(h,this.m_localYAxisA),this.m_s1=G.crossVec2Vec2(G.add(u,l),this.m_perp),this.m_s2=G.crossVec2Vec2(_,this.m_perp),G.crossVec2Vec2(l,this.m_perp);var x=p+y+d*this.m_s1*this.m_s1+v*this.m_s2*this.m_s2,A=d*this.m_s1+v*this.m_s2,g=d*this.m_s1*this.m_a1+v*this.m_s2*this.m_a2,b=d+v;0==b&&(b=1);var B=d*this.m_a1+v*this.m_a2,w=p+y+d*this.m_a1*this.m_a1+v*this.m_a2*this.m_a2;if(this.m_K.ex.set(x,A,g),this.m_K.ey.set(A,b,B),this.m_K.ez.set(g,B,w),this.m_enableLimit){var V=G.dot(this.m_axis,u);oz(this.m_upperTranslation-this.m_lowerTranslation)<2*to.linearSlop?this.m_limitState=f.equalLimits:V<=this.m_lowerTranslation?this.m_limitState!=f.atLowerLimit&&(this.m_limitState=f.atLowerLimit,this.m_impulse.z=0):V>=this.m_upperTranslation?this.m_limitState!=f.atUpperLimit&&(this.m_limitState=f.atUpperLimit,this.m_impulse.z=0):(this.m_limitState=f.inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=f.inactiveLimit,this.m_impulse.z=0;if(!1==this.m_enableMotor&&(this.m_motorImpulse=0),t.warmStarting){this.m_impulse.mul(t.dtRatio),this.m_motorImpulse*=t.dtRatio;var C=G.combine(this.m_impulse.x,this.m_perp,this.m_motorImpulse+this.m_impulse.z,this.m_axis),M=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,I=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;o.subMul(p,C),s-=d*M,a.addMul(y,C),m+=v*I}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.setVec2(o),this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v.setVec2(a),this.m_bodyB.c_velocity.w=m},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,a=this.m_invIA,m=this.m_invIB;if(this.m_enableMotor&&this.m_limitState!=f.equalLimits){var h=G.dot(this.m_axis,G.sub(o,e))+this.m_a2*s-this.m_a1*i,c=this.m_motorMass*(this.m_motorSpeed-h),l=this.m_motorImpulse,_=t.dt*this.m_maxMotorForce;this.m_motorImpulse=J(this.m_motorImpulse+c,-_,_),c=this.m_motorImpulse-l;var u=G.mulNumVec2(c,this.m_axis),p=c*this.m_a1,y=c*this.m_a2;e.subMul(n,u),i-=a*p,o.addMul(r,u),s+=m*y}var d=G.zero();if(d.x+=G.dot(this.m_perp,o)+this.m_s2*s,d.x-=G.dot(this.m_perp,e)+this.m_s1*i,d.y=s-i,this.m_enableLimit&&this.m_limitState!=f.inactiveLimit){var v=0+(G.dot(this.m_axis,o)+this.m_a2*s)-(G.dot(this.m_axis,e)+this.m_a1*i),h=new oe(d.x,d.y,v),x=oe.clone(this.m_impulse),A=this.m_K.solve33(oe.neg(h));this.m_impulse.add(A),this.m_limitState==f.atLowerLimit?this.m_impulse.z=oS(this.m_impulse.z,0):this.m_limitState==f.atUpperLimit&&(this.m_impulse.z=oF(this.m_impulse.z,0));var g=G.combine(-1,d,-(this.m_impulse.z-x.z),G.neo(this.m_K.ez.x,this.m_K.ez.y)),b=G.add(this.m_K.solve22(g),G.neo(x.x,x.y));this.m_impulse.x=b.x,this.m_impulse.y=b.y,A=oe.sub(this.m_impulse,x);var u=G.combine(A.x,this.m_perp,A.z,this.m_axis),p=A.x*this.m_s1+A.y+A.z*this.m_a1,y=A.x*this.m_s2+A.y+A.z*this.m_a2;e.subMul(n,u),i-=a*p,o.addMul(r,u),s+=m*y}else{var A=this.m_K.solve22(G.neg(d));this.m_impulse.x+=A.x,this.m_impulse.y+=A.y;var u=G.mulNumVec2(A.x,this.m_perp),p=A.x*this.m_s1+A.y,y=A.x*this.m_s2+A.y;e.subMul(n,u),i-=a*p,o.addMul(r,u),s+=m*y}this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=o,this.m_bodyB.c_velocity.w=s},e.prototype.solvePositionConstraints=function(t){var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,o=this.m_bodyB.c_position.c,s=this.m_bodyB.c_position.a,n=tX.neo(i),r=tX.neo(s),a=this.m_invMassA,m=this.m_invMassB,h=this.m_invIA,c=this.m_invIB,l=tX.mulVec2(n,G.sub(this.m_localAnchorA,this.m_localCenterA)),_=tX.mulVec2(r,G.sub(this.m_localAnchorB,this.m_localCenterB)),u=G.sub(G.add(o,_),G.add(e,l)),p=tX.mulVec2(n,this.m_localXAxisA),y=G.crossVec2Vec2(G.add(u,l),p),d=G.crossVec2Vec2(_,p),f=tX.mulVec2(n,this.m_localYAxisA),v=G.crossVec2Vec2(G.add(u,l),f),x=G.crossVec2Vec2(_,f),A=new oe,g=G.zero();g.x=G.dot(f,u),g.y=s-i-this.m_referenceAngle;var b=oz(g.x),B=oz(g.y),w=to.linearSlop,V=to.maxLinearCorrection,C=!1,M=0;if(this.m_enableLimit){var I=G.dot(p,u);oz(this.m_upperTranslation-this.m_lowerTranslation)<2*w?(M=J(I,-V,V),b=oS(b,oz(I)),C=!0):I<=this.m_lowerTranslation?(M=J(I-this.m_lowerTranslation+w,-V,0),b=Math.max(b,this.m_lowerTranslation-I),C=!0):I>=this.m_upperTranslation&&(M=J(I-this.m_upperTranslation-w,0,V),b=Math.max(b,I-this.m_upperTranslation),C=!0)}if(C){var P=a+m+h*v*v+c*x*x,z=h*v+c*x,S=h*v*y+c*x*d,F=h+c;0==F&&(F=1);var L=h*y+c*d,T=new oM;T.ex.set(P,z,S),T.ey.set(z,F,L),T.ez.set(S,L,a+m+h*y*y+c*d*d);var q=new oe;q.x=g.x,q.y=g.y,q.z=M,A=T.solve33(oe.neg(q))}else{var P=a+m+h*v*v+c*x*x,z=h*v+c*x,F=h+c;0==F&&(F=1);var T=new ih;T.ex.setNum(P,z),T.ey.setNum(z,F);var k=T.solve(G.neg(g));A.x=k.x,A.y=k.y,A.z=0}var N=G.combine(A.x,f,A.z,p),j=A.x*v+A.y+A.z*y,D=A.x*x+A.y+A.z*d;return e.subMul(a,N),i-=h*j,o.addMul(m,N),s+=c*D,this.m_bodyA.c_position.c=e,this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c=o,this.m_bodyB.c_position.a=s,b<=to.linearSlop&&B<=to.angularSlop},e.TYPE="prismatic-joint",e}(ey),oq={ratio:1},ok=function(t){function e(i,o,s,n,r,a){var m,h,c=this;if(!(c instanceof e))return new e(i,o,s,n,r,a);i=O(i,oq),o=(c=t.call(this,i,o,s)||this).m_bodyA,s=c.m_bodyB,c.m_type=e.TYPE,c.m_joint1=n||i.joint1,c.m_joint2=r||i.joint2,c.m_ratio=Number.isFinite(a)?a:i.ratio,c.m_type1=c.m_joint1.getType(),c.m_type2=c.m_joint2.getType(),c.m_bodyC=c.m_joint1.getBodyA(),c.m_bodyA=c.m_joint1.getBodyB();var l=c.m_bodyA.m_xf,_=c.m_bodyA.m_sweep.a,u=c.m_bodyC.m_xf,p=c.m_bodyC.m_sweep.a;if(c.m_type1===oP.TYPE){var y=c.m_joint1;c.m_localAnchorC=y.m_localAnchorA,c.m_localAnchorA=y.m_localAnchorB,c.m_referenceAngleA=y.m_referenceAngle,c.m_localAxisC=G.zero(),m=_-p-c.m_referenceAngleA}else{var d=c.m_joint1;c.m_localAnchorC=d.m_localAnchorA,c.m_localAnchorA=d.m_localAnchorB,c.m_referenceAngleA=d.m_referenceAngle,c.m_localAxisC=d.m_localXAxisA;var f=c.m_localAnchorC,v=tX.mulTVec2(u.q,G.add(tX.mulVec2(l.q,c.m_localAnchorA),G.sub(l.p,u.p)));m=G.dot(v,c.m_localAxisC)-G.dot(f,c.m_localAxisC)}c.m_bodyD=c.m_joint2.getBodyA(),c.m_bodyB=c.m_joint2.getBodyB();var x=c.m_bodyB.m_xf,A=c.m_bodyB.m_sweep.a,g=c.m_bodyD.m_xf,b=c.m_bodyD.m_sweep.a;if(c.m_type2===oP.TYPE){var y=c.m_joint2;c.m_localAnchorD=y.m_localAnchorA,c.m_localAnchorB=y.m_localAnchorB,c.m_referenceAngleB=y.m_referenceAngle,c.m_localAxisD=G.zero(),h=A-b-c.m_referenceAngleB}else{var d=c.m_joint2;c.m_localAnchorD=d.m_localAnchorA,c.m_localAnchorB=d.m_localAnchorB,c.m_referenceAngleB=d.m_referenceAngle,c.m_localAxisD=d.m_localXAxisA;var B=c.m_localAnchorD,w=tX.mulTVec2(g.q,G.add(tX.mulVec2(x.q,c.m_localAnchorB),G.sub(x.p,g.p)));h=G.dot(w,c.m_localAxisD)-G.dot(B,c.m_localAxisD)}return c.m_constant=m+c.m_ratio*h,c.m_impulse=0,c}return D(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,joint1:this.m_joint1,joint2:this.m_joint2,ratio:this.m_ratio}},e._deserialize=function(t,i,o){return(t=R({},t)).bodyA=o(eu,t.bodyA,i),t.bodyB=o(eu,t.bodyB,i),t.joint1=o(ey,t.joint1,i),t.joint2=o(ey,t.joint2,i),new e(t)},e.prototype._reset=function(t){Number.isFinite(t.ratio)&&(this.m_ratio=t.ratio)},e.prototype.getJoint1=function(){return this.m_joint1},e.prototype.getJoint2=function(){return this.m_joint2},e.prototype.setRatio=function(t){this.m_ratio=t},e.prototype.getRatio=function(){return this.m_ratio},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return G.mulNumVec2(this.m_impulse,this.m_JvAC).mul(t)},e.prototype.getReactionTorque=function(t){return t*(this.m_impulse*this.m_JwA)},e.prototype.initVelocityConstraints=function(t){this.m_lcA=this.m_bodyA.m_sweep.localCenter,this.m_lcB=this.m_bodyB.m_sweep.localCenter,this.m_lcC=this.m_bodyC.m_sweep.localCenter,this.m_lcD=this.m_bodyD.m_sweep.localCenter,this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,a=this.m_bodyC.c_position.a,m=this.m_bodyC.c_velocity.v,h=this.m_bodyC.c_velocity.w,c=this.m_bodyD.c_position.a,l=this.m_bodyD.c_velocity.v,_=this.m_bodyD.c_velocity.w,u=tX.neo(e),p=tX.neo(s),y=tX.neo(a),d=tX.neo(c);if(this.m_mass=0,this.m_type1==oP.TYPE)this.m_JvAC=G.zero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{var f=tX.mulVec2(y,this.m_localAxisC),v=tX.mulSub(y,this.m_localAnchorC,this.m_lcC),x=tX.mulSub(u,this.m_localAnchorA,this.m_lcA);this.m_JvAC=f,this.m_JwC=G.crossVec2Vec2(v,f),this.m_JwA=G.crossVec2Vec2(x,f),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_type2==oP.TYPE)this.m_JvBD=G.zero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{var f=tX.mulVec2(d,this.m_localAxisD),A=tX.mulSub(d,this.m_localAnchorD,this.m_lcD),g=tX.mulSub(p,this.m_localAnchorB,this.m_lcB);this.m_JvBD=G.mulNumVec2(this.m_ratio,f),this.m_JwD=this.m_ratio*G.crossVec2Vec2(A,f),this.m_JwB=this.m_ratio*G.crossVec2Vec2(g,f),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,t.warmStarting?(i.addMul(this.m_mA*this.m_impulse,this.m_JvAC),o+=this.m_iA*this.m_impulse*this.m_JwA,n.addMul(this.m_mB*this.m_impulse,this.m_JvBD),r+=this.m_iB*this.m_impulse*this.m_JwB,m.subMul(this.m_mC*this.m_impulse,this.m_JvAC),h-=this.m_iC*this.m_impulse*this.m_JwC,l.subMul(this.m_mD*this.m_impulse,this.m_JvBD),_-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,this.m_bodyA.c_velocity.v.setVec2(i),this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v.setVec2(n),this.m_bodyB.c_velocity.w=r,this.m_bodyC.c_velocity.v.setVec2(m),this.m_bodyC.c_velocity.w=h,this.m_bodyD.c_velocity.v.setVec2(l),this.m_bodyD.c_velocity.w=_},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=this.m_bodyC.c_velocity.v,r=this.m_bodyC.c_velocity.w,a=this.m_bodyD.c_velocity.v,m=this.m_bodyD.c_velocity.w,h=G.dot(this.m_JvAC,e)-G.dot(this.m_JvAC,n)+G.dot(this.m_JvBD,o)-G.dot(this.m_JvBD,a);h+=this.m_JwA*i-this.m_JwC*r+(this.m_JwB*s-this.m_JwD*m);var c=-this.m_mass*h;this.m_impulse+=c,e.addMul(this.m_mA*c,this.m_JvAC),i+=this.m_iA*c*this.m_JwA,o.addMul(this.m_mB*c,this.m_JvBD),s+=this.m_iB*c*this.m_JwB,n.subMul(this.m_mC*c,this.m_JvAC),r-=this.m_iC*c*this.m_JwC,a.subMul(this.m_mD*c,this.m_JvBD),m-=this.m_iD*c*this.m_JwD,this.m_bodyA.c_velocity.v.setVec2(e),this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v.setVec2(o),this.m_bodyB.c_velocity.w=s,this.m_bodyC.c_velocity.v.setVec2(n),this.m_bodyC.c_velocity.w=r,this.m_bodyD.c_velocity.v.setVec2(a),this.m_bodyD.c_velocity.w=m},e.prototype.solvePositionConstraints=function(t){var e,i,o,s,n,r,a,m,h=this.m_bodyA.c_position.c,c=this.m_bodyA.c_position.a,l=this.m_bodyB.c_position.c,_=this.m_bodyB.c_position.a,u=this.m_bodyC.c_position.c,p=this.m_bodyC.c_position.a,y=this.m_bodyD.c_position.c,d=this.m_bodyD.c_position.a,f=tX.neo(c),v=tX.neo(_),x=tX.neo(p),A=tX.neo(d),g=0;if(this.m_type1==oP.TYPE)o=G.zero(),n=1,a=1,g+=this.m_iA+this.m_iC,e=c-p-this.m_referenceAngleA;else{var b=tX.mulVec2(x,this.m_localAxisC),B=tX.mulSub(x,this.m_localAnchorC,this.m_lcC),w=tX.mulSub(f,this.m_localAnchorA,this.m_lcA);o=b,a=G.crossVec2Vec2(B,b),n=G.crossVec2Vec2(w,b),g+=this.m_mC+this.m_mA+this.m_iC*a*a+this.m_iA*n*n;var V=G.sub(this.m_localAnchorC,this.m_lcC),C=tX.mulTVec2(x,G.add(w,G.sub(h,u)));e=G.dot(G.sub(C,V),this.m_localAxisC)}if(this.m_type2==oP.TYPE)s=G.zero(),r=this.m_ratio,m=this.m_ratio,g+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),i=_-d-this.m_referenceAngleB;else{var b=tX.mulVec2(A,this.m_localAxisD),M=tX.mulSub(A,this.m_localAnchorD,this.m_lcD),I=tX.mulSub(v,this.m_localAnchorB,this.m_lcB);s=G.mulNumVec2(this.m_ratio,b),m=this.m_ratio*G.crossVec2Vec2(M,b),r=this.m_ratio*G.crossVec2Vec2(I,b),g+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*m*m+this.m_iB*r*r;var P=G.sub(this.m_localAnchorD,this.m_lcD),z=tX.mulTVec2(A,G.add(I,G.sub(l,y)));i=G.dot(z,this.m_localAxisD)-G.dot(P,this.m_localAxisD)}var S=e+this.m_ratio*i-this.m_constant,F=0;return g>0&&(F=-S/g),h.addMul(this.m_mA*F,o),c+=this.m_iA*F*n,l.addMul(this.m_mB*F,s),_+=this.m_iB*F*r,u.subMul(this.m_mC*F,o),p-=this.m_iC*F*a,y.subMul(this.m_mD*F,s),d-=this.m_iD*F*m,this.m_bodyA.c_position.c.setVec2(h),this.m_bodyA.c_position.a=c,this.m_bodyB.c_position.c.setVec2(l),this.m_bodyB.c_position.a=_,this.m_bodyC.c_position.c.setVec2(u),this.m_bodyC.c_position.a=p,this.m_bodyD.c_position.c.setVec2(y),this.m_bodyD.c_position.a=d,0<to.linearSlop},e.TYPE="gear-joint",e}(ey),oN={maxForce:1,maxTorque:1,correctionFactor:.3},oj=function(t){function e(i,o,s){var n=this;return n instanceof e?(i=O(i,oN),o=(n=t.call(this,i,o,s)||this).m_bodyA,s=n.m_bodyB,n.m_type=e.TYPE,n.m_linearOffset=G.isValid(i.linearOffset)?G.clone(i.linearOffset):o.getLocalPoint(s.getPosition()),n.m_angularOffset=Number.isFinite(i.angularOffset)?i.angularOffset:s.getAngle()-o.getAngle(),n.m_linearImpulse=G.zero(),n.m_angularImpulse=0,n.m_maxForce=i.maxForce,n.m_maxTorque=i.maxTorque,n.m_correctionFactor=i.correctionFactor,n):new e(i,o,s)}return D(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,maxForce:this.m_maxForce,maxTorque:this.m_maxTorque,correctionFactor:this.m_correctionFactor,linearOffset:this.m_linearOffset,angularOffset:this.m_angularOffset}},e._deserialize=function(t,i,o){return(t=R({},t)).bodyA=o(eu,t.bodyA,i),t.bodyB=o(eu,t.bodyB,i),new e(t)},e.prototype._reset=function(t){Number.isFinite(t.angularOffset)&&(this.m_angularOffset=t.angularOffset),Number.isFinite(t.maxForce)&&(this.m_maxForce=t.maxForce),Number.isFinite(t.maxTorque)&&(this.m_maxTorque=t.maxTorque),Number.isFinite(t.correctionFactor)&&(this.m_correctionFactor=t.correctionFactor),G.isValid(t.linearOffset)&&this.m_linearOffset.set(t.linearOffset)},e.prototype.setMaxForce=function(t){this.m_maxForce=t},e.prototype.getMaxForce=function(){return this.m_maxForce},e.prototype.setMaxTorque=function(t){this.m_maxTorque=t},e.prototype.getMaxTorque=function(){return this.m_maxTorque},e.prototype.setCorrectionFactor=function(t){this.m_correctionFactor=t},e.prototype.getCorrectionFactor=function(){return this.m_correctionFactor},e.prototype.setLinearOffset=function(t){(t.x!=this.m_linearOffset.x||t.y!=this.m_linearOffset.y)&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_linearOffset.set(t))},e.prototype.getLinearOffset=function(){return this.m_linearOffset},e.prototype.setAngularOffset=function(t){t!=this.m_angularOffset&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_angularOffset=t)},e.prototype.getAngularOffset=function(){return this.m_angularOffset},e.prototype.getAnchorA=function(){return this.m_bodyA.getPosition()},e.prototype.getAnchorB=function(){return this.m_bodyB.getPosition()},e.prototype.getReactionForce=function(t){return G.mulNumVec2(t,this.m_linearImpulse)},e.prototype.getReactionTorque=function(t){return t*this.m_angularImpulse},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,o=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,a=this.m_bodyB.c_velocity.v,m=this.m_bodyB.c_velocity.w,h=tX.neo(i),c=tX.neo(r);this.m_rA=tX.mulVec2(h,G.sub(this.m_linearOffset,this.m_localCenterA)),this.m_rB=tX.mulVec2(c,G.neg(this.m_localCenterB));var l=this.m_invMassA,_=this.m_invMassB,u=this.m_invIA,p=this.m_invIB,y=new ih;if(y.ex.x=l+_+u*this.m_rA.y*this.m_rA.y+p*this.m_rB.y*this.m_rB.y,y.ex.y=-u*this.m_rA.x*this.m_rA.y-p*this.m_rB.x*this.m_rB.y,y.ey.x=y.ex.y,y.ey.y=l+_+u*this.m_rA.x*this.m_rA.x+p*this.m_rB.x*this.m_rB.x,this.m_linearMass=y.getInverse(),this.m_angularMass=u+p,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),this.m_linearError=G.zero(),this.m_linearError.addCombine(1,n,1,this.m_rB),this.m_linearError.subCombine(1,e,1,this.m_rA),this.m_angularError=r-i-this.m_angularOffset,t.warmStarting){this.m_linearImpulse.mul(t.dtRatio),this.m_angularImpulse*=t.dtRatio;var d=G.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);o.subMul(l,d),s-=u*(G.crossVec2Vec2(this.m_rA,d)+this.m_angularImpulse),a.addMul(_,d),m+=p*(G.crossVec2Vec2(this.m_rB,d)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=o,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=a,this.m_bodyB.c_velocity.w=m},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,a=this.m_invIA,m=this.m_invIB,h=t.dt,c=t.inv_dt,l=s-i+c*this.m_correctionFactor*this.m_angularError,_=-this.m_angularMass*l,u=this.m_angularImpulse,p=h*this.m_maxTorque;this.m_angularImpulse=J(this.m_angularImpulse+_,-p,p),i-=a*(_=this.m_angularImpulse-u),s+=m*_;var l=G.zero();l.addCombine(1,o,1,G.crossNumVec2(s,this.m_rB)),l.subCombine(1,e,1,G.crossNumVec2(i,this.m_rA)),l.addMul(c*this.m_correctionFactor,this.m_linearError);var _=G.neg(ih.mulVec2(this.m_linearMass,l)),u=G.clone(this.m_linearImpulse);this.m_linearImpulse.add(_);var p=h*this.m_maxForce;this.m_linearImpulse.clamp(p),_=G.sub(this.m_linearImpulse,u),e.subMul(n,_),i-=a*G.crossVec2Vec2(this.m_rA,_),o.addMul(r,_),s+=m*G.crossVec2Vec2(this.m_rB,_),this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=o,this.m_bodyB.c_velocity.w=s},e.prototype.solvePositionConstraints=function(t){return!0},e.TYPE="motor-joint",e}(ey),oD=Math.PI,oR={maxForce:0,frequencyHz:5,dampingRatio:.7},oO=function(t){function e(i,o,s,n){var r=this;return r instanceof e?(i=O(i,oR),o=(r=t.call(this,i,o,s)||this).m_bodyA,s=r.m_bodyB,r.m_type=e.TYPE,G.isValid(n)?r.m_targetA=G.clone(n):G.isValid(i.target)?r.m_targetA=G.clone(i.target):r.m_targetA=G.zero(),r.m_localAnchorB=t1.mulTVec2(s.getTransform(),r.m_targetA),r.m_maxForce=i.maxForce,r.m_impulse=G.zero(),r.m_frequencyHz=i.frequencyHz,r.m_dampingRatio=i.dampingRatio,r.m_beta=0,r.m_gamma=0,r.m_rB=G.zero(),r.m_localCenterB=G.zero(),r.m_invMassB=0,r.m_invIB=0,r.m_mass=new ih,r.m_C=G.zero(),r):new e(i,o,s,n)}return D(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,target:this.m_targetA,maxForce:this.m_maxForce,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,_localAnchorB:this.m_localAnchorB}},e._deserialize=function(t,i,o){(t=R({},t)).bodyA=o(eu,t.bodyA,i),t.bodyB=o(eu,t.bodyB,i),t.target=G.clone(t.target);var s=new e(t);return t._localAnchorB&&(s.m_localAnchorB=t._localAnchorB),s},e.prototype._reset=function(t){Number.isFinite(t.maxForce)&&(this.m_maxForce=t.maxForce),Number.isFinite(t.frequencyHz)&&(this.m_frequencyHz=t.frequencyHz),Number.isFinite(t.dampingRatio)&&(this.m_dampingRatio=t.dampingRatio)},e.prototype.setTarget=function(t){G.areEqual(t,this.m_targetA)||(this.m_bodyB.setAwake(!0),this.m_targetA.set(t))},e.prototype.getTarget=function(){return this.m_targetA},e.prototype.setMaxForce=function(t){this.m_maxForce=t},e.prototype.getMaxForce=function(){return this.m_maxForce},e.prototype.setFrequency=function(t){this.m_frequencyHz=t},e.prototype.getFrequency=function(){return this.m_frequencyHz},e.prototype.setDampingRatio=function(t){this.m_dampingRatio=t},e.prototype.getDampingRatio=function(){return this.m_dampingRatio},e.prototype.getAnchorA=function(){return G.clone(this.m_targetA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return G.mulNumVec2(t,this.m_impulse)},e.prototype.getReactionTorque=function(t){return 0*t},e.prototype.shiftOrigin=function(t){this.m_targetA.sub(t)},e.prototype.initVelocityConstraints=function(t){this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyB.c_position,i=this.m_bodyB.c_velocity,o=e.c,s=e.a,n=i.v,r=i.w,a=tX.neo(s),m=this.m_bodyB.getMass(),h=2*oD*this.m_frequencyHz,c=2*m*this.m_dampingRatio*h,l=h*h*m,_=t.dt;this.m_gamma=_*(c+_*l),0!=this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=_*l*this.m_gamma,this.m_rB=tX.mulVec2(a,G.sub(this.m_localAnchorB,this.m_localCenterB));var u=new ih;u.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,u.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,u.ey.x=u.ex.y,u.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,this.m_mass=u.getInverse(),this.m_C.setVec2(o),this.m_C.addCombine(1,this.m_rB,-1,this.m_targetA),this.m_C.mul(this.m_beta),r*=.98,t.warmStarting?(this.m_impulse.mul(t.dtRatio),n.addMul(this.m_invMassB,this.m_impulse),r+=this.m_invIB*G.crossVec2Vec2(this.m_rB,this.m_impulse)):this.m_impulse.setZero(),i.v.setVec2(n),i.w=r},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyB.c_velocity,i=G.clone(e.v),o=e.w,s=G.crossNumVec2(o,this.m_rB);s.add(i),s.addCombine(1,this.m_C,this.m_gamma,this.m_impulse),s.neg();var n=ih.mulVec2(this.m_mass,s),r=G.clone(this.m_impulse);this.m_impulse.add(n);var a=t.dt*this.m_maxForce;this.m_impulse.clamp(a),n=G.sub(this.m_impulse,r),i.addMul(this.m_invMassB,n),o+=this.m_invIB*G.crossVec2Vec2(this.m_rB,n),e.v.setVec2(i),e.w=o},e.prototype.solvePositionConstraints=function(t){return!0},e.TYPE="mouse-joint",e}(ey),oE=Math.abs,oY={collideConnected:!0},oW=function(t){function e(i,o,s,n,r,a,m,h){var c=this;return c instanceof e?(i=O(i,oY),o=(c=t.call(this,i,o,s)||this).m_bodyA,s=c.m_bodyB,c.m_type=e.TYPE,c.m_groundAnchorA=G.clone(n||i.groundAnchorA||G.neo(-1,1)),c.m_groundAnchorB=G.clone(r||i.groundAnchorB||G.neo(1,1)),c.m_localAnchorA=G.clone(a?o.getLocalPoint(a):i.localAnchorA||G.neo(-1,0)),c.m_localAnchorB=G.clone(m?s.getLocalPoint(m):i.localAnchorB||G.neo(1,0)),c.m_lengthA=Number.isFinite(i.lengthA)?i.lengthA:G.distance(a,n),c.m_lengthB=Number.isFinite(i.lengthB)?i.lengthB:G.distance(m,r),c.m_ratio=Number.isFinite(h)?h:i.ratio,c.m_constant=c.m_lengthA+c.m_ratio*c.m_lengthB,c.m_impulse=0,c):new e(i,o,s,n,r,a,m,h)}return D(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,groundAnchorA:this.m_groundAnchorA,groundAnchorB:this.m_groundAnchorB,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,lengthA:this.m_lengthA,lengthB:this.m_lengthB,ratio:this.m_ratio}},e._deserialize=function(t,i,o){return(t=R({},t)).bodyA=o(eu,t.bodyA,i),t.bodyB=o(eu,t.bodyB,i),new e(t)},e.prototype._reset=function(t){G.isValid(t.groundAnchorA)&&this.m_groundAnchorA.set(t.groundAnchorA),G.isValid(t.groundAnchorB)&&this.m_groundAnchorB.set(t.groundAnchorB),G.isValid(t.localAnchorA)?this.m_localAnchorA.set(t.localAnchorA):G.isValid(t.anchorA)&&this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(t.anchorA)),G.isValid(t.localAnchorB)?this.m_localAnchorB.set(t.localAnchorB):G.isValid(t.anchorB)&&this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(t.anchorB)),Number.isFinite(t.lengthA)&&(this.m_lengthA=t.lengthA),Number.isFinite(t.lengthB)&&(this.m_lengthB=t.lengthB),Number.isFinite(t.ratio)&&(this.m_ratio=t.ratio)},e.prototype.getGroundAnchorA=function(){return this.m_groundAnchorA},e.prototype.getGroundAnchorB=function(){return this.m_groundAnchorB},e.prototype.getLengthA=function(){return this.m_lengthA},e.prototype.getLengthB=function(){return this.m_lengthB},e.prototype.getRatio=function(){return this.m_ratio},e.prototype.getCurrentLengthA=function(){var t=this.m_bodyA.getWorldPoint(this.m_localAnchorA),e=this.m_groundAnchorA;return G.distance(t,e)},e.prototype.getCurrentLengthB=function(){var t=this.m_bodyB.getWorldPoint(this.m_localAnchorB),e=this.m_groundAnchorB;return G.distance(t,e)},e.prototype.shiftOrigin=function(t){this.m_groundAnchorA.sub(t),this.m_groundAnchorB.sub(t)},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return G.mulNumVec2(this.m_impulse,this.m_uB).mul(t)},e.prototype.getReactionTorque=function(t){return 0},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,o=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,a=this.m_bodyB.c_velocity.v,m=this.m_bodyB.c_velocity.w,h=tX.neo(i),c=tX.neo(r);this.m_rA=tX.mulVec2(h,G.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=tX.mulVec2(c,G.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_uA=G.sub(G.add(e,this.m_rA),this.m_groundAnchorA),this.m_uB=G.sub(G.add(n,this.m_rB),this.m_groundAnchorB);var l=this.m_uA.length(),_=this.m_uB.length();l>10*to.linearSlop?this.m_uA.mul(1/l):this.m_uA.setZero(),_>10*to.linearSlop?this.m_uB.mul(1/_):this.m_uB.setZero();var u=G.crossVec2Vec2(this.m_rA,this.m_uA),p=G.crossVec2Vec2(this.m_rB,this.m_uB),y=this.m_invMassA+this.m_invIA*u*u,d=this.m_invMassB+this.m_invIB*p*p;if(this.m_mass=y+this.m_ratio*this.m_ratio*d,this.m_mass>0&&(this.m_mass=1/this.m_mass),t.warmStarting){this.m_impulse*=t.dtRatio;var f=G.mulNumVec2(-this.m_impulse,this.m_uA),v=G.mulNumVec2(-this.m_ratio*this.m_impulse,this.m_uB);o.addMul(this.m_invMassA,f),s+=this.m_invIA*G.crossVec2Vec2(this.m_rA,f),a.addMul(this.m_invMassB,v),m+=this.m_invIB*G.crossVec2Vec2(this.m_rB,v)}else this.m_impulse=0;this.m_bodyA.c_velocity.v=o,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=a,this.m_bodyB.c_velocity.w=m},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=G.add(e,G.crossNumVec2(i,this.m_rA)),r=G.add(o,G.crossNumVec2(s,this.m_rB)),a=-G.dot(this.m_uA,n)-this.m_ratio*G.dot(this.m_uB,r),m=-this.m_mass*a;this.m_impulse+=m;var h=G.mulNumVec2(-m,this.m_uA),c=G.mulNumVec2(-this.m_ratio*m,this.m_uB);e.addMul(this.m_invMassA,h),i+=this.m_invIA*G.crossVec2Vec2(this.m_rA,h),o.addMul(this.m_invMassB,c),s+=this.m_invIB*G.crossVec2Vec2(this.m_rB,c),this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=o,this.m_bodyB.c_velocity.w=s},e.prototype.solvePositionConstraints=function(t){var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,o=this.m_bodyB.c_position.c,s=this.m_bodyB.c_position.a,n=tX.neo(i),r=tX.neo(s),a=tX.mulVec2(n,G.sub(this.m_localAnchorA,this.m_localCenterA)),m=tX.mulVec2(r,G.sub(this.m_localAnchorB,this.m_localCenterB)),h=G.sub(G.add(e,this.m_rA),this.m_groundAnchorA),c=G.sub(G.add(o,this.m_rB),this.m_groundAnchorB),l=h.length(),_=c.length();l>10*to.linearSlop?h.mul(1/l):h.setZero(),_>10*to.linearSlop?c.mul(1/_):c.setZero();var u=G.crossVec2Vec2(a,h),p=G.crossVec2Vec2(m,c),y=this.m_invMassA+this.m_invIA*u*u,d=this.m_invMassB+this.m_invIB*p*p,f=y+this.m_ratio*this.m_ratio*d;f>0&&(f=1/f);var v=this.m_constant-l-this.m_ratio*_,x=oE(v),A=-f*v,g=G.mulNumVec2(-A,h),b=G.mulNumVec2(-this.m_ratio*A,c);return e.addMul(this.m_invMassA,g),i+=this.m_invIA*G.crossVec2Vec2(a,g),o.addMul(this.m_invMassB,b),s+=this.m_invIB*G.crossVec2Vec2(m,b),this.m_bodyA.c_position.c=e,this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c=o,this.m_bodyB.c_position.a=s,x<to.linearSlop},e.TYPE="pulley-joint",e}(ey),oJ=Math.min;(m=v||(v={}))[m.inactiveLimit=0]="inactiveLimit",m[m.atLowerLimit=1]="atLowerLimit",m[m.atUpperLimit=2]="atUpperLimit",m[m.equalLimits=3]="equalLimits";var oH={maxLength:0},oU=function(t){function e(i,o,s,n){var r=this;return r instanceof e?(i=O(i,oH),o=(r=t.call(this,i,o,s)||this).m_bodyA,s=r.m_bodyB,r.m_type=e.TYPE,r.m_localAnchorA=G.clone(n?o.getLocalPoint(n):i.localAnchorA||G.neo(-1,0)),r.m_localAnchorB=G.clone(n?s.getLocalPoint(n):i.localAnchorB||G.neo(1,0)),r.m_maxLength=i.maxLength,r.m_mass=0,r.m_impulse=0,r.m_length=0,r.m_state=v.inactiveLimit,r):new e(i,o,s,n)}return D(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,maxLength:this.m_maxLength}},e._deserialize=function(t,i,o){return(t=R({},t)).bodyA=o(eu,t.bodyA,i),t.bodyB=o(eu,t.bodyB,i),new e(t)},e.prototype._reset=function(t){Number.isFinite(t.maxLength)&&(this.m_maxLength=t.maxLength)},e.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.setMaxLength=function(t){this.m_maxLength=t},e.prototype.getMaxLength=function(){return this.m_maxLength},e.prototype.getLimitState=function(){return this.m_state},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return G.mulNumVec2(this.m_impulse,this.m_u).mul(t)},e.prototype.getReactionTorque=function(t){return 0},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,o=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,a=this.m_bodyB.c_velocity.v,m=this.m_bodyB.c_velocity.w,h=tX.neo(i),c=tX.neo(r);if(this.m_rA=tX.mulSub(h,this.m_localAnchorA,this.m_localCenterA),this.m_rB=tX.mulSub(c,this.m_localAnchorB,this.m_localCenterB),this.m_u=G.zero(),this.m_u.addCombine(1,n,1,this.m_rB),this.m_u.subCombine(1,e,1,this.m_rA),this.m_length=this.m_u.length(),this.m_length-this.m_maxLength>0?this.m_state=v.atUpperLimit:this.m_state=v.inactiveLimit,this.m_length>to.linearSlop)this.m_u.mul(1/this.m_length);else{this.m_u.setZero(),this.m_mass=0,this.m_impulse=0;return}var l=G.crossVec2Vec2(this.m_rA,this.m_u),_=G.crossVec2Vec2(this.m_rB,this.m_u),u=this.m_invMassA+this.m_invIA*l*l+this.m_invMassB+this.m_invIB*_*_;if(this.m_mass=0!=u?1/u:0,t.warmStarting){this.m_impulse*=t.dtRatio;var p=G.mulNumVec2(this.m_impulse,this.m_u);o.subMul(this.m_invMassA,p),s-=this.m_invIA*G.crossVec2Vec2(this.m_rA,p),a.addMul(this.m_invMassB,p),m+=this.m_invIB*G.crossVec2Vec2(this.m_rB,p)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.setVec2(o),this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v.setVec2(a),this.m_bodyB.c_velocity.w=m},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=G.addCrossNumVec2(e,i,this.m_rA),r=G.addCrossNumVec2(o,s,this.m_rB),a=this.m_length-this.m_maxLength,m=G.dot(this.m_u,G.sub(r,n));a<0&&(m+=t.inv_dt*a);var h=-this.m_mass*m,c=this.m_impulse;this.m_impulse=oJ(0,this.m_impulse+h),h=this.m_impulse-c;var l=G.mulNumVec2(h,this.m_u);e.subMul(this.m_invMassA,l),i-=this.m_invIA*G.crossVec2Vec2(this.m_rA,l),o.addMul(this.m_invMassB,l),s+=this.m_invIB*G.crossVec2Vec2(this.m_rB,l),this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=o,this.m_bodyB.c_velocity.w=s},e.prototype.solvePositionConstraints=function(t){var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,o=this.m_bodyB.c_position.c,s=this.m_bodyB.c_position.a,n=tX.neo(i),r=tX.neo(s),a=tX.mulSub(n,this.m_localAnchorA,this.m_localCenterA),m=tX.mulSub(r,this.m_localAnchorB,this.m_localCenterB),h=G.zero();h.addCombine(1,o,1,m),h.subCombine(1,e,1,a);var c=h.normalize(),l=c-this.m_maxLength;l=J(l,0,to.maxLinearCorrection);var _=-this.m_mass*l,u=G.mulNumVec2(_,h);return e.subMul(this.m_invMassA,u),i-=this.m_invIA*G.crossVec2Vec2(a,u),o.addMul(this.m_invMassB,u),s+=this.m_invIB*G.crossVec2Vec2(m,u),this.m_bodyA.c_position.c.setVec2(e),this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c.setVec2(o),this.m_bodyB.c_position.a=s,c-this.m_maxLength<to.linearSlop},e.TYPE="rope-joint",e}(ey),oK=Math.abs,oZ=Math.PI,oX={frequencyHz:0,dampingRatio:0},oG=function(t){function e(i,o,s,n){var r=this;return r instanceof e?(i=O(i,oX),o=(r=t.call(this,i,o,s)||this).m_bodyA,s=r.m_bodyB,r.m_type=e.TYPE,r.m_localAnchorA=G.clone(n?o.getLocalPoint(n):i.localAnchorA||G.zero()),r.m_localAnchorB=G.clone(n?s.getLocalPoint(n):i.localAnchorB||G.zero()),r.m_referenceAngle=Number.isFinite(i.referenceAngle)?i.referenceAngle:s.getAngle()-o.getAngle(),r.m_frequencyHz=i.frequencyHz,r.m_dampingRatio=i.dampingRatio,r.m_impulse=new oe,r.m_bias=0,r.m_gamma=0,r.m_mass=new oM,r):new e(i,o,s,n)}return D(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,referenceAngle:this.m_referenceAngle}},e._deserialize=function(t,i,o){return(t=R({},t)).bodyA=o(eu,t.bodyA,i),t.bodyB=o(eu,t.bodyB,i),new e(t)},e.prototype._reset=function(t){t.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.setVec2(t.localAnchorA),t.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.setVec2(t.localAnchorB),Number.isFinite(t.frequencyHz)&&(this.m_frequencyHz=t.frequencyHz),Number.isFinite(t.dampingRatio)&&(this.m_dampingRatio=t.dampingRatio)},e.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.getReferenceAngle=function(){return this.m_referenceAngle},e.prototype.setFrequency=function(t){this.m_frequencyHz=t},e.prototype.getFrequency=function(){return this.m_frequencyHz},e.prototype.setDampingRatio=function(t){this.m_dampingRatio=t},e.prototype.getDampingRatio=function(){return this.m_dampingRatio},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return G.neo(this.m_impulse.x,this.m_impulse.y).mul(t)},e.prototype.getReactionTorque=function(t){return t*this.m_impulse.z},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,a=tX.neo(e),m=tX.neo(s);this.m_rA=tX.mulVec2(a,G.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=tX.mulVec2(m,G.sub(this.m_localAnchorB,this.m_localCenterB));var h=this.m_invMassA,c=this.m_invMassB,l=this.m_invIA,_=this.m_invIB,u=new oM;if(u.ex.x=h+c+this.m_rA.y*this.m_rA.y*l+this.m_rB.y*this.m_rB.y*_,u.ey.x=-this.m_rA.y*this.m_rA.x*l-this.m_rB.y*this.m_rB.x*_,u.ez.x=-this.m_rA.y*l-this.m_rB.y*_,u.ex.y=u.ey.x,u.ey.y=h+c+this.m_rA.x*this.m_rA.x*l+this.m_rB.x*this.m_rB.x*_,u.ez.y=this.m_rA.x*l+this.m_rB.x*_,u.ex.z=u.ez.x,u.ey.z=u.ez.y,u.ez.z=l+_,this.m_frequencyHz>0){u.getInverse22(this.m_mass);var p=l+_,y=p>0?1/p:0,d=s-e-this.m_referenceAngle,f=2*oZ*this.m_frequencyHz,v=2*y*this.m_dampingRatio*f,x=y*f*f,A=t.dt;this.m_gamma=A*(v+A*x),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=d*A*x*this.m_gamma,p+=this.m_gamma,this.m_mass.ez.z=0!=p?1/p:0}else 0==u.ez.z?u.getInverse22(this.m_mass):u.getSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0;if(t.warmStarting){this.m_impulse.mul(t.dtRatio);var g=G.neo(this.m_impulse.x,this.m_impulse.y);i.subMul(h,g),o-=l*(G.crossVec2Vec2(this.m_rA,g)+this.m_impulse.z),n.addMul(c,g),r+=_*(G.crossVec2Vec2(this.m_rB,g)+this.m_impulse.z)}else this.m_impulse.setZero();this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=r},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,a=this.m_invIA,m=this.m_invIB;if(this.m_frequencyHz>0){var h=s-i,c=-this.m_mass.ez.z*(h+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=c,i-=a*c,s+=m*c;var l=G.zero();l.addCombine(1,o,1,G.crossNumVec2(s,this.m_rB)),l.subCombine(1,e,1,G.crossNumVec2(i,this.m_rA));var _=G.neg(oM.mulVec2(this.m_mass,l));this.m_impulse.x+=_.x,this.m_impulse.y+=_.y;var u=G.clone(_);e.subMul(n,u),i-=a*G.crossVec2Vec2(this.m_rA,u),o.addMul(r,u),s+=m*G.crossVec2Vec2(this.m_rB,u)}else{var l=G.zero();l.addCombine(1,o,1,G.crossNumVec2(s,this.m_rB)),l.subCombine(1,e,1,G.crossNumVec2(i,this.m_rA));var h=s-i,p=new oe(l.x,l.y,h),y=oe.neg(oM.mulVec3(this.m_mass,p));this.m_impulse.add(y);var u=G.neo(y.x,y.y);e.subMul(n,u),i-=a*(G.crossVec2Vec2(this.m_rA,u)+y.z),o.addMul(r,u),s+=m*(G.crossVec2Vec2(this.m_rB,u)+y.z)}this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=o,this.m_bodyB.c_velocity.w=s},e.prototype.solvePositionConstraints=function(t){var e,i,o=this.m_bodyA.c_position.c,s=this.m_bodyA.c_position.a,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,a=tX.neo(s),m=tX.neo(r),h=this.m_invMassA,c=this.m_invMassB,l=this.m_invIA,_=this.m_invIB,u=tX.mulVec2(a,G.sub(this.m_localAnchorA,this.m_localCenterA)),p=tX.mulVec2(m,G.sub(this.m_localAnchorB,this.m_localCenterB)),y=new oM;if(y.ex.x=h+c+u.y*u.y*l+p.y*p.y*_,y.ey.x=-u.y*u.x*l-p.y*p.x*_,y.ez.x=-u.y*l-p.y*_,y.ex.y=y.ey.x,y.ey.y=h+c+u.x*u.x*l+p.x*p.x*_,y.ez.y=u.x*l+p.x*_,y.ex.z=y.ez.x,y.ey.z=y.ez.y,y.ez.z=l+_,this.m_frequencyHz>0){var d=G.zero();d.addCombine(1,n,1,p),d.subCombine(1,o,1,u),e=d.length(),i=0;var f=G.neg(y.solve22(d));o.subMul(h,f),s-=l*G.crossVec2Vec2(u,f),n.addMul(c,f),r+=_*G.crossVec2Vec2(p,f)}else{var d=G.zero();d.addCombine(1,n,1,p),d.subCombine(1,o,1,u);var v=r-s-this.m_referenceAngle;e=d.length(),i=oK(v);var x=new oe(d.x,d.y,v),A=new oe;if(y.ez.z>0)A=oe.neg(y.solve33(x));else{var g=G.neg(y.solve22(d));A.set(g.x,g.y,0)}var f=G.neo(A.x,A.y);o.subMul(h,f),s-=l*(G.crossVec2Vec2(u,f)+A.z),n.addMul(c,f),r+=_*(G.crossVec2Vec2(p,f)+A.z)}return this.m_bodyA.c_position.c=o,this.m_bodyA.c_position.a=s,this.m_bodyB.c_position.c=n,this.m_bodyB.c_position.a=r,e<=to.linearSlop&&i<=to.angularSlop},e.TYPE="weld-joint",e}(ey),o$=Math.abs,oQ=Math.PI,o0={enableMotor:!1,maxMotorTorque:0,motorSpeed:0,frequencyHz:2,dampingRatio:.7},o1=function(t){function e(i,o,s,n,r){var a=this;return a instanceof e?(i=O(i,o0),o=(a=t.call(this,i,o,s)||this).m_bodyA,s=a.m_bodyB,a.m_ax=G.zero(),a.m_ay=G.zero(),a.m_type=e.TYPE,a.m_localAnchorA=G.clone(n?o.getLocalPoint(n):i.localAnchorA||G.zero()),a.m_localAnchorB=G.clone(n?s.getLocalPoint(n):i.localAnchorB||G.zero()),G.isValid(r)?a.m_localXAxisA=o.getLocalVector(r):G.isValid(i.localAxisA)?a.m_localXAxisA=G.clone(i.localAxisA):G.isValid(i.localAxis)?a.m_localXAxisA=G.clone(i.localAxis):a.m_localXAxisA=G.neo(1,0),a.m_localYAxisA=G.crossNumVec2(1,a.m_localXAxisA),a.m_mass=0,a.m_impulse=0,a.m_motorMass=0,a.m_motorImpulse=0,a.m_springMass=0,a.m_springImpulse=0,a.m_maxMotorTorque=i.maxMotorTorque,a.m_motorSpeed=i.motorSpeed,a.m_enableMotor=i.enableMotor,a.m_frequencyHz=i.frequencyHz,a.m_dampingRatio=i.dampingRatio,a.m_bias=0,a.m_gamma=0,a):new e(i,o,s,n,r)}return D(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,enableMotor:this.m_enableMotor,maxMotorTorque:this.m_maxMotorTorque,motorSpeed:this.m_motorSpeed,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,localAxisA:this.m_localXAxisA}},e._deserialize=function(t,i,o){return(t=R({},t)).bodyA=o(eu,t.bodyA,i),t.bodyB=o(eu,t.bodyB,i),new e(t)},e.prototype._reset=function(t){t.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.setVec2(t.localAnchorA),t.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.setVec2(t.localAnchorB),t.localAxisA&&(this.m_localXAxisA.setVec2(t.localAxisA),this.m_localYAxisA.setVec2(G.crossNumVec2(1,t.localAxisA))),void 0!==t.enableMotor&&(this.m_enableMotor=t.enableMotor),Number.isFinite(t.maxMotorTorque)&&(this.m_maxMotorTorque=t.maxMotorTorque),Number.isFinite(t.motorSpeed)&&(this.m_motorSpeed=t.motorSpeed),Number.isFinite(t.frequencyHz)&&(this.m_frequencyHz=t.frequencyHz),Number.isFinite(t.dampingRatio)&&(this.m_dampingRatio=t.dampingRatio)},e.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.getLocalAxisA=function(){return this.m_localXAxisA},e.prototype.getJointTranslation=function(){var t=this.m_bodyA,e=this.m_bodyB,i=t.getWorldPoint(this.m_localAnchorA),o=e.getWorldPoint(this.m_localAnchorB),s=G.sub(o,i),n=t.getWorldVector(this.m_localXAxisA);return G.dot(s,n)},e.prototype.getJointSpeed=function(){var t=this.m_bodyA.m_angularVelocity;return this.m_bodyB.m_angularVelocity-t},e.prototype.isMotorEnabled=function(){return this.m_enableMotor},e.prototype.enableMotor=function(t){t!=this.m_enableMotor&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=t)},e.prototype.setMotorSpeed=function(t){t!=this.m_motorSpeed&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=t)},e.prototype.getMotorSpeed=function(){return this.m_motorSpeed},e.prototype.setMaxMotorTorque=function(t){t!=this.m_maxMotorTorque&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=t)},e.prototype.getMaxMotorTorque=function(){return this.m_maxMotorTorque},e.prototype.getMotorTorque=function(t){return t*this.m_motorImpulse},e.prototype.setSpringFrequencyHz=function(t){this.m_frequencyHz=t},e.prototype.getSpringFrequencyHz=function(){return this.m_frequencyHz},e.prototype.setSpringDampingRatio=function(t){this.m_dampingRatio=t},e.prototype.getSpringDampingRatio=function(){return this.m_dampingRatio},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return G.combine(this.m_impulse,this.m_ay,this.m_springImpulse,this.m_ax).mul(t)},e.prototype.getReactionTorque=function(t){return t*this.m_motorImpulse},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_invMassA,i=this.m_invMassB,o=this.m_invIA,s=this.m_invIB,n=this.m_bodyA.c_position.c,r=this.m_bodyA.c_position.a,a=this.m_bodyA.c_velocity.v,m=this.m_bodyA.c_velocity.w,h=this.m_bodyB.c_position.c,c=this.m_bodyB.c_position.a,l=this.m_bodyB.c_velocity.v,_=this.m_bodyB.c_velocity.w,u=tX.neo(r),p=tX.neo(c),y=tX.mulVec2(u,G.sub(this.m_localAnchorA,this.m_localCenterA)),d=tX.mulVec2(p,G.sub(this.m_localAnchorB,this.m_localCenterB)),f=G.zero();if(f.addCombine(1,h,1,d),f.subCombine(1,n,1,y),this.m_ay=tX.mulVec2(u,this.m_localYAxisA),this.m_sAy=G.crossVec2Vec2(G.add(f,y),this.m_ay),this.m_sBy=G.crossVec2Vec2(d,this.m_ay),this.m_mass=e+i+o*this.m_sAy*this.m_sAy+s*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_frequencyHz>0){this.m_ax=tX.mulVec2(u,this.m_localXAxisA),this.m_sAx=G.crossVec2Vec2(G.add(f,y),this.m_ax),this.m_sBx=G.crossVec2Vec2(d,this.m_ax);var v=e+i+o*this.m_sAx*this.m_sAx+s*this.m_sBx*this.m_sBx;if(v>0){this.m_springMass=1/v;var x=G.dot(f,this.m_ax),A=2*oQ*this.m_frequencyHz,g=2*this.m_springMass*this.m_dampingRatio*A,b=this.m_springMass*A*A,B=t.dt;this.m_gamma=B*(g+B*b),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=x*B*b*this.m_gamma,this.m_springMass=v+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=o+s,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),t.warmStarting){this.m_impulse*=t.dtRatio,this.m_springImpulse*=t.dtRatio,this.m_motorImpulse*=t.dtRatio;var w=G.combine(this.m_impulse,this.m_ay,this.m_springImpulse,this.m_ax),V=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,C=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;a.subMul(this.m_invMassA,w),m-=this.m_invIA*V,l.addMul(this.m_invMassB,w),_+=this.m_invIB*C}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.setVec2(a),this.m_bodyA.c_velocity.w=m,this.m_bodyB.c_velocity.v.setVec2(l),this.m_bodyB.c_velocity.w=_},e.prototype.solveVelocityConstraints=function(t){var e=this.m_invMassA,i=this.m_invMassB,o=this.m_invIA,s=this.m_invIB,n=this.m_bodyA.c_velocity.v,r=this.m_bodyA.c_velocity.w,a=this.m_bodyB.c_velocity.v,m=this.m_bodyB.c_velocity.w,h=G.dot(this.m_ax,a)-G.dot(this.m_ax,n)+this.m_sBx*m-this.m_sAx*r,c=-this.m_springMass*(h+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=c;var l=G.mulNumVec2(c,this.m_ax),_=c*this.m_sAx,u=c*this.m_sBx;n.subMul(e,l),r-=o*_,a.addMul(i,l);var h=(m+=s*u)-r-this.m_motorSpeed,c=-this.m_motorMass*h,p=this.m_motorImpulse,y=t.dt*this.m_maxMotorTorque;this.m_motorImpulse=J(this.m_motorImpulse+c,-y,y),r-=o*(c=this.m_motorImpulse-p),m+=s*c;var h=G.dot(this.m_ay,a)-G.dot(this.m_ay,n)+this.m_sBy*m-this.m_sAy*r,c=-this.m_mass*h;this.m_impulse+=c;var l=G.mulNumVec2(c,this.m_ay),_=c*this.m_sAy,u=c*this.m_sBy;n.subMul(e,l),r-=o*_,a.addMul(i,l),m+=s*u,this.m_bodyA.c_velocity.v.setVec2(n),this.m_bodyA.c_velocity.w=r,this.m_bodyB.c_velocity.v.setVec2(a),this.m_bodyB.c_velocity.w=m},e.prototype.solvePositionConstraints=function(t){var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,o=this.m_bodyB.c_position.c,s=this.m_bodyB.c_position.a,n=tX.neo(i),r=tX.neo(s),a=tX.mulVec2(n,G.sub(this.m_localAnchorA,this.m_localCenterA)),m=tX.mulVec2(r,G.sub(this.m_localAnchorB,this.m_localCenterB)),h=G.zero();h.addCombine(1,o,1,m),h.subCombine(1,e,1,a);var c=tX.mulVec2(n,this.m_localYAxisA),l=G.crossVec2Vec2(G.add(h,a),c),_=G.crossVec2Vec2(m,c),u=G.dot(h,c),p=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy,y=0!=p?-u/p:0,d=G.mulNumVec2(y,c),f=y*l,v=y*_;return e.subMul(this.m_invMassA,d),i-=this.m_invIA*f,o.addMul(this.m_invMassB,d),s+=this.m_invIB*v,this.m_bodyA.c_position.c.setVec2(e),this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c.setVec2(o),this.m_bodyB.c_position.a=s,o$(u)<=to.linearSlop},e.TYPE="wheel-joint",e}(ey),o2=0,o3={World:ot,Body:eu,Joint:ey,Fixture:eo,Shape:t8},o5={Vec2:G,Vec3:oe,World:ot,Body:eu,Joint:ey,Fixture:eo,Shape:t8},o9=((x={})[eu.STATIC]=eu,x[eu.DYNAMIC]=eu,x[eu.KINEMATIC]=eu,x[oa.TYPE]=oa,x[od.TYPE]=od,x[os.TYPE]=os,x[oA.TYPE]=oA,x[ow.TYPE]=ow,x[oC.TYPE]=oC,x[ok.TYPE]=ok,x[oj.TYPE]=oj,x[oO.TYPE]=oO,x[oT.TYPE]=oT,x[oW.TYPE]=oW,x[oP.TYPE]=oP,x[oU.TYPE]=oU,x[oG.TYPE]=oG,x[o1.TYPE]=o1,x),o6={rootClass:ot,preSerialize:function(t){return t},postSerialize:function(t,e){return t},preDeserialize:function(t){return t},postDeserialize:function(t,e){return t}},o8=function(t){var e=this;this.toJson=function(t){for(var i=e.options.preSerialize,o=e.options.postSerialize,s=[],n=[t],r={};n.length;){var a=function t(e,a){if(void 0===a&&(a=!1),"object"!=typeof e||null===e)return e;if("function"==typeof e._serialize){var m;if(!a){for(var h in o3)if(e instanceof o3[h])return function(t,e){if(t.__sid=t.__sid||++o2,!r[t.__sid]){n.push(t);var i=s.length+n.length;r[t.__sid]={refIndex:i,refType:e}}return r[t.__sid]}(e,h)}e=o((m=i(m=e))._serialize(),m)}if(Array.isArray(e)){for(var c=[],l=0;l<e.length;l++)c[l]=t(e[l]);e=c}else{var c={};for(var l in e)e.hasOwnProperty(l)&&(c[l]=t(e[l]));e=c}return e}(n.shift(),!0);s.push(a)}return s},this.fromJson=function(t){var i=e.options.preDeserialize,o=e.options.postDeserialize,s=e.options.rootClass,n={};function r(t,e,s){if(t&&t._deserialize||(t=o9[e.type]),t&&t._deserialize){e=i(e);var n=(0,t._deserialize)(e,s,a);return o(n,e)}}function a(e,i,o){if(!(i.refIndex&&i.refType))return r(e,i,o);o5[i.refType]&&(e=o5[i.refType]);var s=i.refIndex;if(!n[s]){var a=r(e,t[s],o);n[s]=a}return n[s]}return r(s,t[0],null)},this.options=R(R({},o6),t)},o4=new o8({rootClass:ot});o8.fromJson=o4.fromJson,o8.toJson=o4.toJson,function(){function t(){}t.mount=function(t){throw Error("Not implemented")},t.start=function(e){var i=t.mount();return i.start(e),i}}(),function(t){function e(i,o,s,n){var r=this;return r instanceof e?((r=t.call(this)||this)._setAsBox(i,o,s,n),r):new e(i,o,s,n)}D(e,t),e.TYPE="polygon"}(od),i4.addType(oA.TYPE,oA.TYPE,function(t,e,i,o,s,n,r){se(t,i.getShape(),e,n.getShape(),s)});var o7=tf(0,0),st=tf(0,0),se=function(t,e,i,o,s){t.pointCount=0,tY(o7,i,e.m_p),tY(st,s,o.m_p);var n=tj(st,o7),r=e.m_radius+o.m_radius;n>r*r||(t.type=u.e_circles,tx(t.localPoint,e.m_p),tA(t.localNormal),t.pointCount=1,tx(t.points[0].localPoint,o.m_p),t.points[0].id.setFeatures(0,p.e_vertex,0,p.e_vertex))};i4.addType(os.TYPE,oA.TYPE,function(t,e,i,o,s,n,r){sm(t,i.getShape(),e,n.getShape(),s)}),i4.addType(oa.TYPE,oA.TYPE,function(t,e,i,o,s,n,r){var a=i.getShape(),m=new os;a.getChildEdge(m,o),sm(t,m,e,n.getShape(),s)});var si=tf(0,0),so=tf(0,0),ss=tf(0,0),sn=tf(0,0),sr=tf(0,0),sa=tf(0,0),sm=function(t,e,i,o,s){t.pointCount=0,tJ(sn,s,i,o.m_p);var n=e.m_vertex1,r=e.m_vertex2;tw(si,r,n);var a=tq(si,r)-tq(si,sn),m=tq(si,sn)-tq(si,n),h=e.m_radius+o.m_radius;if(m<=0){if(tx(sr,n),tj(sn,n)>h*h)return;if(e.m_hasVertex0&&(tw(so,n,e.m_vertex0),tq(so,n)-tq(so,sn)>0))return;t.type=u.e_circles,tA(t.localNormal),tx(t.localPoint,sr),t.pointCount=1,tx(t.points[0].localPoint,o.m_p),t.points[0].id.setFeatures(0,p.e_vertex,0,p.e_vertex);return}if(a<=0){if(tx(sr,r),tj(sn,sr)>h*h)return;if(e.m_hasVertex3&&(tw(ss,e.m_vertex3,r),tq(ss,sn)-tq(ss,r)>0))return;t.type=u.e_circles,tA(t.localNormal),tx(t.localPoint,sr),t.pointCount=1,tx(t.points[0].localPoint,o.m_p),t.points[0].id.setFeatures(1,p.e_vertex,0,p.e_vertex);return}var c=tk(si);tP(sr,a/c,n,m/c,r),tj(sn,sr)>h*h||(tL(sa,1,si),tq(sa,sn)-tq(sa,n)<0&&tg(sa),tS(sa),t.type=u.e_faceA,tx(t.localNormal,sa),tx(t.localPoint,n),t.pointCount=1,tx(t.points[0].localPoint,o.m_p),t.points[0].id.setFeatures(0,p.e_face,0,p.e_vertex))},sh=[new iA,new iA],sc=[new iA,new iA],sl=[new iA,new iA],s_=tf(0,0),su=tf(0,0),sp=tf(0,0),sy=tO(0,0,0),sd=tf(0,0),sf=tf(0,0),sv=tf(0,0),sx=tf(0,0),sA=tf(0,0),sg=tf(0,0),sb=tf(0,0),sB=tf(0,0);function sw(t,e,i,o,s){var n=t.m_count,r=i.m_count,a=t.m_normals,m=t.m_vertices,h=i.m_vertices;tH(sy,o,e);for(var c=0,l=-1/0,_=0;_<n;++_){tD(sp,sy.q,a[_]),tY(su,sy,m[_]);for(var u=1/0,p=0;p<r;++p){var y=tq(sp,h[p])-tq(sp,su);y<u&&(u=y)}u>l&&(l=u,c=_)}s.maxSeparation=l,s.bestIndex=c}i4.addType(od.TYPE,od.TYPE,function(t,e,i,o,s,n,r){sC(t,i.getShape(),e,n.getShape(),s)});var sV={maxSeparation:0,bestIndex:0},sC=function(t,e,i,o,s){t.pointCount=0;var n,r,a,m,h,c,l=e.m_radius+o.m_radius;sw(e,i,o,s,sV);var _=sV.bestIndex,y=sV.maxSeparation;if(y>l)return;sw(o,s,e,i,sV);var d=sV.bestIndex,f=sV.maxSeparation;if(!(f>l)){f>y+.1*to.linearSlop?(n=o,r=e,a=s,m=i,h=d,t.type=u.e_faceB,c=!0):(n=e,r=o,a=i,m=s,h=_,t.type=u.e_faceA,c=!1),sh[0].recycle(),sh[1].recycle(),function(t,e,i,o,s,n){var r,a,m,h,c,l,_,u=e.m_normals,y=s.m_count,d=s.m_vertices,f=s.m_normals;r=n.q,a=i.q,m=u[o],h=r.c*m.x+r.s*m.y,c=-r.s*m.x+r.c*m.y,l=a.c*h-a.s*c,_=a.s*h+a.c*c,sB.x=l,sB.y=_;for(var v=0,x=1/0,A=0;A<y;++A){var g=tq(sB,f[A]);g<x&&(x=g,v=A)}var b=v,B=b+1<y?b+1:0;tY(t[0].v,n,d[b]),t[0].id.setFeatures(o,p.e_face,b,p.e_vertex),tY(t[1].v,n,d[B]),t[1].id.setFeatures(o,p.e_face,B,p.e_vertex)}(sh,n,a,h,r,m);var v=n.m_count,x=n.m_vertices,A=h,g=h+1<v?h+1:0;tx(sd,x[A]),tx(sf,x[g]),tw(sv,sf,sd),tS(sv),tF(sx,sv,1),tP(sA,.5,sd,.5,sf),tD(sg,a.q,sv),tF(sb,sg,1),tY(sd,a,sd),tY(sf,a,sf);var b=tq(sb,sd),B=-tq(sg,sd)+l,w=tq(sg,sf)+l;if((sc[0].recycle(),sc[1].recycle(),sl[0].recycle(),sl[1].recycle(),tv(s_,-sg.x,-sg.y),!(2>iC(sc,sh,s_,B,A)))&&(tv(s_,sg.x,sg.y),!(2>iC(sl,sc,s_,w,g)))){tx(t.localNormal,sx),tx(t.localPoint,sA);for(var V=0,C=0;C<sl.length;++C)if(tq(sb,sl[C].v)-b<=l){var M=t.points[V];tW(M.localPoint,m,sl[C].v),M.id.set(sl[C].id),c&&M.id.swapFeatures(),++V}t.pointCount=V}}};i4.addType(od.TYPE,oA.TYPE,function(t,e,i,o,s,n,r){sP(t,i.getShape(),e,n.getShape(),s)});var sM=tf(0,0),sI=tf(0,0),sP=function(t,e,i,o,s){t.pointCount=0,tJ(sM,s,i,o.m_p);for(var n=0,r=-1/0,a=e.m_radius+o.m_radius,m=e.m_count,h=e.m_vertices,c=e.m_normals,l=0;l<m;++l){var _=tq(c[l],sM)-tq(c[l],h[l]);if(_>a)return;_>r&&(r=_,n=l)}var y=n,d=h[y],f=h[y+1<m?y+1:0];if(r<1e-9){t.pointCount=1,t.type=u.e_faceA,tx(t.localNormal,c[n]),tP(t.localPoint,.5,d,.5,f),tx(t.points[0].localPoint,o.m_p),t.points[0].id.setFeatures(0,p.e_vertex,0,p.e_vertex);return}var v=tq(sM,f)-tq(sM,d)-tq(d,f)+tq(d,d),x=tq(sM,d)-tq(sM,f)-tq(f,d)+tq(f,f);if(v<=0){if(tj(sM,d)>a*a)return;t.pointCount=1,t.type=u.e_faceA,tw(t.localNormal,sM,d),tS(t.localNormal),tx(t.localPoint,d),tx(t.points[0].localPoint,o.m_p),t.points[0].id.setFeatures(0,p.e_vertex,0,p.e_vertex)}else if(x<=0){if(tj(sM,f)>a*a)return;t.pointCount=1,t.type=u.e_faceA,tw(t.localNormal,sM,f),tS(t.localNormal),tx(t.localPoint,f),tx(t.points[0].localPoint,o.m_p),t.points[0].id.setFeatures(0,p.e_vertex,0,p.e_vertex)}else{if(tP(sI,.5,d,.5,f),tq(sM,c[y])-tq(sI,c[y])>a)return;t.pointCount=1,t.type=u.e_faceA,tx(t.localNormal,c[y]),tx(t.localPoint,sI),tx(t.points[0].localPoint,o.m_p),t.points[0].id.setFeatures(0,p.e_vertex,0,p.e_vertex)}},sz=Math.min;i4.addType(os.TYPE,od.TYPE,function(t,e,i,o,s,n,r){s0(t,i.getShape(),e,n.getShape(),s)}),i4.addType(oa.TYPE,od.TYPE,function(t,e,i,o,s,n,r){i.getShape().getChildEdge(sS,o),s0(t,sS,e,n.getShape(),s)});var sS=new os;(h=A||(A={}))[h.e_unknown=-1]="e_unknown",h[h.e_edgeA=1]="e_edgeA",h[h.e_edgeB=2]="e_edgeB",(c=g||(g={}))[c.e_isolated=0]="e_isolated",c[c.e_concave=1]="e_concave",c[c.e_convex=2]="e_convex";var sF=function(){},sL=function(){function t(){this.v1=tf(0,0),this.v2=tf(0,0),this.normal=tf(0,0),this.sideNormal1=tf(0,0),this.sideNormal2=tf(0,0)}return t.prototype.recycle=function(){tA(this.v1),tA(this.v2),tA(this.normal),tA(this.sideNormal1),tA(this.sideNormal2)},t}(),sT=[new iA,new iA],sq=[new iA,new iA],sk=[new iA,new iA],sN=new sF,sj=new sF,sD=new function(){this.vertices=[],this.normals=[],this.count=0;for(var t=0;t<to.maxPolygonVertices;t++)this.vertices.push(tf(0,0)),this.normals.push(tf(0,0))},sR=new sL,sO=tf(0,0),sE=tf(0,0),sY=tf(0,0),sW=tf(0,0),sJ=tO(0,0,0),sH=tf(0,0),sU=tf(0,0),sK=tf(0,0),sZ=tf(0,0),sX=tf(0,0),sG=tf(0,0),s$=tf(0,0),sQ=tf(0,0),s0=function(t,e,i,o,s){tH(sJ,i,s),tY(sO,sJ,o.m_centroid);var n,r,a=e.m_vertex0,m=e.m_vertex1,h=e.m_vertex2,c=e.m_vertex3,l=e.m_hasVertex0,_=e.m_hasVertex3;tw(sY,h,m),tS(sY),tv(sK,sY.y,-sY.x);var y=tq(sK,sO)-tq(sK,m),d=0,f=0,v=!1,x=!1;tA(sU),tA(sZ),l&&(tw(sE,m,a),tS(sE),tv(sU,sE.y,-sE.x),v=tT(sE,sY)>=0,d=G.dot(sU,sO)-G.dot(sU,a)),_&&(tw(sW,c,h),tS(sW),tv(sZ,sW.y,-sW.x),x=G.crossVec2Vec2(sY,sW)>0,f=G.dot(sZ,sO)-G.dot(sZ,h)),tA(sH),tA(sX),tA(sG),l&&_?v&&x?(n=d>=0||y>=0||f>=0)?(tx(sH,sK),tx(sX,sU),tx(sG,sZ)):(tC(sH,-1,sK),tC(sX,-1,sK),tC(sG,-1,sK)):v?(n=d>=0||y>=0&&f>=0)?(tx(sH,sK),tx(sX,sU),tx(sG,sK)):(tC(sH,-1,sK),tC(sX,-1,sZ),tC(sG,-1,sK)):x?(n=f>=0||d>=0&&y>=0)?(tx(sH,sK),tx(sX,sK),tx(sG,sZ)):(tC(sH,-1,sK),tC(sX,-1,sK),tC(sG,-1,sU)):(n=d>=0&&y>=0&&f>=0)?(tx(sH,sK),tx(sX,sK),tx(sG,sK)):(tC(sH,-1,sK),tC(sX,-1,sZ),tC(sG,-1,sU)):l?v?((n=d>=0||y>=0)?(tx(sH,sK),tx(sX,sU)):(tC(sH,-1,sK),tx(sX,sK)),tC(sG,-1,sK)):(n=d>=0&&y>=0)?(tx(sH,sK),tx(sX,sK),tC(sG,-1,sK)):(tC(sH,-1,sK),tx(sX,sK),tC(sG,-1,sU)):_?x?(n=y>=0||f>=0)?(tx(sH,sK),tC(sX,-1,sK),tx(sG,sZ)):(tC(sH,-1,sK),tC(sX,-1,sK),tx(sG,sK)):((n=y>=0&&f>=0)?(tx(sH,sK),tC(sX,-1,sK)):(tC(sH,-1,sK),tC(sX,-1,sZ)),tx(sG,sK)):(n=y>=0)?(tx(sH,sK),tC(sX,-1,sK),tC(sG,-1,sK)):(tC(sH,-1,sK),tx(sX,sK),tx(sG,sK)),sD.count=o.m_count;for(var g=0;g<o.m_count;++g)tY(sD.vertices[g],sJ,o.m_vertices[g]),tD(sD.normals[g],sJ.q,o.m_normals[g]);var b=o.m_radius+e.m_radius;t.pointCount=0,sN.type=A.e_edgeA,sN.index=+!n,sN.separation=1/0;for(var g=0;g<sD.count;++g){var B=tq(sH,sD.vertices[g])-tq(sH,m);B<sN.separation&&(sN.separation=B)}if(sN.type==A.e_unknown||sN.separation>b)return;sj.type=A.e_unknown,sj.index=-1,sj.separation=-1/0,tv(s$,-sH.y,sH.x);for(var g=0;g<sD.count;++g){tC(sQ,-1,sD.normals[g]);var B=sz(tq(sQ,sD.vertices[g])-tq(sQ,m),tq(sQ,sD.vertices[g])-tq(sQ,h));if(B>b){sj.type=A.e_edgeB,sj.index=g,sj.separation=B;break}if(tq(sQ,s$)>=0){if(tq(sQ,sH)-tq(sG,sH)<-to.angularSlop)continue}else if(tq(sQ,sH)-tq(sX,sH)<-to.angularSlop)continue;B>sj.separation&&(sj.type=A.e_edgeB,sj.index=g,sj.separation=B)}if(sj.type==A.e_unknown||!(sj.separation>b)){if(r=sj.type==A.e_unknown?sN:sj.separation>.98*sN.separation+.001?sj:sN,sk[0].recycle(),sk[1].recycle(),r.type==A.e_edgeA){t.type=u.e_faceA;for(var w=0,V=tq(sH,sD.normals[0]),g=1;g<sD.count;++g){var C=tq(sH,sD.normals[g]);C<V&&(V=C,w=g)}var M=w,I=M+1<sD.count?M+1:0;tx(sk[0].v,sD.vertices[M]),sk[0].id.setFeatures(0,p.e_face,M,p.e_vertex),tx(sk[1].v,sD.vertices[I]),sk[1].id.setFeatures(0,p.e_face,I,p.e_vertex),n?(sR.i1=0,sR.i2=1,tx(sR.v1,m),tx(sR.v2,h),tx(sR.normal,sK)):(sR.i1=1,sR.i2=0,tx(sR.v1,h),tx(sR.v2,m),tC(sR.normal,-1,sK))}else t.type=u.e_faceB,tx(sk[0].v,m),sk[0].id.setFeatures(0,p.e_vertex,r.index,p.e_face),tx(sk[1].v,h),sk[1].id.setFeatures(0,p.e_vertex,r.index,p.e_face),sR.i1=r.index,sR.i2=sR.i1+1<sD.count?sR.i1+1:0,tx(sR.v1,sD.vertices[sR.i1]),tx(sR.v2,sD.vertices[sR.i2]),tx(sR.normal,sD.normals[sR.i1]);if((tv(sR.sideNormal1,sR.normal.y,-sR.normal.x),tv(sR.sideNormal2,-sR.sideNormal1.x,-sR.sideNormal1.y),sR.sideOffset1=tq(sR.sideNormal1,sR.v1),sR.sideOffset2=tq(sR.sideNormal2,sR.v2),sT[0].recycle(),sT[1].recycle(),sq[0].recycle(),sq[1].recycle(),!(iC(sT,sk,sR.sideNormal1,sR.sideOffset1,sR.i1)<to.maxManifoldPoints))&&!(iC(sq,sT,sR.sideNormal2,sR.sideOffset2,sR.i2)<to.maxManifoldPoints)){r.type==A.e_edgeA?(tx(t.localNormal,sR.normal),tx(t.localPoint,sR.v1)):(tx(t.localNormal,o.m_normals[sR.i1]),tx(t.localPoint,o.m_vertices[sR.i1]));for(var P=0,g=0;g<to.maxManifoldPoints;++g)if(tq(sR.normal,sq[g].v)-tq(sR.normal,sR.v1)<=b){var z=t.points[P];r.type==A.e_edgeA?(tW(z.localPoint,sJ,sq[g].v),z.id.set(sq[g].id)):(tx(z.localPoint,sq[g].v),z.id.set(sq[g].id),z.id.swapFeatures()),++P}t.pointCount=P}}};function s1(t,e){this._refMap={},this._map={},this._xmap={},this._data=[],this._entered=[],this._exited=[],this._key=t,this._listener=e}function s2(){let t=(0,w.usePathname)(),e=t.replaceAll(/[/#]/g,""),{inputs:i,setInputs:o,inputsRef:s,resetInputs:n}=(0,T.default)(M,e),[r,a]=(0,B.useState)(0),{simData:m,updateSimInfo:h}=(0,q.default)(),c=(0,B.useCallback)((t,e)=>{o(i=>({...i,[t]:e}))},[o]),l=(0,B.useMemo)(()=>P.default.find(e=>e.link===t.pathname)?.theory,[t.pathname]),_=(0,B.useCallback)(t=>{let e={current:null},i={current:null},o={current:null},n={current:null},r=0,a=1/60;function m(t,a){let m=ot(G(0,0));e.current=m,function(t,i){let s=e.current;if(!s)return;let n=t/V.SCALE,r=i/V.SCALE,a=s.createBody();a.createFixture(os(G(0,0),G(n,0))),a.createFixture(os(G(0,r),G(n,r))),a.createFixture(os(G(0,0),G(0,r))),a.createFixture(os(G(n,0),G(n,r))),o.current=a}(t,a);let h=G(t/V.SCALE/2,a/V.SCALE/2),c=m.createBody({type:"dynamic",position:h,bullet:!0}),l=s.current.massKg,_=.2*Math.PI*.2;c.createFixture(oA(.2),{density:l/_,restitution:.2,friction:.2}),i.current=c,n.current=l,performance.now(),r=0}function c(){e.current=null,i.current=null,o.current=null}t.setup=()=>{let{clientWidth:e,clientHeight:i}=t._userNode;t.createCanvas(e,i),s.current.physicsEnabled&&m(e,i)},t.draw=()=>{let o,l,_,u,{clientWidth:p,clientHeight:y}=t._userNode;s.current.physicsEnabled&&!e.current?m(p,y):!s.current.physicsEnabled&&e.current&&c(),t.background((0,k.default)()),function(o){if(!s.current.physicsEnabled||!e.current||!i.current)return;let m=s.current.massKg;if(null==n.current||Math.abs(m-n.current)>1e-6){let t=.2*Math.PI*.2;i.current.getFixtureList().setDensity(m/t),i.current.resetMassData(),n.current=m}(0,C.isPaused)()||(r+=0*o);let h=t.createVector(t.width/2,t.height/2),c=t.createVector(t.mouseX,t.mouseY),l=s.current.operation,_=Math.max(1,s.current.pxPerNewton),u={x:h.x,y:h.y},p={x:c.x-h.x,y:c.y-h.y},y={x:u.x/_,y:u.y/_},d={x:p.x/_,y:p.y/_};"-"===l?d={x:-d.x,y:-d.y}:"x"===l&&(d={x:d.x*s.current.multiVector,y:d.y*s.current.multiVector},y={x:0,y:0});let f=0;for(;r>=a&&f<5;){let t=i.current;t.applyForce(G(y.x,y.y),t.getWorldCenter()),t.applyForce(G(d.x,d.y),t.getWorldCenter()),e.current.step(a),f++,r-=a}}((0,C.computeDelta)(t)),function(){let{strokeColor:e,strokeWeight:i,multiVector:o,operation:n,visualizeMode:r}=s.current,a=t.createVector(t.mouseX,t.mouseY),m=t.createVector(t.width/2,t.height/2);switch(t.push(),n){case"+":{let o=m.copy(),s=t.constructor.Vector.sub(a,m);if(t.strokeWeight(i),t.stroke(e),"triangle"===r)t.line(0,0,o.x,o.y),t.line(o.x,o.y,a.x,a.y),t.stroke((0,N.adjustColor)(e)),t.strokeWeight(i+1),t.line(0,0,a.x,a.y);else{let n=t.constructor.Vector.add(o,s);t.line(0,0,o.x,o.y),t.line(0,0,s.x,s.y),t.drawingContext.setLineDash([6,6]),t.line(o.x,o.y,n.x,n.y),t.line(s.x,s.y,n.x,n.y),t.drawingContext.setLineDash([]),t.stroke((0,N.adjustColor)(e)),t.strokeWeight(i+1),t.line(0,0,n.x,n.y)}break}case"-":{let o=m.copy(),s=t.constructor.Vector.sub(a,m);if(t.strokeWeight(i),t.stroke(e),"triangle"===r)t.line(0,0,o.x,o.y),t.line(0,0,a.x,a.y),t.stroke((0,N.adjustColor)(e)),t.strokeWeight(i+1),t.line(m.x,m.y,a.x,a.y);else{let n=t.constructor.Vector.mult(s,-1),r=t.constructor.Vector.add(o,n);t.line(0,0,o.x,o.y),t.line(0,0,n.x,n.y),t.drawingContext.setLineDash([6,6]),t.line(o.x,o.y,r.x,r.y),t.line(n.x,n.y,r.x,r.y),t.drawingContext.setLineDash([]),t.stroke((0,N.adjustColor)(e)),t.strokeWeight(i+1),t.line(0,0,r.x,r.y)}break}case"x":{a.sub(m),t.translate(t.width/2,t.height/2),t.strokeWeight(i),t.stroke(e),t.line(0,0,a.x,a.y);let s=a.copy().mult(o);if(t.strokeWeight(.8*i),t.stroke((0,N.adjustColor)(e)),t.line(a.x,a.y,s.x,s.y),o<0){t.stroke(200,200,200),t.strokeWeight(1);let e=a.copy().mult(-1);t.line(0,0,e.x,e.y)}break}case"normalize":{let o=t.constructor.Vector.sub(a,m),s=o.mag()||1,n=o.copy().div(s);t.translate(t.width/2,t.height/2),t.strokeWeight(i),t.stroke(e),t.line(0,0,o.x,o.y),t.stroke((0,N.adjustColor)(e)),t.line(0,0,100*n.x,100*n.y);break}case"dot":m.copy(),t.constructor.Vector.sub(a,m),t.strokeWeight(i),t.stroke(e),t.line(0,0,m.x,m.y),t.line(m.x,m.y,a.x,a.y),t.stroke((0,N.adjustColor)(e)),t.line(0,0,a.x,a.y);break;case"cross":t.strokeWeight(i),t.stroke(e),t.line(0,0,m.x,m.y),t.line(m.x,m.y,a.x,a.y),t.stroke((0,N.adjustColor)(e)),t.line(0,0,a.x,a.y)}t.pop()}(),o=t.createVector(t.width/2,t.height/2),l=t.createVector(t.mouseX,t.mouseY),_=t.constructor.Vector.sub(l,o),t.push(),t.stroke(255,255,255,120),t.drawingContext.setLineDash([4,4]),t.line(o.x,o.y,l.x,o.y),t.line(l.x,o.y,l.x,l.y),t.drawingContext.setLineDash([]),t.noFill(),t.stroke(255,255,255,150),u=Math.atan2(_.y,_.x),t.arc(o.x,o.y,80,80,0,u),t.pop(),function(){if(!s.current.physicsEnabled||!i.current)return;let e=i.current.getPosition(),o=.2*V.SCALE*2,{strokeColor:n}=s.current;t.noStroke(),t.fill((0,N.adjustColor)(n)),t.circle(e.x*V.SCALE,e.y*V.SCALE,o)}(),h(t,{},{},()=>(function(){let e=t.createVector(t.width/2,t.height/2),i=t.createVector(t.mouseX,t.mouseY),{operation:o,visualizeMode:n,multiVector:r}=s.current,a=e.copy(),m=t.constructor.Vector.sub(i,e),h=i.copy(),c={},l=m.mag(),_=180*Math.atan2(m.y,m.x)/Math.PI;switch(c["Vector |B|"]=`${l.toFixed(2)} px`,c["Vector angle θ"]=`${_.toFixed(1)} deg`,c["B components"]=`(${m.x.toFixed(2)}, ${m.y.toFixed(2)}) px`,o){case"+":{let e="triangle"===n?h:t.constructor.Vector.add(a,m);c["Addition resultant R"]=`(${e.x.toFixed(2)}, ${e.y.toFixed(2)}) px`,c["|R|"]=`${e.mag().toFixed(2)} px`,c.Formula="triangle"===n?"Triangle: R = B (origin→mouse)":"Parallelogram: R = A + B";break}case"-":{let o="triangle"===n?t.constructor.Vector.sub(i,e):t.constructor.Vector.add(a,t.constructor.Vector.mult(m,-1));c["Subtraction resultant R = B - A"]=`(${o.x.toFixed(2)}, ${o.y.toFixed(2)}) px`,c["|R|"]=`${o.mag().toFixed(2)} px`,c.Formula="triangle"===n?"Triangle: R = B - A (center→mouse)":"Parallelogram: R = A + (-B)";break}case"x":{let o=t.constructor.Vector.sub(i,e).copy().mult(r),s=180*Math.atan2(o.y,o.x)/Math.PI;c["Scalar s"]=r.toFixed(2),c["Scaled vector s·v"]=`(${o.x.toFixed(2)}, ${o.y.toFixed(2)}) px`,c["|s·v|"]=`${o.mag().toFixed(2)} px`,c["Angle of s·v"]=`${s.toFixed(1)} deg`,c.Formula="s·v = (s·vx, s·vy); if s < 0, orientation flips";break}case"normalize":{let o=t.constructor.Vector.sub(i,e),s=o.mag(),n=s?o.copy().div(s):t.createVector(0,0);c["|v|"]=s.toFixed(2),c["unit v̂"]=`(${n.x.toFixed(3)}, ${n.y.toFixed(3)})`,c.Formula="v̂ = v / |v|";break}case"dot":{let o=e.copy(),s=t.constructor.Vector.sub(i,e),n=o.x*s.x+o.y*s.y,r=o.mag(),a=s.mag(),m=180*Math.acos(Math.max(-1,Math.min(1,r&&a?n/(r*a):0)))/Math.PI;c["A·B"]=`${n.toFixed(2)} px\xb2`,c["θ between A and B (deg)"]=m.toFixed(1),c.Formula="A·B = |A||B| cosθ = AxBx + AyBy";break}case"cross":{let o=e.copy(),s=t.constructor.Vector.sub(i,e),n=o.x*s.y-o.y*s.x,r=n>0?"+ (counterclockwise)":n<0?"- (clockwise)":"0";c["A×B (z-component)"]=`${n.toFixed(2)} ${r} px\xb2`,c.Formula="A×B (2D) = AxBy − AyBx (z-axis out of plane)"}}return c})())},t.windowResized=()=>{let{clientWidth:e,clientHeight:i}=t._userNode;t.resizeCanvas(e,i),s.current.physicsEnabled&&(c(),m(e,i))}},[s]);return(0,b.jsx)(z.default,{resetVersion:r,onReset:()=>{let t=(0,C.isPaused)();(0,C.resetTime)(),t&&(0,C.setPause)(!0),n(!0),a(t=>t+1)},inputs:i,simulation:t,onLoad:t=>{o(t),a(t=>t+1)},theory:l,dynamicInputs:(0,b.jsx)(F.default,{config:I,values:i,onChange:c}),children:(0,b.jsx)(S.default,{sketch:_,simInfos:(0,b.jsx)(L.default,{data:m})},r)})}s1.prototype.update=function(t){if(!Array.isArray(t))throw"Invalid data: "+t;this._entered.length=0,this._exited.length=0,this._data.length=t.length;for(var e=0;e<t.length;e++)if("object"==typeof t[e]&&null!==t[e]){var i=t[e],o=this._key(i);this._map[o]?delete this._map[o]:this._entered.push(i),this._data[e]=i,this._xmap[o]=i}for(var o in this._map)this._exited.push(this._map[o]),delete this._map[o];var s=this._map;this._map=this._xmap,this._xmap=s;for(var e=0;e<this._exited.length;e++){var i=this._exited[e],n=this._key(i),r=this._refMap[n];this._listener.exit(i,r),delete this._refMap[n]}for(var e=0;e<this._entered.length;e++){var i=this._entered[e],n=this._key(i),r=this._listener.enter(i);r&&(this._refMap[n]=r)}for(var e=0;e<this._data.length;e++)if("object"==typeof t[e]&&null!==t[e]){var i=this._data[e],n=this._key(i),r=this._refMap[n];this._listener.update(i,r)}this._entered.length=0,this._exited.length=0,this._data.length=0},s1.prototype.ref=function(t){return this._refMap[this._key(t)]},t.s(["default",()=>s2],69398)}]);